{"version":3,"file":"peaks.ext.min.js","sources":["../node_modules/eventemitter3/index.js","../src/cue.js","../src/utils.js","../src/cue-emitter.js","../src/point.js","../src/waveform-points.js","../src/segment.js","../src/waveform-segments.js","../src/keyboard-handler.js","../src/mediaelement-player.js","../src/player.js","../src/default-point-marker.js","../src/default-segment-marker.js","../src/marker-factories.js","../src/highlight-layer.js","../src/point-marker.js","../src/points-layer.js","../src/playhead-layer.js","../src/overlay-segment-marker.js","../src/segment-marker.js","../src/waveform-shape.js","../src/segment-shape.js","../src/segments-layer.js","../src/waveform-axis.js","../src/waveform-view.js","../src/mouse-drag-handler.js","../src/seek-mouse-drag-handler.js","../src/waveform-overview.js","../src/insert-segment-mouse-drag-handler.js","../src/scroll-mouse-drag-handler.js","../src/waveform-zoomview.js","../src/scrollbar.js","../src/view-controller.js","../src/zoom-controller.js","../src/waveform-builder.js","../src/main.js"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","/**\n * @file\n *\n * Defines the {@link Cue} class.\n *\n * @module cue\n */\n\n/**\n * A cue represents an event to be triggered at some point on the media\n * timeline.\n *\n * @class\n * @alias Cue\n *\n * @param {Number} time Cue time, in seconds.\n * @param {Number} type Cue mark type, either <code>Cue.POINT</code>,\n *   <code>Cue.SEGMENT_START</code>, or <code>Cue.SEGMENT_END</code>.\n * @param {String} id The id of the {@link Point} or {@link Segment}.\n */\n\nfunction Cue(time, type, id) {\n  this.time = time;\n  this.type = type;\n  this.id = id;\n}\n\n/**\n  * @constant\n  * @type {Number}\n  */\n\nCue.POINT = 0;\nCue.SEGMENT_START = 1;\nCue.SEGMENT_END = 2;\n\n/**\n * Callback function for use with Array.prototype.sort().\n *\n * @static\n * @param {Cue} a\n * @param {Cue} b\n * @return {Number}\n */\n\nCue.sorter = function(a, b) {\n  return a.time - b.time;\n};\n\nexport default Cue;\n","import Konva from 'konva/lib/Core';\n\nfunction zeroPad(number, precision) {\n  number = number.toString();\n\n  while (number.length < precision) {\n    number = '0' + number;\n  }\n\n  return number;\n}\n\n/**\n * Returns a formatted time string.\n *\n * @param {Number} time The time to be formatted, in seconds.\n * @param {Number} precision Decimal places to which time is displayed\n * @returns {String}\n */\n\nexport function formatTime(time, precision) {\n  let result = [];\n\n  const fractionSeconds = Math.floor((time % 1) * Math.pow(10, precision));\n  const seconds = Math.floor(time);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n\n  if (hours > 0) {\n    result.push(hours); // Hours\n  }\n  result.push(minutes % 60); // Mins\n  result.push(seconds % 60); // Seconds\n\n  for (let i = 0; i < result.length; i++) {\n    result[i] = zeroPad(result[i], 2);\n  }\n\n  result = result.join(':');\n\n  if (precision > 0) {\n    result += '.' + zeroPad(fractionSeconds, precision);\n  }\n\n  return result;\n}\n\n/**\n * Rounds the given value up to the nearest given multiple.\n *\n * @param {Number} value\n * @param {Number} multiple\n * @returns {Number}\n *\n * @example\n * roundUpToNearest(5.5, 3); // returns 6\n * roundUpToNearest(141.0, 10); // returns 150\n * roundUpToNearest(-5.5, 3); // returns -6\n */\n\nexport function roundUpToNearest(value, multiple) {\n  if (multiple === 0) {\n    return 0;\n  }\n\n  let multiplier = 1;\n\n  if (value < 0.0) {\n    multiplier = -1;\n    value = -value;\n  }\n\n  const roundedUp = Math.ceil(value);\n\n  return multiplier * (((roundedUp + multiple - 1) / multiple) | 0) * multiple;\n}\n\nexport function clamp(value, min, max) {\n  if (value < min) {\n    return min;\n  }\n  else if (value > max) {\n    return max;\n  }\n  else {\n    return value;\n  }\n}\n\nexport function objectHasProperty(object, field) {\n  return Object.prototype.hasOwnProperty.call(object, field);\n}\n\nexport function extend(to, from) {\n  for (const key in from) {\n    if (objectHasProperty(from, key)) {\n      to[key] = from[key];\n    }\n  }\n\n  return to;\n}\n\n/**\n * Checks whether the given array contains values in ascending order.\n *\n * @param {Array<Number>} array The array to test\n * @returns {Boolean}\n */\n\nexport function isInAscendingOrder(array) {\n  if (array.length === 0) {\n    return true;\n  }\n\n  let value = array[0];\n\n  for (let i = 1; i < array.length; i++) {\n    if (value >= array[i]) {\n      return false;\n    }\n\n    value = array[i];\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the given value is a number.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isNumber(value) {\n  return typeof value === 'number';\n}\n\n/**\n * Checks whether the given value is a finite number.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isFinite(value) {\n  if (typeof value !== 'number') {\n    return false;\n  }\n\n  // Check for NaN and infinity\n  // eslint-disable-next-line no-self-compare\n  if (value !== value || value === Infinity || value === -Infinity) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the given value is a valid timestamp.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isValidTime(value) {\n  return (typeof value === 'number') && Number.isFinite(value);\n}\n\n/**\n * Checks whether the given value is a valid object.\n *\n * @param {Object|Array} value The value to test\n * @returns {Boolean}\n */\n\nexport function isObject(value) {\n  return (value !== null) && (typeof value === 'object')\n    && !Array.isArray(value);\n}\n\n/**\n * Checks whether the given value is a valid string.\n *\n * @param {String} value The value to test\n * @returns {Boolean}\n */\n\nexport function isString(value) {\n  return typeof value === 'string';\n}\n\n/**\n * Checks whether the given value is a valid ArrayBuffer.\n *\n * @param {ArrayBuffer} value The value to test\n * @returns {Boolean}\n */\n\nexport function isArrayBuffer(value) {\n  return Object.prototype.toString.call(value).includes('ArrayBuffer');\n}\n\n/**\n * Checks whether the given value is null or undefined.\n *\n * @param {Object} value The value to test\n * @returns {Boolean}\n */\n\nexport function isNullOrUndefined(value) {\n  return value === undefined || value === null;\n}\n\n/**\n * Checks whether the given value is a function.\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isFunction(value) {\n  return typeof value === 'function';\n}\n\n/**\n * Checks whether the given value is a boolean.\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isBoolean(value) {\n  return value === true || value === false;\n}\n\n/**\n * Checks whether the given value is a valid HTML element.\n *\n * @param {HTMLElement} value The value to test\n * @returns {Boolean}\n */\n\nexport function isHTMLElement(value) {\n  return value instanceof HTMLElement;\n}\n\n/**\n * Checks whether the given value is an array\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isArray(value) {\n  return Array.isArray(value);\n}\n\n/**\n * Checks whether the given value is a valid linear gradient color\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isLinearGradientColor(value) {\n  return isObject(value) &&\n    objectHasProperty(value, 'linearGradientStart') &&\n    objectHasProperty(value, 'linearGradientEnd') &&\n    objectHasProperty(value, 'linearGradientColorStops') &&\n    isNumber(value.linearGradientStart) &&\n    isNumber(value.linearGradientEnd) &&\n    isArray(value.linearGradientColorStops) &&\n    value.linearGradientColorStops.length === 2;\n}\n\nexport function getMarkerObject(obj) {\n  while (obj.parent !== null) {\n    if (obj.parent instanceof Konva.Layer) {\n      return obj;\n    }\n\n    obj = obj.parent;\n  }\n\n  return null;\n}\n","/**\n * @file\n *\n * Defines the {@link CueEmitter} class.\n *\n * @module cue-emitter\n */\n\nimport Cue from './cue';\nimport { objectHasProperty } from './utils';\n\nconst isHeadless = /HeadlessChrome/.test(navigator.userAgent);\n\nfunction windowIsVisible() {\n  if (isHeadless || navigator.webdriver) {\n    return false;\n  }\n\n  return (typeof document === 'object') &&\n    ('visibilityState' in document) &&\n    (document.visibilityState === 'visible');\n}\n\nconst requestAnimationFrame =\n  window.requestAnimationFrame ||\n  window.mozRequestAnimationFrame ||\n  window.webkitRequestAnimationFrame ||\n  window.msRequestAnimationFrame;\n\nconst cancelAnimationFrame =\n  window.cancelAnimationFrame ||\n  window.mozCancelAnimationFrame ||\n  window.webkitCancelAnimationFrame ||\n  window.msCancelAnimationFrame;\n\nconst eventTypes = {\n  forward: {},\n  reverse: {}\n};\n\nconst EVENT_TYPE_POINT = 0;\nconst EVENT_TYPE_SEGMENT_ENTER = 1;\nconst EVENT_TYPE_SEGMENT_EXIT = 2;\n\neventTypes.forward[Cue.POINT] = EVENT_TYPE_POINT;\neventTypes.forward[Cue.SEGMENT_START] = EVENT_TYPE_SEGMENT_ENTER;\neventTypes.forward[Cue.SEGMENT_END] = EVENT_TYPE_SEGMENT_EXIT;\n\neventTypes.reverse[Cue.POINT] = EVENT_TYPE_POINT;\neventTypes.reverse[Cue.SEGMENT_START] = EVENT_TYPE_SEGMENT_EXIT;\neventTypes.reverse[Cue.SEGMENT_END] = EVENT_TYPE_SEGMENT_ENTER;\n\nconst eventNames = {};\n\neventNames[EVENT_TYPE_POINT] = 'points.enter';\neventNames[EVENT_TYPE_SEGMENT_ENTER] = 'segments.enter';\neventNames[EVENT_TYPE_SEGMENT_EXIT] = 'segments.exit';\n\nconst eventAttributes = {};\n\neventAttributes[EVENT_TYPE_POINT] = 'point';\neventAttributes[EVENT_TYPE_SEGMENT_ENTER] = 'segment';\neventAttributes[EVENT_TYPE_SEGMENT_EXIT] = 'segment';\n\n/**\n * Given a cue instance, returns the corresponding {@link Point}\n * {@link Segment}.\n *\n * @param {Peaks} peaks\n * @param {Cue} cue\n * @return {Point|Segment}\n * @throws {Error}\n */\n\nfunction getPointOrSegment(peaks, cue) {\n  switch (cue.type) {\n    case Cue.POINT:\n      return peaks.points.getPoint(cue.id);\n\n    case Cue.SEGMENT_START:\n    case Cue.SEGMENT_END:\n      return peaks.segments.getSegment(cue.id);\n\n    default:\n      throw new Error('getPointOrSegment: id not found?');\n  }\n}\n\n/**\n * CueEmitter is responsible for emitting <code>points.enter</code>,\n * <code>segments.enter</code>, and <code>segments.exit</code> events.\n *\n * @class\n * @alias CueEmitter\n *\n * @param {Peaks} peaks Parent {@link Peaks} instance.\n */\n\nfunction CueEmitter(peaks) {\n  this._cues = [];\n  this._peaks = peaks;\n  this._previousTime = -1;\n  this._updateCues = this._updateCues.bind(this);\n  this._onPlaying = this._onPlaying.bind(this);\n  this._onSeeked = this._onSeeked.bind(this);\n  this._onTimeUpdate = this._onTimeUpdate.bind(this);\n  this._onAnimationFrame = this._onAnimationFrame.bind(this);\n  this._rAFHandle = null;\n  this._activeSegments = {};\n  this._attachEventHandlers();\n}\n\n/**\n * This function is bound to all {@link Peaks} events relating to mutated\n * [Points]{@link Point} or [Segments]{@link Segment}, and updates the\n * list of cues accordingly.\n *\n * @private\n */\n\nCueEmitter.prototype._updateCues = function() {\n  const self = this;\n\n  const points = self._peaks.points.getPoints();\n  const segments = self._peaks.segments.getSegments();\n\n  self._cues.length = 0;\n\n  points.forEach(function(point) {\n    self._cues.push(new Cue(point.time, Cue.POINT, point.id));\n  });\n\n  segments.forEach(function(segment) {\n    self._cues.push(new Cue(segment.startTime, Cue.SEGMENT_START, segment.id));\n    self._cues.push(new Cue(segment.endTime, Cue.SEGMENT_END, segment.id));\n  });\n\n  self._cues.sort(Cue.sorter);\n\n  const time = self._peaks.player.getCurrentTime();\n\n  self._updateActiveSegments(time);\n};\n\n/**\n * Emits events for any cues passed through during media playback.\n *\n * @param {Number} time The current time on the media timeline.\n * @param {Number} previousTime The previous time on the media timeline when\n *   this function was called.\n */\n\nCueEmitter.prototype._onUpdate = function(time, previousTime) {\n  const isForward = time > previousTime;\n  let start;\n  let end;\n  let step;\n\n  if (isForward) {\n    start = 0;\n    end = this._cues.length;\n    step = 1;\n  }\n  else {\n    start = this._cues.length - 1;\n    end = -1;\n    step = -1;\n  }\n\n  // Cues are sorted.\n\n  for (let i = start; isForward ? i < end : i > end; i += step) {\n    const cue = this._cues[i];\n\n    if (isForward ? cue.time > previousTime : cue.time < previousTime) {\n      if (isForward ? cue.time > time : cue.time < time) {\n        break;\n      }\n\n      // Cue falls between time and previousTime.\n\n      const marker = getPointOrSegment(this._peaks, cue);\n\n      const eventType = isForward ? eventTypes.forward[cue.type] :\n                                    eventTypes.reverse[cue.type];\n\n      if (eventType === EVENT_TYPE_SEGMENT_ENTER) {\n        this._activeSegments[marker.id] = marker;\n      }\n      else if (eventType === EVENT_TYPE_SEGMENT_EXIT) {\n        delete this._activeSegments[marker.id];\n      }\n\n      const event = {\n        time: time\n      };\n\n      event[eventAttributes[eventType]] = marker;\n\n      this._peaks.emit(eventNames[eventType], event);\n    }\n  }\n};\n\n// The next handler and onAnimationFrame are bound together\n// when the window isn't in focus, rAF is throttled\n// falling back to timeUpdate.\n\nCueEmitter.prototype._onTimeUpdate = function(time) {\n  if (windowIsVisible()) {\n    return;\n  }\n\n  if (this._peaks.player.isPlaying() && !this._peaks.player.isSeeking()) {\n    this._onUpdate(time, this._previousTime);\n  }\n\n  this._previousTime = time;\n};\n\nCueEmitter.prototype._onAnimationFrame = function() {\n  const time = this._peaks.player.getCurrentTime();\n\n  if (!this._peaks.player.isSeeking()) {\n    this._onUpdate(time, this._previousTime);\n  }\n\n  this._previousTime = time;\n\n  if (this._peaks.player.isPlaying()) {\n    this._rAFHandle = requestAnimationFrame(this._onAnimationFrame);\n  }\n};\n\nCueEmitter.prototype._onPlaying = function() {\n  this._previousTime = this._peaks.player.getCurrentTime();\n  this._rAFHandle = requestAnimationFrame(this._onAnimationFrame);\n};\n\nCueEmitter.prototype._onSeeked = function(time) {\n  this._previousTime = time;\n\n  this._updateActiveSegments(time);\n};\n\nfunction getSegmentIdComparator(id) {\n  return function compareSegmentIds(segment) {\n    return segment.id === id;\n  };\n}\n\n/**\n * The active segments is the set of all segments which overlap the current\n * playhead position. This function updates that set and emits\n * <code>segments.enter</code> and <code>segments.exit</code> events.\n */\n\nCueEmitter.prototype._updateActiveSegments = function(time) {\n  const self = this;\n\n  const activeSegments = self._peaks.segments.getSegmentsAtTime(time);\n\n  // Remove any segments no longer active.\n\n  for (const id in self._activeSegments) {\n    if (objectHasProperty(self._activeSegments, id)) {\n      const segment = activeSegments.find(getSegmentIdComparator(id));\n\n      if (!segment) {\n        self._peaks.emit('segments.exit', {\n          segment: self._activeSegments[id],\n          time: time\n        });\n\n        delete self._activeSegments[id];\n      }\n    }\n  }\n\n  // Add new active segments.\n\n  activeSegments.forEach(function(segment) {\n    if (!(segment.id in self._activeSegments)) {\n      self._activeSegments[segment.id] = segment;\n\n      self._peaks.emit('segments.enter', {\n        segment: segment,\n        time: time\n      });\n    }\n  });\n};\n\nconst events = [\n  'points.update',\n  'points.dragmove',\n  'points.add',\n  'points.remove',\n  'points.remove_all',\n  'segments.update',\n  'segments.dragged',\n  'segments.add',\n  'segments.remove',\n  'segments.remove_all'\n];\n\nCueEmitter.prototype._attachEventHandlers = function() {\n  this._peaks.on('player.timeupdate', this._onTimeUpdate);\n  this._peaks.on('player.playing', this._onPlaying);\n  this._peaks.on('player.seeked', this._onSeeked);\n\n  for (let i = 0; i < events.length; i++) {\n    this._peaks.on(events[i], this._updateCues);\n  }\n\n  this._updateCues();\n};\n\nCueEmitter.prototype._detachEventHandlers = function() {\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.seeked', this._onSeeked);\n\n  for (let i = 0; i < events.length; i++) {\n    this._peaks.off(events[i], this._updateCues);\n  }\n};\n\nCueEmitter.prototype.destroy = function() {\n  if (this._rAFHandle) {\n    cancelAnimationFrame(this._rAFHandle);\n    this._rAFHandle = null;\n  }\n\n  this._detachEventHandlers();\n\n  this._previousTime = -1;\n};\n\nexport default CueEmitter;\n","/**\n * @file\n *\n * Defines the {@link Point} class.\n *\n * @module point\n */\n\nimport {\n  isBoolean, isLinearGradientColor, isNullOrUndefined, isString,\n  isValidTime, objectHasProperty\n} from './utils';\n\nconst pointOptions = [\n  'id', 'pid', 'time', 'labelText', 'color', 'editable'\n];\n\nconst invalidOptions = [\n  'update', 'isVisible', 'peaks', 'pid'\n];\n\nfunction setDefaultPointOptions(options, peaksOptions) {\n  if (isNullOrUndefined(options.labelText)) {\n    options.labelText = '';\n  }\n\n  if (isNullOrUndefined(options.editable)) {\n    options.editable = false;\n  }\n\n  if (isNullOrUndefined(options.color)) {\n    options.color = peaksOptions.pointMarkerColor;\n  }\n}\n\nfunction validatePointOptions(options, updating) {\n  const context = updating ? 'update()' : 'add()';\n\n  if (!updating || (updating && objectHasProperty(options, 'time'))) {\n    if (!isValidTime(options.time)) {\n      throw new TypeError('peaks.points.' + context + ': time should be a numeric value');\n    }\n  }\n\n  if (options.time < 0) {\n    throw new RangeError('peaks.points.' + context + ': time should not be negative');\n  }\n\n  if (objectHasProperty(options, 'labelText') && !isString(options.labelText)) {\n    throw new TypeError('peaks.points.' + context + ': labelText must be a string');\n  }\n\n  if (objectHasProperty(options, 'editable') && !isBoolean(options.editable)) {\n    throw new TypeError('peaks.points.' + context + ': editable must be true or false');\n  }\n\n  if (objectHasProperty(options, 'color') &&\n    !isString(options.color) &&\n    !isLinearGradientColor(options.color)) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    throw new TypeError('peaks.points.' + context + ': color must be a string or a valid linear gradient object');\n  }\n\n  invalidOptions.forEach(function(name) {\n    if (objectHasProperty(options, name)) {\n      throw new Error('peaks.points.' + context + ': invalid option name: ' + name);\n    }\n  });\n\n  pointOptions.forEach(function(name) {\n    if (objectHasProperty(options, '_' + name)) {\n      throw new Error('peaks.points.' + context + ': invalid option name: _' + name);\n    }\n  });\n}\n\n/**\n * A point is a single instant of time, with associated label and color.\n *\n * @class\n * @alias Point\n *\n * @param {Peaks} peaks A reference to the Peaks instance.\n * @param {Number} pid An internal unique identifier for the point.\n * @param {PointOptions} options User specified point attributes.\n */\n\nfunction Point(peaks, pid, options) {\n  this._peaks = peaks;\n  this._pid = pid;\n  this._setUserData(options);\n}\n\nPoint.prototype._setUserData = function(options) {\n  for (const key in options) {\n    if (objectHasProperty(options, key)) {\n      if (pointOptions.indexOf(key) === -1) {\n        this[key] = options[key];\n      }\n      else {\n        this['_' + key] = options[key];\n      }\n    }\n  }\n};\n\nObject.defineProperties(Point.prototype, {\n  id: {\n    enumerable: true,\n    get: function() {\n      return this._id;\n    }\n  },\n  pid: {\n    enumerable: true,\n    get: function() {\n      return this._pid;\n    }\n  },\n  time: {\n    enumerable: true,\n    get: function() {\n      return this._time;\n    }\n  },\n  labelText: {\n    get: function() {\n      return this._labelText;\n    }\n  },\n  color: {\n    enumerable: true,\n    get: function() {\n      return this._color;\n    }\n  },\n  editable: {\n    enumerable: true,\n    get: function() {\n      return this._editable;\n    }\n  }\n});\n\nPoint.prototype.update = function(options) {\n  validatePointOptions(options, true);\n\n  if (objectHasProperty(options, 'id')) {\n    if (isNullOrUndefined(options.id)) {\n      throw new TypeError('point.update(): invalid id');\n    }\n\n    this._peaks.points.updatePointId(this, options.id);\n  }\n\n  this._setUserData(options);\n\n  this._peaks.emit('points.update', this, options);\n};\n\n/**\n * Returns <code>true</code> if the point lies with in a given time range.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Boolean}\n */\n\nPoint.prototype.isVisible = function(startTime, endTime) {\n  return this.time >= startTime && this.time < endTime;\n};\n\nPoint.prototype._setTime = function(time) {\n  this._time = time;\n};\n\nexport { Point, setDefaultPointOptions, validatePointOptions };\n","/**\n * @file\n *\n * Defines the {@link WaveformPoints} class.\n *\n * @module waveform-points\n */\n\nimport { Point, setDefaultPointOptions, validatePointOptions } from './point';\nimport { extend, isNullOrUndefined, objectHasProperty } from './utils';\n\n/**\n * Point parameters.\n *\n * @typedef {Object} PointOptions\n * @global\n * @property {Number} time Point time, in seconds.\n * @property {Boolean=} editable If <code>true</code> the point time can be\n *   adjusted via the user interface.\n *   Default: <code>false</code>.\n * @property {String=} color Point marker color.\n *   Default: a random color.\n * @property {String=} labelText Point label text.\n *   Default: an empty string.\n * @property {String=} id A unique point identifier.\n *   Default: an automatically generated identifier.\n * @property {*} data Optional application-specific data.\n */\n\n/**\n * Handles all functionality related to the adding, removing and manipulation\n * of points. A point is a single instant of time.\n *\n * @class\n * @alias WaveformPoints\n *\n * @param {Peaks} peaks The parent Peaks object.\n */\n\nfunction WaveformPoints(peaks) {\n  this._peaks = peaks;\n  this._points = [];\n  this._pointsById = {};\n  this._pointsByPid = {};\n  this._pointIdCounter = 0;\n  this._pointPid = 0;\n}\n\n/**\n * Returns a new unique point id value.\n *\n * @returns {String}\n */\n\nWaveformPoints.prototype._getNextPointId = function() {\n  return 'peaks.point.' + this._pointIdCounter++;\n};\n\n/**\n * Returns a new unique point id value, for internal use within\n * Peaks.js only.\n *\n * @returns {Number}\n */\n\nWaveformPoints.prototype._getNextPid = function() {\n  return this._pointPid++;\n};\n\n/**\n * Adds a new point object.\n *\n * @private\n * @param {Point} point\n */\n\nWaveformPoints.prototype._addPoint = function(point) {\n  this._points.push(point);\n\n  this._pointsById[point.id] = point;\n  this._pointsByPid[point.pid] = point;\n};\n\n/**\n * Creates a new point object.\n *\n * @private\n * @param {PointOptions} options\n * @returns {Point}\n */\n\nWaveformPoints.prototype._createPoint = function(options) {\n  const pointOptions = {};\n\n  extend(pointOptions, options);\n\n  if (isNullOrUndefined(pointOptions.id)) {\n    pointOptions.id = this._getNextPointId();\n  }\n\n  const pid = this._getNextPid();\n\n  setDefaultPointOptions(pointOptions, this._peaks.options);\n\n  validatePointOptions(pointOptions, false);\n\n  return new Point(this._peaks, pid, pointOptions);\n};\n\n/**\n * Returns all points.\n *\n * @returns {Array<Point>}\n */\n\nWaveformPoints.prototype.getPoints = function() {\n  return this._points;\n};\n\n/**\n * Returns the point with the given id, or <code>undefined</code> if not found.\n *\n * @param {String} id\n * @returns {Point}\n */\n\nWaveformPoints.prototype.getPoint = function(id) {\n  return this._pointsById[id];\n};\n\n/**\n * Returns all points within a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Array<Point>}\n */\n\nWaveformPoints.prototype.find = function(startTime, endTime) {\n  return this._points.filter(function(point) {\n    return point.isVisible(startTime, endTime);\n  });\n};\n\n/**\n * Adds one or more points to the timeline.\n *\n * @param {PointOptions|Array<PointOptions>} pointOrPoints\n *\n * @returns Point|Array<Point>\n */\n\nWaveformPoints.prototype.add = function(/* pointOrPoints */) {\n  const self = this;\n\n  const arrayArgs = Array.isArray(arguments[0]);\n  let points = arrayArgs ?\n               arguments[0] :\n               Array.prototype.slice.call(arguments);\n\n  points = points.map(function(pointOptions) {\n    const point = self._createPoint(pointOptions);\n\n    if (objectHasProperty(self._pointsById, point.id)) {\n      throw new Error('peaks.points.add(): duplicate id');\n    }\n\n    return point;\n  });\n\n  points.forEach(function(point) {\n    self._addPoint(point);\n  });\n\n  this._peaks.emit('points.add', {\n    points: points\n  });\n\n  return arrayArgs ? points : points[0];\n};\n\nWaveformPoints.prototype.updatePointId = function(point, newPointId) {\n  if (this._pointsById[point.id]) {\n    if (this._pointsById[newPointId]) {\n      throw new Error('point.update(): duplicate id');\n    }\n    else {\n      delete this._pointsById[point.id];\n      this._pointsById[newPointId] = point;\n    }\n  }\n};\n\n/**\n * Returns the indexes of points that match the given predicate.\n *\n * @private\n * @param {Function} predicate Predicate function to find matching points.\n * @returns {Array<Number>} An array of indexes into the points array of\n *   the matching elements.\n */\n\nWaveformPoints.prototype._findPoint = function(predicate) {\n  const indexes = [];\n\n  for (let i = 0, length = this._points.length; i < length; i++) {\n    if (predicate(this._points[i])) {\n      indexes.push(i);\n    }\n  }\n\n  return indexes;\n};\n\n/**\n * Removes the points at the given array indexes.\n *\n * @private\n * @param {Array<Number>} indexes The array indexes to remove.\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype._removeIndexes = function(indexes) {\n  const removed = [];\n\n  for (let i = 0; i < indexes.length; i++) {\n    const index = indexes[i] - removed.length;\n\n    const itemRemoved = this._points.splice(index, 1)[0];\n\n    delete this._pointsById[itemRemoved.id];\n    delete this._pointsByPid[itemRemoved.pid];\n\n    removed.push(itemRemoved);\n  }\n\n  return removed;\n};\n\n/**\n * Removes all points that match a given predicate function.\n *\n * After removing the points, this function emits a\n * <code>points.remove</code> event with the removed {@link Point}\n * objects.\n *\n * @private\n * @param {Function} predicate A predicate function that identifies which\n *   points to remove.\n * @returns {Array<Point>} The removed {@link Points} objects.\n */\n\nWaveformPoints.prototype._removePoints = function(predicate) {\n  const indexes = this._findPoint(predicate);\n\n  const removed = this._removeIndexes(indexes);\n\n  this._peaks.emit('points.remove', {\n    points: removed\n  });\n\n  return removed;\n};\n\n/**\n * Removes the given point.\n *\n * @param {Point} point The point to remove.\n * @returns {Array<Point>} The removed points.\n */\n\nWaveformPoints.prototype.remove = function(point) {\n  return this._removePoints(function(p) {\n    return p === point;\n  });\n};\n\n/**\n * Removes any points with the given id.\n *\n * @param {String} id\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype.removeById = function(pointId) {\n  return this._removePoints(function(point) {\n    return point.id === pointId;\n  });\n};\n\n/**\n * Removes any points at the given time.\n *\n * @param {Number} time\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype.removeByTime = function(time) {\n  return this._removePoints(function(point) {\n    return point.time === time;\n  });\n};\n\n/**\n * Removes all points.\n *\n * After removing the points, this function emits a\n * <code>points.remove_all</code> event.\n */\n\nWaveformPoints.prototype.removeAll = function() {\n  this._points = [];\n  this._pointsById = {};\n  this._pointsByPid = {};\n  this._peaks.emit('points.remove_all');\n};\n\nexport default WaveformPoints;\n","/**\n * @file\n *\n * Defines the {@link Segment} class.\n *\n * @module segment\n */\n\nimport {\n  isBoolean, isNullOrUndefined, isLinearGradientColor,\n  isString, isValidTime, objectHasProperty\n} from './utils';\n\nconst segmentOptions = [\n  'id', 'pid', 'startTime', 'endTime', 'labelText', 'color', 'borderColor',\n  'markers', 'overlay', 'editable'\n];\n\nconst invalidOptions = [\n  'update', 'isVisible', 'peaks', 'pid'\n];\n\nfunction setDefaultSegmentOptions(options, globalSegmentOptions) {\n  if (isNullOrUndefined(options.color)) {\n    if (globalSegmentOptions.overlay) {\n      options.color = globalSegmentOptions.overlayColor;\n    }\n    else {\n      options.color = globalSegmentOptions.waveformColor;\n    }\n  }\n\n  if (isNullOrUndefined(options.borderColor)) {\n    options.borderColor = globalSegmentOptions.overlayBorderColor;\n  }\n\n  if (isNullOrUndefined(options.labelText)) {\n    options.labelText = '';\n  }\n\n  if (isNullOrUndefined(options.markers)) {\n    options.markers = globalSegmentOptions.markers;\n  }\n\n  if (isNullOrUndefined(options.overlay)) {\n    options.overlay = globalSegmentOptions.overlay;\n  }\n\n  if (isNullOrUndefined(options.editable)) {\n    options.editable = false;\n  }\n}\n\nfunction validateSegmentOptions(options, updating) {\n  const context = updating ? 'update()' : 'add()';\n\n  if (objectHasProperty(options, 'startTime') && !isValidTime(options.startTime)) {\n    throw new TypeError('peaks.segments.' + context + ': startTime should be a valid number');\n  }\n\n  if (objectHasProperty(options, 'endTime') && !isValidTime(options.endTime)) {\n    throw new TypeError('peaks.segments.' + context + ': endTime should be a valid number');\n  }\n\n  if (!updating) {\n    if (!objectHasProperty(options, 'startTime') || !objectHasProperty(options, 'endTime')) {\n      throw new TypeError('peaks.segments.' + context + ': missing startTime or endTime');\n    }\n  }\n\n  if (options.startTime < 0) {\n    throw new RangeError('peaks.segments.' + context + ': startTime should not be negative');\n  }\n\n  if (options.endTime < 0) {\n    throw new RangeError('peaks.segments.' + context + ': endTime should not be negative');\n  }\n\n  if (options.endTime < options.startTime) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    throw new RangeError('peaks.segments.' + context + ': endTime should not be less than startTime');\n  }\n\n  if (objectHasProperty(options, 'labelText') && !isString(options.labelText)) {\n    throw new TypeError('peaks.segments.' + context + ': labelText must be a string');\n  }\n\n  if (updating && objectHasProperty(options, 'markers')) {\n    throw new TypeError('peaks.segments.' + context + ': cannot update markers attribute');\n  }\n\n  if (objectHasProperty(options, 'markers') && !isBoolean(options.markers)) {\n    throw new TypeError('peaks.segments.' + context + ': markers must be true or false');\n  }\n\n  if (updating && objectHasProperty(options, 'overlay')) {\n    throw new TypeError('peaks.segments.' + context + ': cannot update overlay attribute');\n  }\n\n  if (objectHasProperty(options, 'overlay') && !isBoolean(options.overlay)) {\n    throw new TypeError('peaks.segments.' + context + ': overlay must be true or false');\n  }\n\n  if (objectHasProperty(options, 'editable') && !isBoolean(options.editable)) {\n    throw new TypeError('peaks.segments.' + context + ': editable must be true or false');\n  }\n\n  if (objectHasProperty(options, 'color') &&\n    !isString(options.color) &&\n    !isLinearGradientColor(options.color)) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    throw new TypeError('peaks.segments.' + context + ': color must be a string or a valid linear gradient object');\n  }\n\n  if (objectHasProperty(options, 'borderColor') && !isString(options.borderColor)) {\n    throw new TypeError('peaks.segments.' + context + ': borderColor must be a string');\n  }\n\n  invalidOptions.forEach(function(name) {\n    if (objectHasProperty(options, name)) {\n      throw new Error('peaks.segments.' + context + ': invalid option name: ' + name);\n    }\n  });\n\n  segmentOptions.forEach(function(name) {\n    if (objectHasProperty(options, '_' + name)) {\n      throw new Error('peaks.segments.' + context + ': invalid option name: _' + name);\n    }\n  });\n}\n\n/**\n * A segment is a region of time, with associated label and color.\n *\n * @class\n * @alias Segment\n *\n * @param {Peaks} peaks A reference to the Peaks instance.\n * @param {Number} pid An internal unique identifier for the segment.\n * @param {SegmentOptions} options User specified segment attributes.\n */\n\nfunction Segment(peaks, pid, options) {\n  this._peaks       = peaks;\n  this._pid         = pid;\n  this._id          = options.id;\n  this._startTime   = options.startTime;\n  this._endTime     = options.endTime;\n  this._labelText   = options.labelText;\n  this._color       = options.color;\n  this._borderColor = options.borderColor;\n  this._editable    = options.editable;\n  this._markers     = options.markers;\n  this._overlay     = options.overlay;\n\n  this._setUserData(options);\n}\n\nSegment.prototype._setUserData = function(options) {\n  for (const key in options) {\n    if (objectHasProperty(options, key)) {\n      if (segmentOptions.indexOf(key) === -1) {\n        this[key] = options[key];\n      }\n      else {\n        this['_' + key] = options[key];\n      }\n    }\n  }\n};\n\nObject.defineProperties(Segment.prototype, {\n  id: {\n    enumerable: true,\n    get: function() {\n      return this._id;\n    }\n  },\n  pid: {\n    enumerable: true,\n    get: function() {\n      return this._pid;\n    }\n  },\n  startTime: {\n    enumerable: true,\n    get: function() {\n      return this._startTime;\n    }\n  },\n  endTime: {\n    enumerable: true,\n    get: function() {\n      return this._endTime;\n    }\n  },\n  labelText: {\n    enumerable: true,\n    get: function() {\n      return this._labelText;\n    }\n  },\n  color: {\n    enumerable: true,\n    get: function() {\n      return this._color;\n    }\n  },\n  borderColor: {\n    enumerable: true,\n    get: function() {\n      return this._borderColor;\n    }\n  },\n  markers: {\n    enumerable: true,\n    get: function() {\n      return this._markers;\n    }\n  },\n  overlay: {\n    enumerable: true,\n    get: function() {\n      return this._overlay;\n    }\n  },\n  editable: {\n    enumerable: true,\n    get: function() {\n      return this._editable;\n    }\n  }\n});\n\nSegment.prototype.update = function(options) {\n  validateSegmentOptions(options, true);\n\n  if (objectHasProperty(options, 'id')) {\n    if (isNullOrUndefined(options.id)) {\n      throw new TypeError('segment.update(): invalid id');\n    }\n\n    this._peaks.segments.updateSegmentId(this, options.id);\n  }\n\n  this._setUserData(options);\n\n  this._peaks.emit('segments.update', this, options);\n};\n\n/**\n * Returns <code>true</code> if the segment overlaps a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Boolean}\n */\n\nSegment.prototype.isVisible = function(startTime, endTime) {\n  // A special case, where the segment has zero duration\n  // and is at the start of the region.\n  if (this.startTime === this.endTime && this.startTime === startTime) {\n    return true;\n  }\n\n  // Segment ends before start of region.\n  if (this.endTime <= startTime) {\n    return false;\n  }\n\n  // Segment starts after end of region\n  if (this.startTime >= endTime) {\n    return false;\n  }\n\n  return true;\n};\n\nSegment.prototype._setStartTime = function(time) {\n  this._startTime = time;\n};\n\nSegment.prototype._setEndTime = function(time) {\n  this._endTime = time;\n};\n\nexport { Segment, setDefaultSegmentOptions, validateSegmentOptions };\n","/**\n * @file\n *\n * Defines the {@link WaveformSegments} class.\n *\n * @module waveform-segments\n */\n\nimport { Segment, setDefaultSegmentOptions, validateSegmentOptions } from './segment';\nimport { extend, isNullOrUndefined, objectHasProperty } from './utils';\n\n/**\n * Segment parameters.\n *\n * @typedef {Object} SegmentOptions\n * @global\n * @property {Number} startTime Segment start time, in seconds.\n * @property {Number} endTime Segment end time, in seconds.\n * @property {Boolean=} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n *   Default: <code>false</code>.\n * @property {String=} color Segment waveform color.\n *   Default: Set by the <code>segmentOptions.waveformColor</code> option\n *   or the <code>segmentOptions.overlayColor</code> option.\n * @property {String=} borderColor Segment border color.\n *   Default: Set by the <code>segmentOptions.overlayBorderColor</code> option.\n * @property {String=} labelText Segment label text.\n *   Default: an empty string.\n * @property {String=} id A unique segment identifier.\n *   Default: an automatically generated identifier.\n * @property {*} data Optional application specific data.\n */\n\n/**\n * Handles all functionality related to the adding, removing and manipulation\n * of segments.\n *\n * @class\n * @alias WaveformSegments\n *\n * @param {Peaks} peaks The parent Peaks object.\n */\n\nfunction WaveformSegments(peaks) {\n  this._peaks = peaks;\n  this._segments = [];\n  this._segmentsById = {};\n  this._segmentsByPid = {};\n  this._segmentIdCounter = 0;\n  this._segmentPid = 0;\n  this._isInserting = false;\n}\n\n/**\n * Returns a new unique segment id value.\n *\n * @private\n * @returns {String}\n */\n\nWaveformSegments.prototype._getNextSegmentId = function() {\n  return 'peaks.segment.' + this._segmentIdCounter++;\n};\n\n/**\n * Returns a new unique segment id value, for internal use within\n * Peaks.js only.\n *\n * @private\n * @returns {Number}\n */\n\nWaveformSegments.prototype._getNextPid = function() {\n  return this._segmentPid++;\n};\n\n/**\n * Adds a new segment object.\n *\n * @private\n * @param {Segment} segment\n */\n\nWaveformSegments.prototype._addSegment = function(segment) {\n  this._segments.push(segment);\n\n  this._segmentsById[segment.id] = segment;\n  this._segmentsByPid[segment.pid] = segment;\n};\n\n/**\n * Creates a new segment object.\n *\n * @private\n * @param {SegmentOptions} options\n * @return {Segment}\n */\n\nWaveformSegments.prototype._createSegment = function(options) {\n  const segmentOptions = {};\n\n  extend(segmentOptions, options);\n\n  if (isNullOrUndefined(segmentOptions.id)) {\n    segmentOptions.id = this._getNextSegmentId();\n  }\n\n  const pid = this._getNextPid();\n\n  setDefaultSegmentOptions(segmentOptions, this._peaks.options.segmentOptions);\n\n  validateSegmentOptions(segmentOptions, false);\n\n  return new Segment(this._peaks, pid, segmentOptions);\n};\n\n/**\n * Returns all segments.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.getSegments = function() {\n  return this._segments;\n};\n\n/**\n * Returns the segment with the given id, or <code>undefined</code> if not found.\n *\n * @param {String} id\n * @returns {Segment}\n */\n\nWaveformSegments.prototype.getSegment = function(id) {\n  return this._segmentsById[id];\n};\n\n/**\n * Returns all segments that overlap a given point in time.\n *\n * @param {Number} time\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.getSegmentsAtTime = function(time) {\n  return this._segments.filter(function(segment) {\n    return time >= segment.startTime && time < segment.endTime;\n  });\n};\n\n/**\n * Returns all segments that overlap a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.find = function(startTime, endTime) {\n  return this._segments.filter(function(segment) {\n    return segment.isVisible(startTime, endTime);\n  });\n};\n\n/**\n * Returns a copy of the segments array, sorted by ascending segment start time.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype._getSortedSegments = function() {\n  return this._segments.slice().sort(function(a, b) {\n    return a.startTime - b.startTime;\n  });\n};\n\nWaveformSegments.prototype.findPreviousSegment = function(segment) {\n  const sortedSegments = this._getSortedSegments();\n\n  const index = sortedSegments.findIndex(function(s) {\n    return s.id === segment.id;\n  });\n\n  if (index !== -1) {\n    return sortedSegments[index - 1];\n  }\n\n  return undefined;\n};\n\nWaveformSegments.prototype.findNextSegment = function(segment) {\n  const sortedSegments = this._getSortedSegments();\n\n  const index = sortedSegments.findIndex(function(s) {\n    return s.id === segment.id;\n  });\n\n  if (index !== -1) {\n    return sortedSegments[index + 1];\n  }\n\n  return undefined;\n};\n\n/**\n * Adds one or more segments to the timeline.\n *\n * @param {SegmentOptions|Array<SegmentOptions>} segmentOrSegments\n *\n * @returns Segment|Array<Segment>\n */\n\nWaveformSegments.prototype.add = function(/* segmentOrSegments */) {\n  const self = this;\n\n  const arrayArgs = Array.isArray(arguments[0]);\n  let segments = arrayArgs ?\n                 arguments[0] :\n                 Array.prototype.slice.call(arguments);\n\n  segments = segments.map(function(segmentOptions) {\n    const segment = self._createSegment(segmentOptions);\n\n    if (objectHasProperty(self._segmentsById, segment.id)) {\n      throw new Error('peaks.segments.add(): duplicate id');\n    }\n\n    return segment;\n  });\n\n  segments.forEach(function(segment) {\n    self._addSegment(segment);\n  });\n\n  this._peaks.emit('segments.add', {\n    segments: segments,\n    insert: this._isInserting\n  });\n\n  return arrayArgs ? segments : segments[0];\n};\n\nWaveformSegments.prototype.updateSegmentId = function(segment, newSegmentId) {\n  if (this._segmentsById[segment.id]) {\n    if (this._segmentsById[newSegmentId]) {\n      throw new Error('segment.update(): duplicate id');\n    }\n    else {\n      delete this._segmentsById[segment.id];\n      this._segmentsById[newSegmentId] = segment;\n    }\n  }\n};\n\n/**\n * Returns the indexes of segments that match the given predicate.\n *\n * @private\n * @param {Function} predicate Predicate function to find matching segments.\n * @returns {Array<Number>} An array of indexes into the segments array of\n *   the matching elements.\n */\n\nWaveformSegments.prototype._findSegment = function(predicate) {\n  const indexes = [];\n\n  for (let i = 0, length = this._segments.length; i < length; i++) {\n    if (predicate(this._segments[i])) {\n      indexes.push(i);\n    }\n  }\n\n  return indexes;\n};\n\n/**\n * Removes the segments at the given array indexes.\n *\n * @private\n * @param {Array<Number>} indexes The array indexes to remove.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype._removeIndexes = function(indexes) {\n  const removed = [];\n\n  for (let i = 0; i < indexes.length; i++) {\n    const index = indexes[i] - removed.length;\n\n    const itemRemoved = this._segments.splice(index, 1)[0];\n\n    delete this._segmentsById[itemRemoved.id];\n    delete this._segmentsByPid[itemRemoved.pid];\n\n    removed.push(itemRemoved);\n  }\n\n  return removed;\n};\n\n/**\n * Removes all segments that match a given predicate function.\n *\n * After removing the segments, this function also emits a\n * <code>segments.remove</code> event with the removed {@link Segment}\n * objects.\n *\n * @private\n * @param {Function} predicate A predicate function that identifies which\n *   segments to remove.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype._removeSegments = function(predicate) {\n  const indexes = this._findSegment(predicate);\n\n  const removed = this._removeIndexes(indexes);\n\n  this._peaks.emit('segments.remove', {\n    segments: removed\n  });\n\n  return removed;\n};\n\n/**\n * Removes the given segment.\n *\n * @param {Segment} segment The segment to remove.\n * @returns {Array<Segment>} The removed segment.\n */\n\nWaveformSegments.prototype.remove = function(segment) {\n  return this._removeSegments(function(s) {\n    return s === segment;\n  });\n};\n\n/**\n * Removes any segments with the given id.\n *\n * @param {String} id\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype.removeById = function(segmentId) {\n  return this._removeSegments(function(segment) {\n    return segment.id === segmentId;\n  });\n};\n\n/**\n * Removes any segments with the given start time, and optional end time.\n *\n * @param {Number} startTime Segments with this start time are removed.\n * @param {Number?} endTime If present, only segments with both the given\n *   start time and end time are removed.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype.removeByTime = function(startTime, endTime) {\n  endTime = (typeof endTime === 'number') ? endTime : 0;\n\n  let filter;\n\n  if (endTime > 0) {\n    filter = function(segment) {\n      return segment.startTime === startTime && segment.endTime === endTime;\n    };\n  }\n  else {\n    filter = function(segment) {\n      return segment.startTime === startTime;\n    };\n  }\n\n  return this._removeSegments(filter);\n};\n\n/**\n * Removes all segments.\n *\n * After removing the segments, this function emits a\n * <code>segments.remove_all</code> event.\n */\n\nWaveformSegments.prototype.removeAll = function() {\n  this._segments = [];\n  this._segmentsById = {};\n  this._segmentsByPid = {};\n  this._peaks.emit('segments.remove_all');\n};\n\nWaveformSegments.prototype.setInserting = function(value) {\n  this._isInserting = value;\n};\n\nWaveformSegments.prototype.isInserting = function() {\n  return this._isInserting;\n};\n\nexport default WaveformSegments;\n","/**\n * @file\n *\n * Defines the {@link KeyboardHandler} class.\n *\n * @module keyboard-handler\n */\n\nconst nodes = ['OBJECT', 'TEXTAREA', 'INPUT', 'SELECT', 'OPTION'];\n\nconst SPACE = 32,\n    TAB = 9,\n    LEFT_ARROW = 37,\n    RIGHT_ARROW = 39;\n\nconst keys = [SPACE, TAB, LEFT_ARROW, RIGHT_ARROW];\n\n/**\n * Configures keyboard event handling.\n *\n * @class\n * @alias KeyboardHandler\n *\n * @param {EventEmitter} eventEmitter\n */\n\nfunction KeyboardHandler(eventEmitter) {\n  this.eventEmitter = eventEmitter;\n\n  this._handleKeyEvent = this._handleKeyEvent.bind(this);\n\n  document.addEventListener('keydown', this._handleKeyEvent);\n  document.addEventListener('keypress', this._handleKeyEvent);\n  document.addEventListener('keyup', this._handleKeyEvent);\n}\n\n/**\n * Keyboard event handler function.\n *\n * @note Arrow keys only triggered on keydown, not keypress.\n *\n * @param {KeyboardEvent} event\n * @private\n */\n\nKeyboardHandler.prototype._handleKeyEvent = function handleKeyEvent(event) {\n  if (nodes.indexOf(event.target.nodeName) === -1) {\n    if (keys.indexOf(event.type) > -1) {\n      event.preventDefault();\n    }\n\n    if (event.type === 'keydown' || event.type === 'keypress') {\n      switch (event.keyCode) {\n        case SPACE:\n          this.eventEmitter.emit('keyboard.space');\n          break;\n\n        case TAB:\n          this.eventEmitter.emit('keyboard.tab');\n          break;\n      }\n    }\n    else if (event.type === 'keyup') {\n      switch (event.keyCode) {\n        case LEFT_ARROW:\n          if (event.shiftKey) {\n            this.eventEmitter.emit('keyboard.shift_left');\n          }\n          else {\n            this.eventEmitter.emit('keyboard.left');\n          }\n          break;\n\n        case RIGHT_ARROW:\n          if (event.shiftKey) {\n            this.eventEmitter.emit('keyboard.shift_right');\n          }\n          else {\n            this.eventEmitter.emit('keyboard.right');\n          }\n          break;\n      }\n    }\n  }\n};\n\nKeyboardHandler.prototype.destroy = function() {\n  document.removeEventListener('keydown', this._handleKeyEvent);\n  document.removeEventListener('keypress', this._handleKeyEvent);\n  document.removeEventListener('keyup', this._handleKeyEvent);\n};\n\nexport default KeyboardHandler;\n","/**\n * @file\n *\n * Implementation of {@link Player} adapter based on an <code>&lt;audio&gt;</code>\n * or <code>&lt;video&gt;</code> HTML element.\n *\n * @module mediaelement-player\n */\n\n/**\n * Checks whether the given HTMLMediaElement has either a src attribute\n * or any child <code>&lt;source&gt;</code> nodes.\n */\n\nfunction mediaElementHasSource(mediaElement) {\n  if (mediaElement.src) {\n    return true;\n  }\n\n  if (mediaElement.querySelector('source')) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * A wrapper for interfacing with the HTMLMediaElement API.\n * Initializes the player for a given media element.\n *\n * @class\n * @alias MediaElementPlayer\n * @param {HTMLMediaElement} mediaElement The HTML <code>&lt;audio&gt;</code>\n *   or <code>&lt;video&gt;</code> element to associate with the\n *   {@link Peaks} instance.\n */\n\nfunction MediaElementPlayer(mediaElement) {\n  this._mediaElement = mediaElement;\n}\n\n/**\n * Adds an event listener to the media element.\n *\n * @private\n * @param {String} type The event type to listen for.\n * @param {Function} callback An event handler function.\n */\n\nMediaElementPlayer.prototype._addMediaListener = function(type, callback) {\n  this._listeners.push({ type: type, callback: callback });\n  this._mediaElement.addEventListener(type, callback);\n};\n\nMediaElementPlayer.prototype.init = function(eventEmitter) {\n  const self = this;\n\n  self._eventEmitter = eventEmitter;\n  self._listeners = [];\n  self._duration = self.getDuration();\n\n  self._addMediaListener('timeupdate', function() {\n    self._eventEmitter.emit('player.timeupdate', self.getCurrentTime());\n  });\n\n  self._addMediaListener('playing', function() {\n    self._eventEmitter.emit('player.playing', self.getCurrentTime());\n  });\n\n  self._addMediaListener('pause', function() {\n    self._eventEmitter.emit('player.pause', self.getCurrentTime());\n  });\n\n  self._addMediaListener('ended', function() {\n    self._eventEmitter.emit('player.ended');\n  });\n\n  self._addMediaListener('seeked', function() {\n    self._eventEmitter.emit('player.seeked', self.getCurrentTime());\n  });\n\n  self._addMediaListener('canplay', function() {\n    self._eventEmitter.emit('player.canplay');\n  });\n\n  self._addMediaListener('error', function(event) {\n    self._eventEmitter.emit('player.error', event.target.error);\n  });\n\n  self._interval = null;\n\n  if (!mediaElementHasSource(self._mediaElement)) {\n    return Promise.resolve();\n  }\n  else if (self._mediaElement.error &&\n           self._mediaElement.error.code === MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED) {\n    // The media element has a source, but the format is not supported.\n    return Promise.reject(self._mediaElement.error);\n  }\n\n  return new Promise(function(resolve, reject) {\n    function eventHandler(event) {\n      self._mediaElement.removeEventListener('loadedmetadata', eventHandler);\n      self._mediaElement.removeEventListener('error', eventHandler);\n\n      if (event.type === 'loadedmetadata') {\n        resolve();\n      }\n      else {\n        reject(event.target.error);\n      }\n    }\n\n    // If the media element has preload=\"none\", clicking to seek in the\n    // waveform won't work, so here we force the media to load.\n    if (self._mediaElement.readyState === HTMLMediaElement.HAVE_NOTHING) {\n      // Wait for the readyState to change to HAVE_METADATA so we know the\n      // duration is valid, otherwise it could be NaN.\n      self._mediaElement.addEventListener('loadedmetadata', eventHandler);\n      self._mediaElement.addEventListener('error', eventHandler);\n      self._mediaElement.load();\n    }\n    else {\n      resolve();\n    }\n  });\n};\n\n/**\n * Cleans up the player object, removing all event listeners from the\n * associated media element.\n */\n\nMediaElementPlayer.prototype.destroy = function() {\n  for (let i = 0; i < this._listeners.length; i++) {\n    const listener = this._listeners[i];\n\n    this._mediaElement.removeEventListener(\n      listener.type,\n      listener.callback\n    );\n  }\n\n  this._listeners.length = 0;\n\n  this._mediaElement = null;\n};\n\nMediaElementPlayer.prototype.play = function() {\n  return this._mediaElement.play();\n};\n\nMediaElementPlayer.prototype.pause = function() {\n  this._mediaElement.pause();\n};\n\nMediaElementPlayer.prototype.isPlaying = function() {\n  return !this._mediaElement.paused;\n};\n\nMediaElementPlayer.prototype.isSeeking = function() {\n  return this._mediaElement.seeking;\n};\n\nMediaElementPlayer.prototype.getCurrentTime = function() {\n  return this._mediaElement.currentTime;\n};\n\nMediaElementPlayer.prototype.getDuration = function() {\n  return this._mediaElement.duration;\n};\n\nMediaElementPlayer.prototype.seek = function(time) {\n  this._mediaElement.currentTime = time;\n};\n\nfunction SetSourceHandler(eventEmitter, mediaElement) {\n  this._eventEmitter = eventEmitter;\n  this._mediaElement = mediaElement;\n  this._playerCanPlayHandler = this._playerCanPlayHandler.bind(this);\n  this._playerErrorHandler = this._playerErrorHandler.bind(this);\n}\n\nSetSourceHandler.prototype.setSource = function(options, callback) {\n  const self = this;\n\n  self._options = options;\n  self._callback = callback;\n\n  self._eventEmitter.on('player.canplay', self._playerCanPlayHandler);\n  self._eventEmitter.on('player.error', self._playerErrorHandler);\n\n  return new Promise(function(resolve, reject) {\n    self._resolve = resolve;\n    self._reject = reject;\n\n    self._eventEmitter.on('player.canplay', self._playerCanPlayHandler);\n    self._eventEmitter.on('player.error', self._playerErrorHandler);\n\n    self._mediaElement.setAttribute('src', options.mediaUrl);\n\n    // Force the media element to load, in case the media element\n    // has preload=\"none\".\n    if (self._mediaElement.readyState === HTMLMediaElement.HAVE_NOTHING) {\n      self._mediaElement.load();\n    }\n  });\n};\n\nSetSourceHandler.prototype._reset = function() {\n  this._eventEmitter.removeListener('player.canplay', this._playerCanPlayHandler);\n  this._eventEmitter.removeListener('player.error', this._playerErrorHandler);\n};\n\nSetSourceHandler.prototype._playerCanPlayHandler = function() {\n  this._reset();\n\n  this._resolve();\n};\n\nSetSourceHandler.prototype._playerErrorHandler = function(err) {\n  this._reset();\n\n  // Return the MediaError object from the media element\n  this._reject(err);\n};\n\nMediaElementPlayer.prototype.setSource = function(options) {\n  if (!options.mediaUrl) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    return Promise.reject(new Error('peaks.setSource(): options must contain a mediaUrl when using mediaElement'));\n  }\n\n  const setSourceHandler = new SetSourceHandler(this._eventEmitter, this._mediaElement);\n\n  return setSourceHandler.setSource(options);\n};\n\nexport default MediaElementPlayer;\n","/**\n * @file\n *\n * A general audio player class which interfaces with external audio players.\n * The default audio player in Peaks.js is {@link MediaElementPlayer}.\n *\n * @module player\n */\n\nimport { isValidTime } from './utils';\n\nfunction getAllPropertiesFrom(adapter) {\n  const allProperties = [];\n  let obj = adapter;\n\n  while (obj) {\n    Object.getOwnPropertyNames(obj).forEach(function(p) {\n      allProperties.push(p);\n    });\n\n    obj = Object.getPrototypeOf(obj);\n  }\n\n  return allProperties;\n}\n\nfunction validateAdapter(adapter) {\n  const publicAdapterMethods = [\n    'init',\n    'destroy',\n    'play',\n    'pause',\n    'isPlaying',\n    'isSeeking',\n    'getCurrentTime',\n    'getDuration',\n    'seek'\n  ];\n\n  const allProperties = getAllPropertiesFrom(adapter);\n\n  publicAdapterMethods.forEach(function(method) {\n    if (!allProperties.includes(method)) {\n      throw new TypeError('Peaks.init(): Player method ' + method + ' is undefined');\n    }\n\n    if ((typeof adapter[method]) !== 'function') {\n      throw new TypeError('Peaks.init(): Player method ' + method + ' is not a function');\n    }\n  });\n}\n\n/**\n * A wrapper for interfacing with an external player API.\n *\n * @class\n * @alias Player\n *\n * @param {Peaks} peaks The parent {@link Peaks} object.\n * @param {Adapter} adapter The player adapter.\n */\n\nfunction Player(peaks, adapter) {\n  this._peaks = peaks;\n\n  this._playingSegment = false;\n  this._segment = null;\n  this._loop = false;\n  this._playSegmentTimerCallback = this._playSegmentTimerCallback.bind(this);\n\n  validateAdapter(adapter);\n  this._adapter = adapter;\n}\n\nPlayer.prototype.init = function() {\n  return this._adapter.init(this._peaks);\n};\n\n/**\n * Cleans up the player object.\n */\n\nPlayer.prototype.destroy = function() {\n  this._adapter.destroy();\n};\n\n/**\n * Starts playback.\n * @returns {Promise}\n */\n\nPlayer.prototype.play = function() {\n  return this._adapter.play();\n};\n\n/**\n * Pauses playback.\n */\n\nPlayer.prototype.pause = function() {\n  this._adapter.pause();\n};\n\n/**\n * @returns {Boolean} <code>true</code> if playing, <code>false</code>\n * otherwise.\n */\n\nPlayer.prototype.isPlaying = function() {\n  return this._adapter.isPlaying();\n};\n\n/**\n * @returns {boolean} <code>true</code> if seeking\n */\n\nPlayer.prototype.isSeeking = function() {\n  return this._adapter.isSeeking();\n};\n\n/**\n * Returns the current playback time position, in seconds.\n *\n * @returns {Number}\n */\n\nPlayer.prototype.getCurrentTime = function() {\n  return this._adapter.getCurrentTime();\n};\n\n/**\n * Returns the media duration, in seconds.\n *\n * @returns {Number}\n */\n\nPlayer.prototype.getDuration = function() {\n  return this._adapter.getDuration();\n};\n\n/**\n * Seeks to a given time position within the media.\n *\n * @param {Number} time The time position, in seconds.\n */\n\nPlayer.prototype.seek = function(time) {\n  if (!isValidTime(time)) {\n    this._peaks._logger('peaks.player.seek(): parameter must be a valid time, in seconds');\n    return;\n  }\n\n  this._adapter.seek(time);\n};\n\n/**\n * Plays the given segment.\n *\n * @param {Segment} segment The segment denoting the time region to play.\n * @param {Boolean} loop If true, playback is looped.\n */\n\nPlayer.prototype.playSegment = function(segment, loop) {\n  const self = this;\n\n  if (!segment ||\n    !isValidTime(segment.startTime) ||\n    !isValidTime(segment.endTime)) {\n    return Promise.reject(\n      new Error('peaks.player.playSegment(): parameter must be a segment object')\n    );\n  }\n\n  self._segment = segment;\n  self._loop = loop;\n\n  // Set audio time to segment start time\n  self.seek(segment.startTime);\n\n  self._peaks.once('player.playing', function() {\n    if (!self._playingSegment) {\n      self._playingSegment = true;\n\n      // We need to use requestAnimationFrame here as the timeupdate event\n      // doesn't fire often enough.\n      window.requestAnimationFrame(self._playSegmentTimerCallback);\n    }\n  });\n\n  // Start playing audio\n  return self.play();\n};\n\nPlayer.prototype._playSegmentTimerCallback = function() {\n  if (!this.isPlaying()) {\n    this._playingSegment = false;\n    return;\n  }\n  else if (this.getCurrentTime() >= this._segment.endTime) {\n    if (this._loop) {\n      this.seek(this._segment.startTime);\n    }\n    else {\n      this.pause();\n      this._peaks.emit('player.ended');\n      this._playingSegment = false;\n      return;\n    }\n  }\n\n  window.requestAnimationFrame(this._playSegmentTimerCallback);\n};\n\nPlayer.prototype._setSource = function(options) {\n  return this._adapter.setSource(options);\n};\n\nexport default Player;\n","/**\n * @file\n *\n * Defines the {@link DefaultPointMarker} class.\n *\n * @module default-point-marker\n */\n\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a point marker handle.\n *\n * @class\n * @alias DefaultPointMarker\n *\n * @param {CreatePointMarkerOptions} options\n */\n\nfunction DefaultPointMarker(options) {\n  this._options = options;\n  this._draggable = options.editable;\n}\n\nDefaultPointMarker.prototype.init = function(group) {\n  const handleWidth  = 10;\n  const handleHeight = 20;\n  const handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  // Label\n\n  if (this._options.view === 'zoomview') {\n    // Label - create with default y, the real value is set in fitToView().\n    this._label = new Text({\n      x:          2,\n      y:          0,\n      text:       this._options.point.labelText,\n      textAlign:  'left',\n      fontFamily: this._options.fontFamily || 'sans-serif',\n      fontSize:   this._options.fontSize || 10,\n      fontStyle:  this._options.fontStyle || 'normal',\n      fill:       '#000'\n    });\n  }\n\n  // Handle - create with default y, the real value is set in fitToView().\n\n  this._handle = new Rect({\n    x:       handleX,\n    y:       0,\n    width:   handleWidth,\n    height:  handleHeight,\n    fill:    this._options.color,\n    visible: this._draggable\n  });\n\n  // Line - create with default y and points, the real values\n  // are set in fitToView().\n  this._line = new Line({\n    x:           0,\n    y:           0,\n    stroke:      this._options.color,\n    strokeWidth: 1\n  });\n\n  // Time label - create with default y, the real value is set\n  // in fitToView().\n  this._time = new Text({\n    x:          -24,\n    y:          0,\n    text:       this._options.layer.formatTime(this._options.point.time),\n    fontFamily: this._options.fontFamily,\n    fontSize:   this._options.fontSize,\n    fontStyle:  this._options.fontStyle,\n    fill:       '#000',\n    textAlign:  'center'\n  });\n\n  this._time.hide();\n\n  group.add(this._handle);\n\n  group.add(this._line);\n\n  if (this._label) {\n    group.add(this._label);\n  }\n\n  group.add(this._time);\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nDefaultPointMarker.prototype.bindEventHandlers = function(group) {\n  const self = this;\n\n  self._handle.on('mouseover touchstart', function() {\n    if (self._draggable) {\n      // Position text to the left of the marker\n      self._time.setX(-24 - self._time.getWidth());\n      self._time.show();\n    }\n  });\n\n  self._handle.on('mouseout touchend', function() {\n    if (self._draggable) {\n      self._time.hide();\n    }\n  });\n\n  group.on('dragstart', function() {\n    self._time.setX(-24 - self._time.getWidth());\n    self._time.show();\n  });\n\n  group.on('dragend', function() {\n    self._time.hide();\n  });\n};\n\nDefaultPointMarker.prototype.fitToView = function() {\n  const height = this._options.layer.getHeight();\n\n  this._line.points([0.5, 0, 0.5, height]);\n\n  if (this._label) {\n    this._label.y(12);\n  }\n\n  if (this._handle) {\n    this._handle.y(height / 2 - 10.5);\n  }\n\n  if (this._time) {\n    this._time.y(height / 2 - 5);\n  }\n};\n\nDefaultPointMarker.prototype.update = function(options) {\n  if (options.time !== undefined) {\n    if (this._time) {\n      this._time.setText(this._options.layer.formatTime(options.time));\n    }\n  }\n\n  if (options.labelText !== undefined) {\n    if (this._label) {\n      this._label.text(options.labelText);\n    }\n  }\n\n  if (options.color !== undefined) {\n    if (this._handle) {\n      this._handle.fill(options.color);\n    }\n\n    this._line.stroke(options.color);\n  }\n\n  if (options.editable !== undefined) {\n    this._draggable = options.editable;\n\n    this._handle.visible(this._draggable);\n  }\n};\n\nexport default DefaultPointMarker;\n","/**\n * @file\n *\n * Defines the {@link DefaultSegmentMarker} class.\n *\n * @module default-segment-marker\n */\n\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a segment marker handle.\n *\n * @class\n * @alias DefaultSegmentMarker\n *\n * @param {CreateSegmentMarkerOptions} options\n */\n\nfunction DefaultSegmentMarker(options) {\n  this._options = options;\n  this._editable = options.editable;\n}\n\nDefaultSegmentMarker.prototype.init = function(group) {\n  const handleWidth  = 10;\n  const handleHeight = 20;\n  const handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  const xPosition = this._options.startMarker ? -24 : 24;\n\n  const time = this._options.startMarker ? this._options.segment.startTime :\n                                           this._options.segment.endTime;\n\n  // Label - create with default y, the real value is set in fitToView().\n  this._label = new Text({\n    x:          xPosition,\n    y:          0,\n    text:       this._options.layer.formatTime(time),\n    fontFamily: this._options.fontFamily,\n    fontSize:   this._options.fontSize,\n    fontStyle:  this._options.fontStyle,\n    fill:       '#000',\n    textAlign:  'center',\n    visible:    this._editable\n  });\n\n  this._label.hide();\n\n  // Handle - create with default y, the real value is set in fitToView().\n  this._handle = new Rect({\n    x:           handleX,\n    y:           0,\n    width:       handleWidth,\n    height:      handleHeight,\n    fill:        this._options.color,\n    stroke:      this._options.color,\n    strokeWidth: 1,\n    visible:     this._editable\n  });\n\n  // Vertical Line - create with default y and points, the real values\n  // are set in fitToView().\n  this._line = new Line({\n    x:           0,\n    y:           0,\n    stroke:      this._options.color,\n    strokeWidth: 1,\n    visible:     this._editable\n  });\n\n  group.add(this._label);\n  group.add(this._line);\n  group.add(this._handle);\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nDefaultSegmentMarker.prototype.bindEventHandlers = function(group) {\n  const self = this;\n\n  const xPosition = self._options.startMarker ? -24 : 24;\n\n  group.on('dragstart', function() {\n    if (self._options.startMarker) {\n      self._label.setX(xPosition - self._label.getWidth());\n    }\n\n    self._label.show();\n  });\n\n  group.on('dragend', function() {\n    self._label.hide();\n  });\n\n  self._handle.on('mouseover touchstart', function() {\n    if (self._options.startMarker) {\n      self._label.setX(xPosition - self._label.getWidth());\n    }\n\n    self._label.show();\n  });\n\n  self._handle.on('mouseout touchend', function() {\n    self._label.hide();\n  });\n};\n\nDefaultSegmentMarker.prototype.fitToView = function() {\n  const height = this._options.layer.getHeight();\n\n  this._label.y(height / 2 - 5);\n  this._handle.y(height / 2 - 10.5);\n  this._line.points([0.5, 0, 0.5, height]);\n};\n\nDefaultSegmentMarker.prototype.update = function(options) {\n  if (options.startTime !== undefined && this._options.startMarker) {\n    this._label.text(this._options.layer.formatTime(options.startTime));\n  }\n\n  if (options.endTime !== undefined && !this._options.startMarker) {\n    this._label.text(this._options.layer.formatTime(options.endTime));\n  }\n\n  if (options.editable !== undefined) {\n    this._editable = options.editable;\n\n    this._label.visible(this._editable);\n    this._handle.visible(this._editable);\n    this._line.visible(this._editable);\n  }\n};\n\nexport default DefaultSegmentMarker;\n","/**\n * @file\n *\n * Factory functions for creating point and segment marker handles.\n *\n * @module marker-factories\n */\n\nimport DefaultPointMarker from './default-point-marker';\nimport DefaultSegmentMarker from './default-segment-marker';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Parameters for the {@link createSegmentMarker} function.\n *\n * @typedef {Object} CreateSegmentMarkerOptions\n * @global\n * @property {Segment} segment\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Boolean} startMarker\n * @property {String} color\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n * @property {Layer} layer\n * @property {String} view\n * @property {SegmentDisplayOptions} segmentOptions\n */\n\n/**\n * Creates a left or right side segment marker handle.\n *\n * @param {CreateSegmentMarkerOptions} options\n * @returns {Marker}\n */\n\nexport function createSegmentMarker(options) {\n  if (options.view === 'zoomview') {\n    return new DefaultSegmentMarker(options);\n  }\n\n  return null;\n}\n\n/**\n * Parameters for the {@link createSegmentLabel} function.\n *\n * @typedef {Object} SegmentLabelOptions\n * @global\n * @property {Segment} segment The {@link Segment} object associated with this\n *   label.\n * @property {String} view The name of the view that the label is being\n *   created in, either <code>zoomview</code> or <code>overview</code>.\n * @property {SegmentsLayer} layer\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n */\n\n/**\n * Creates a Konva object that renders information about a segment, such as\n * its label text.\n *\n * @param {SegmentLabelOptions} options\n * @returns {Konva.Text}\n */\n\nexport function createSegmentLabel(options) {\n  return new Text({\n    x:          12,\n    y:          12,\n    text:       options.segment.labelText,\n    textAlign:  'center',\n    fontFamily: options.fontFamily || 'sans-serif',\n    fontSize:   options.fontSize || 12,\n    fontStyle:  options.fontStyle || 'normal',\n    fill:       '#000'\n  });\n}\n\n/**\n * Parameters for the {@link createPointMarker} function.\n *\n * @typedef {Object} CreatePointMarkerOptions\n * @global\n * @property {Point} point\n * @property {Boolean} editable If true, marker is draggable.\n * @property {String} color\n * @property {Layer} layer\n * @property {String} view\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n */\n\n/**\n * Creates a point marker handle.\n *\n * @param {CreatePointMarkerOptions} options\n * @returns {Marker}\n */\n\nexport function createPointMarker(options) {\n  return new DefaultPointMarker(options);\n}\n","/**\n * @file\n *\n * Defines the {@link HighlightLayer} class.\n *\n * @module highlight-layer\n */\n\nimport Konva from 'konva/lib/Core';\nimport { Rect } from 'konva/lib/shapes/Rect';\n\nimport { clamp } from  './utils';\n\n/**\n * Highlight layer options\n *\n * @typedef {Object} HighlightLayerOptions\n * @global\n * @property {Number} highlightOffset\n * @property {String} highlightColor\n * @property {String} highlightStrokeColor\n * @property {Number} highlightOpacity\n * @property {Number} highlightCornerRadius\n */\n\n/**\n * Creates the highlight region that shows the position of the zoomable\n * waveform view in the overview waveform.\n *\n * @class\n * @alias HighlightLayer\n *\n * @param {WaveformOverview} view\n * @param {HighlightLayerOptions} options\n */\n\nfunction HighlightLayer(view, options) {\n  this._view          = view;\n  this._offset        = options.highlightOffset;\n  this._color         = options.highlightColor;\n  this._layer         = new Konva.Layer({ listening: false });\n  this._highlightRect = null;\n  this._startTime     = null;\n  this._endTime       = null;\n  this._strokeColor   = options.highlightStrokeColor;\n  this._opacity       = options.highlightOpacity;\n  this._cornerRadius  = options.highlightCornerRadius;\n}\n\nHighlightLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nHighlightLayer.prototype.showHighlight = function(startTime, endTime) {\n  if (!this._highlightRect) {\n    this._createHighlightRect(startTime, endTime);\n  }\n\n  this._update(startTime, endTime);\n};\n\n/**\n * Updates the position of the highlight region.\n *\n * @param {Number} startTime The start of the highlight region, in seconds.\n * @param {Number} endTime The end of the highlight region, in seconds.\n */\n\nHighlightLayer.prototype._update = function(startTime, endTime) {\n  this._startTime = startTime;\n  this._endTime = endTime;\n\n  const startOffset = this._view.timeToPixels(startTime);\n  const endOffset   = this._view.timeToPixels(endTime);\n\n  this._highlightRect.setAttrs({\n    x:     startOffset,\n    width: endOffset - startOffset\n  });\n};\n\nHighlightLayer.prototype._createHighlightRect = function(startTime, endTime) {\n  this._startTime = startTime;\n  this._endTime   = endTime;\n\n  const startOffset = this._view.timeToPixels(startTime);\n  const endOffset   = this._view.timeToPixels(endTime);\n\n  // Create with default y and height, the real values are set in fitToView().\n  this._highlightRect = new Rect({\n    x:            startOffset,\n    y:            0,\n    width:        endOffset - startOffset,\n    height:       0,\n    stroke:       this._strokeColor,\n    strokeWidth:  1,\n    fill:         this._color,\n    opacity:      this._opacity,\n    cornerRadius: this._cornerRadius\n  });\n\n  this.fitToView();\n\n  this._layer.add(this._highlightRect);\n};\n\nHighlightLayer.prototype.removeHighlight = function() {\n  if (this._highlightRect) {\n    this._highlightRect.destroy();\n    this._highlightRect = null;\n  }\n};\n\nHighlightLayer.prototype.updateHighlight = function() {\n  if (this._highlightRect) {\n    this._update(this._startTime, this._endTime);\n  }\n};\n\nHighlightLayer.prototype.fitToView = function() {\n  if (this._highlightRect) {\n    const height = this._view.getHeight();\n    const offset = clamp(this._offset, 0, Math.floor(height / 2));\n\n    this._highlightRect.setAttrs({\n      y: offset,\n      height: height - (offset * 2)\n    });\n  }\n};\n\nexport default HighlightLayer;\n","/**\n * @file\n *\n * Defines the {@link PointMarker} class.\n *\n * @module point-marker\n */\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Parameters for the {@link PointMarker} constructor.\n *\n * @typedef {Object} PointMarkerOptions\n * @global\n * @property {Point} point Point object with timestamp.\n * @property {Boolean} editable If true, marker is draggable.\n * @property {Marker} marker\n * @property {Function} onclick\n * @property {Function} onDblClick\n * @property {Function} onDragStart\n * @property {Function} onDragMove Callback during mouse drag operations.\n * @property {Function} onDragEnd\n * @property {Function} dragBoundFunc\n * @property {Function} onMouseEnter\n * @property {Function} onMouseLeave\n * @property {Function} onContextMenu\n */\n\n/**\n * Creates a point marker handle.\n *\n * @class\n * @alias PointMarker\n *\n * @param {PointMarkerOptions} options\n */\n\nfunction PointMarker(options) {\n  this._point     = options.point;\n  this._marker    = options.marker;\n  this._draggable = options.draggable;\n\n  this._onDragStart   = options.onDragStart;\n  this._onDragMove    = options.onDragMove;\n  this._onDragEnd     = options.onDragEnd;\n  this._dragBoundFunc = options.dragBoundFunc;\n  this._onMouseEnter  = options.onMouseEnter;\n  this._onMouseLeave  = options.onMouseLeave;\n\n  this._group = new Konva.Group({\n    name:          'point-marker',\n    point:         this._point,\n    draggable:     this._draggable,\n    dragBoundFunc: options.dragBoundFunc\n  });\n\n  this._bindDefaultEventHandlers();\n\n  this._marker.init(this._group);\n}\n\nPointMarker.prototype._bindDefaultEventHandlers = function() {\n  const self = this;\n\n  self._group.on('dragstart', function(event) {\n    self._onDragStart(event, self._point);\n  });\n\n  self._group.on('dragmove', function(event) {\n    self._onDragMove(event, self._point);\n  });\n\n  self._group.on('dragend', function(event) {\n    self._onDragEnd(event, self._point);\n  });\n\n  self._group.on('mouseenter', function(event) {\n    self._onMouseEnter(event, self._point);\n  });\n\n  self._group.on('mouseleave', function(event) {\n    self._onMouseLeave(event, self._point);\n  });\n};\n\n/**\n * @param {Konva.Layer} layer\n */\n\nPointMarker.prototype.addToLayer = function(layer) {\n  layer.add(this._group);\n};\n\nPointMarker.prototype.fitToView = function() {\n  this._marker.fitToView();\n};\n\nPointMarker.prototype.getPoint = function() {\n  return this._point;\n};\n\nPointMarker.prototype.getX = function() {\n  return this._group.getX();\n};\n\nPointMarker.prototype.setX = function(x) {\n  this._group.setX(x);\n};\n\nPointMarker.prototype.getWidth = function() {\n  return this._group.getWidth();\n};\n\nPointMarker.prototype.getAbsolutePosition = function() {\n  return this._group.getAbsolutePosition();\n};\n\nPointMarker.prototype.update = function(options) {\n  if (options.editable !== undefined) {\n    this._group.draggable(options.editable);\n  }\n\n  if (this._marker.update) {\n    this._marker.update(options);\n  }\n};\n\nPointMarker.prototype.destroy = function() {\n  if (this._marker.destroy) {\n    this._marker.destroy();\n  }\n\n  this._group.destroyChildren();\n  this._group.destroy();\n};\n\nexport default PointMarker;\n","/**\n * @file\n *\n * Defines the {@link PointsLayer} class.\n *\n * @module points-layer\n */\n\nimport PointMarker from './point-marker';\nimport { clamp, objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates a Konva.Layer that displays point markers against the audio\n * waveform.\n *\n * @class\n * @alias PointsLayer\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Boolean} enableEditing\n */\n\nfunction PointsLayer(peaks, view, enableEditing) {\n  this._peaks         = peaks;\n  this._view          = view;\n  this._enableEditing = enableEditing;\n  this._pointMarkers  = {};\n  this._layer         = new Konva.Layer();\n\n  this._onPointsDrag = this._onPointsDrag.bind(this);\n\n  this._onPointMarkerDragStart   = this._onPointMarkerDragStart.bind(this);\n  this._onPointMarkerDragMove    = this._onPointMarkerDragMove.bind(this);\n  this._onPointMarkerDragEnd     = this._onPointMarkerDragEnd.bind(this);\n  this._pointMarkerDragBoundFunc = this._pointMarkerDragBoundFunc.bind(this);\n  this._onPointMarkerMouseEnter  = this._onPointMarkerMouseEnter.bind(this);\n  this._onPointMarkerMouseLeave  = this._onPointMarkerMouseLeave.bind(this);\n\n  this._onPointsUpdate    = this._onPointsUpdate.bind(this);\n  this._onPointsAdd       = this._onPointsAdd.bind(this);\n  this._onPointsRemove    = this._onPointsRemove.bind(this);\n  this._onPointsRemoveAll = this._onPointsRemoveAll.bind(this);\n\n  this._peaks.on('points.update', this._onPointsUpdate);\n  this._peaks.on('points.add', this._onPointsAdd);\n  this._peaks.on('points.remove', this._onPointsRemove);\n  this._peaks.on('points.remove_all', this._onPointsRemoveAll);\n\n  this._peaks.on('points.dragstart', this._onPointsDrag);\n  this._peaks.on('points.dragmove', this._onPointsDrag);\n  this._peaks.on('points.dragend', this._onPointsDrag);\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nPointsLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nPointsLayer.prototype.setListening = function(listening) {\n  this._layer.listening(listening);\n};\n\nPointsLayer.prototype.enableEditing = function(enable) {\n  this._enableEditing = enable;\n};\n\nPointsLayer.prototype.getPointMarker = function(point) {\n  return this._pointMarkers[point.pid];\n};\n\nPointsLayer.prototype.formatTime = function(time) {\n  return this._view.formatTime(time);\n};\n\nPointsLayer.prototype._onPointsUpdate = function(point, options) {\n  const frameStartTime = this._view.getStartTime();\n  const frameEndTime   = this._view.getEndTime();\n\n  const pointMarker = this.getPointMarker(point);\n  const isVisible = point.isVisible(frameStartTime, frameEndTime);\n\n  if (pointMarker && !isVisible) {\n    // Remove point marker that is no longer visible.\n    this._removePoint(point);\n  }\n  else if (!pointMarker && isVisible) {\n    // Add point marker for visible point.\n    this._updatePoint(point);\n  }\n  else if (pointMarker && isVisible) {\n    // Update the point marker with the changed attributes.\n    if (objectHasProperty(options, 'time')) {\n      const pointMarkerOffset = this._view.timeToPixels(point.time);\n\n      const pointMarkerX = pointMarkerOffset - this._view.getFrameOffset();\n\n      pointMarker.setX(pointMarkerX);\n    }\n\n    pointMarker.update(options);\n  }\n};\n\nPointsLayer.prototype._onPointsAdd = function(event) {\n  const self = this;\n\n  const frameStartTime = self._view.getStartTime();\n  const frameEndTime   = self._view.getEndTime();\n\n  event.points.forEach(function(point) {\n    if (point.isVisible(frameStartTime, frameEndTime)) {\n      self._updatePoint(point);\n    }\n  });\n};\n\nPointsLayer.prototype._onPointsRemove = function(event) {\n  const self = this;\n\n  event.points.forEach(function(point) {\n    self._removePoint(point);\n  });\n};\n\nPointsLayer.prototype._onPointsRemoveAll = function() {\n  this._layer.removeChildren();\n  this._pointMarkers = {};\n};\n\n/**\n * Creates the Konva UI objects for a given point.\n *\n * @private\n * @param {Point} point\n * @returns {PointMarker}\n */\n\nPointsLayer.prototype._createPointMarker = function(point) {\n  const editable = this._enableEditing && point.editable;\n  const viewOptions = this._view.getViewOptions();\n\n  const marker = this._peaks.options.createPointMarker({\n    point:      point,\n    editable:   editable,\n    color:      point.color,\n    fontFamily: viewOptions.fontFamily,\n    fontSize:   viewOptions.fontSize,\n    fontStyle:  viewOptions.fontStyle,\n    layer:      this,\n    view:       this._view.getName()\n  });\n\n  return new PointMarker({\n    point:         point,\n    draggable:     editable,\n    marker:        marker,\n    onDragStart:   this._onPointMarkerDragStart,\n    onDragMove:    this._onPointMarkerDragMove,\n    onDragEnd:     this._onPointMarkerDragEnd,\n    dragBoundFunc: this._pointMarkerDragBoundFunc,\n    onMouseEnter:  this._onPointMarkerMouseEnter,\n    onMouseLeave:  this._onPointMarkerMouseLeave\n  });\n};\n\nPointsLayer.prototype.getHeight = function() {\n  return this._view.getHeight();\n};\n\n/**\n * Adds a Konva UI object to the layer for a given point.\n *\n * @private\n * @param {Point} point\n * @returns {PointMarker}\n */\n\nPointsLayer.prototype._addPointMarker = function(point) {\n  const pointMarker = this._createPointMarker(point);\n\n  this._pointMarkers[point.pid] = pointMarker;\n\n  pointMarker.addToLayer(this._layer);\n\n  return pointMarker;\n};\n\nPointsLayer.prototype._onPointsDrag = function(event) {\n  const pointMarker = this._updatePoint(event.point);\n\n  pointMarker.update({ time: event.point.time });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerMouseEnter = function(event, point) {\n  this._peaks.emit('points.mouseenter', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerMouseLeave = function(event, point) {\n  this._peaks.emit('points.mouseleave', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerDragStart = function(event, point) {\n  this._dragPointMarker = this.getPointMarker(point);\n\n  this._peaks.emit('points.dragstart', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerDragMove = function(event, point) {\n  const pointMarker = this._pointMarkers[point.pid];\n\n  const markerX = pointMarker.getX();\n\n  const offset = markerX + pointMarker.getWidth();\n\n  point._setTime(this._view.pixelOffsetToTime(offset));\n\n  this._peaks.emit('points.dragmove', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerDragEnd = function(event, point) {\n  this._dragPointMarker = null;\n\n  this._peaks.emit('points.dragend', {\n    point: point,\n    evt: event.evt\n  });\n};\n\nPointsLayer.prototype._pointMarkerDragBoundFunc = function(pos) {\n  // Allow the marker to be moved horizontally but not vertically.\n  return {\n    x: clamp(pos.x, 0, this._view.getWidth()),\n    y: this._dragPointMarker.getAbsolutePosition().y\n  };\n};\n\n/**\n * Updates the positions of all displayed points in the view.\n *\n * @param {Number} startTime The start of the visible range in the view,\n *   in seconds.\n * @param {Number} endTime The end of the visible range in the view,\n *   in seconds.\n */\n\nPointsLayer.prototype.updatePoints = function(startTime, endTime) {\n  // Update all points in the visible time range.\n  const points = this._peaks.points.find(startTime, endTime);\n\n  points.forEach(this._updatePoint.bind(this));\n\n  // TODO: In the overview all points are visible, so no need to do this.\n  this._removeInvisiblePoints(startTime, endTime);\n};\n\n/**\n * @private\n * @param {Point} point\n */\n\nPointsLayer.prototype._updatePoint = function(point) {\n  let pointMarker = this.getPointMarker(point);\n\n  if (!pointMarker) {\n    pointMarker = this._addPointMarker(point);\n  }\n\n  const pointMarkerOffset = this._view.timeToPixels(point.time);\n  const pointMarkerX = pointMarkerOffset - this._view.getFrameOffset();\n\n  pointMarker.setX(pointMarkerX);\n\n  return pointMarker;\n};\n\n/**\n * Remove any points that are not visible, i.e., are outside the given time\n * range.\n *\n * @private\n * @param {Number} startTime The start of the visible time range, in seconds.\n * @param {Number} endTime The end of the visible time range, in seconds.\n */\n\nPointsLayer.prototype._removeInvisiblePoints = function(startTime, endTime) {\n  for (const pointPid in this._pointMarkers) {\n    if (objectHasProperty(this._pointMarkers, pointPid)) {\n      const point = this._pointMarkers[pointPid].getPoint();\n\n      if (!point.isVisible(startTime, endTime)) {\n        this._removePoint(point);\n      }\n    }\n  }\n};\n\n/**\n * Removes the UI object for a given point.\n *\n * @private\n * @param {Point} point\n */\n\nPointsLayer.prototype._removePoint = function(point) {\n  const pointMarker = this.getPointMarker(point);\n\n  if (pointMarker) {\n    pointMarker.destroy();\n    delete this._pointMarkers[point.pid];\n  }\n};\n\n/**\n * Toggles visibility of the points layer.\n *\n * @param {Boolean} visible\n */\n\nPointsLayer.prototype.setVisible = function(visible) {\n  this._layer.setVisible(visible);\n};\n\nPointsLayer.prototype.destroy = function() {\n  this._peaks.off('points.update', this._onPointsUpdate);\n  this._peaks.off('points.add', this._onPointsAdd);\n  this._peaks.off('points.remove', this._onPointsRemove);\n  this._peaks.off('points.remove_all', this._onPointsRemoveAll);\n  this._peaks.off('points.dragstart', this._onPointsDrag);\n  this._peaks.off('points.dragmove', this._onPointsDrag);\n  this._peaks.off('points.dragend', this._onPointsDrag);\n};\n\nPointsLayer.prototype.fitToView = function() {\n  for (const pointPid in this._pointMarkers) {\n    if (objectHasProperty(this._pointMarkers, pointPid)) {\n      const pointMarker = this._pointMarkers[pointPid];\n\n      pointMarker.fitToView();\n    }\n  }\n};\n\nPointsLayer.prototype.draw = function() {\n  this._layer.draw();\n};\n\nexport default PointsLayer;\n","/**\n * @file\n *\n * Defines the {@link PlayheadLayer} class.\n *\n * @module playhead-layer\n */\n\nimport Konva from 'konva/lib/Core';\nimport { Animation } from 'konva/lib/Animation';\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a Konva.Layer that displays a playhead marker.\n *\n * @class\n * @alias PlayheadLayer\n *\n * @param {Player} player\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Object} options\n * @param {Boolean} options.showPlayheadTime If <code>true</code> The playback time position\n *   is shown next to the playhead.\n * @param {String} options.playheadColor\n * @param {String} options.playheadTextColor\n * @param {String} options.playheadBackgroundColor\n * @param {Number} options.playheadPadding\n * @param {Number} options.playheadWidth\n * @param {String} options.playheadFontFamily\n * @param {Number} options.playheadFontSize\n * @param {String} options.playheadFontStyle\n */\n\nfunction PlayheadLayer(player, view, options) {\n  this._player = player;\n  this._view = view;\n  this._playheadPixel = 0;\n  this._playheadLineAnimation = null;\n  this._playheadVisible = false;\n  this._playheadColor = options.playheadColor;\n  this._playheadTextColor = options.playheadTextColor;\n  this._playheadBackgroundColor = options.playheadBackgroundColor;\n  this._playheadPadding = options.playheadPadding;\n  this._playheadWidth = options.playheadWidth;\n\n  this._playheadFontFamily = options.playheadFontFamily;\n  this._playheadFontSize = options.playheadFontSize;\n  this._playheadFontStyle = options.playheadFontStyle;\n\n  this._playheadLayer = new Konva.Layer({ listening: false });\n\n  this._createPlayhead();\n\n  if (options.showPlayheadTime) {\n    this._createPlayheadText();\n  }\n\n  this.fitToView();\n\n  this.zoomLevelChanged();\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nPlayheadLayer.prototype.addToStage = function(stage) {\n  stage.add(this._playheadLayer);\n};\n\n/**\n * Decides whether to use an animation to update the playhead position.\n *\n * If the zoom level is such that the number of pixels per second of audio is\n * low, we can use timeupdate events from the HTMLMediaElement to\n * set the playhead position. Otherwise, we use an animation to update the\n * playhead position more smoothly. The animation is CPU intensive, so we\n * avoid using it where possible.\n */\n\nPlayheadLayer.prototype.zoomLevelChanged = function() {\n  const pixelsPerSecond = this._view.timeToPixels(1.0);\n\n  this._useAnimation = pixelsPerSecond >= 5;\n\n  if (this._useAnimation) {\n    if (this._player.isPlaying() && !this._playheadLineAnimation) {\n      // Start the animation\n      this._start();\n    }\n  }\n  else {\n    if (this._playheadLineAnimation) {\n      // Stop the animation\n      const time = this._player.getCurrentTime();\n\n      this.stop(time);\n    }\n  }\n};\n\n/**\n * Resizes the playhead UI objects to fit the available space in the\n * view.\n */\n\nPlayheadLayer.prototype.fitToView = function() {\n  const height = this._view.getHeight();\n\n  this._playheadLine.points([0.5, 0, 0.5, height]);\n\n  if (this._playheadText) {\n    this._playheadText.y(12);\n  }\n};\n\n/**\n * Creates the playhead UI objects.\n *\n * @private\n * @param {String} color\n */\n\nPlayheadLayer.prototype._createPlayhead = function() {\n  // Create with default points, the real values are set in fitToView().\n  this._playheadLine = new Line({\n    stroke:      this._playheadColor,\n    strokeWidth: this._playheadWidth\n  });\n\n  this._playheadGroup = new Konva.Group({\n    x: 0,\n    y: 0\n  });\n\n  this._playheadGroup.add(this._playheadLine);\n  this._playheadLayer.add(this._playheadGroup);\n};\n\nPlayheadLayer.prototype._createPlayheadText = function() {\n  const self = this;\n\n  const time = self._player.getCurrentTime();\n  const text = self._view.formatTime(time);\n\n  // Create with default y, the real value is set in fitToView().\n  self._playheadText = new Text({\n    x: 0,\n    y: 0,\n    padding: self._playheadPadding,\n    text: text,\n    fontSize: self._playheadFontSize,\n    fontFamily: self._playheadFontFamily,\n    fontStyle: self._playheadFontStyle,\n    fill: self._playheadTextColor,\n    align: 'right',\n    sceneFunc: function(context, shape) {\n      const width = shape.width();\n      const height = shape.height() + 2 * self._playheadPadding;\n\n      context.fillStyle = self._playheadBackgroundColor;\n      context.fillRect(0, -self._playheadPadding, width, height);\n      shape._sceneFunc(context);\n    }\n  });\n\n  self._playheadGroup.add(self._playheadText);\n};\n\n/**\n * Updates the playhead position.\n *\n * @param {Number} time Current playhead position, in seconds.\n */\n\nPlayheadLayer.prototype.updatePlayheadTime = function(time) {\n  this._syncPlayhead(time);\n\n  if (this._player.isPlaying()) {\n    this._start();\n  }\n};\n\n/**\n * Updates the playhead position.\n *\n * @private\n * @param {Number} time Current playhead position, in seconds.\n */\n\nPlayheadLayer.prototype._syncPlayhead = function(time) {\n  const pixelIndex = this._view.timeToPixels(time);\n\n  const frameOffset = this._view.getFrameOffset();\n  const width = this._view.getWidth();\n\n  const isVisible = (pixelIndex >= frameOffset) &&\n                    (pixelIndex <= frameOffset + width);\n\n  this._playheadPixel = pixelIndex;\n\n  if (isVisible) {\n    const playheadX = this._playheadPixel - frameOffset;\n\n    if (!this._playheadVisible) {\n      this._playheadVisible = true;\n      this._playheadGroup.show();\n    }\n\n    this._playheadGroup.setX(playheadX);\n\n    if (this._playheadText) {\n      const text = this._view.formatTime(time);\n      const playheadTextWidth = this._playheadText.width();\n\n      this._playheadText.setText(text);\n\n      if (playheadTextWidth + playheadX > width - 2) {\n        this._playheadText.setX(-playheadTextWidth);\n      }\n      else if (playheadTextWidth + playheadX < width) {\n        this._playheadText.setX(0);\n      }\n    }\n  }\n  else {\n    if (this._playheadVisible) {\n      this._playheadVisible = false;\n      this._playheadGroup.hide();\n    }\n  }\n\n  if (this._view.playheadPosChanged) {\n    this._view.playheadPosChanged(time);\n  }\n};\n\n/**\n * Starts a playhead animation in sync with the media playback.\n *\n * @private\n */\n\nPlayheadLayer.prototype._start = function() {\n  const self = this;\n\n  if (self._playheadLineAnimation) {\n    self._playheadLineAnimation.stop();\n    self._playheadLineAnimation = null;\n  }\n\n  if (!self._useAnimation) {\n    return;\n  }\n\n  let lastPlayheadPosition = null;\n\n  self._playheadLineAnimation = new Animation(function() {\n    const time = self._player.getCurrentTime();\n    const playheadPosition = self._view.timeToPixels(time);\n\n    if (playheadPosition !== lastPlayheadPosition) {\n      self._syncPlayhead(time);\n      lastPlayheadPosition = playheadPosition;\n    }\n  }, self._playheadLayer);\n\n  self._playheadLineAnimation.start();\n};\n\nPlayheadLayer.prototype.stop = function(time) {\n  if (this._playheadLineAnimation) {\n    this._playheadLineAnimation.stop();\n    this._playheadLineAnimation = null;\n  }\n\n  this._syncPlayhead(time);\n};\n\nPlayheadLayer.prototype.getPlayheadPixel = function() {\n  return this._playheadPixel;\n};\n\nPlayheadLayer.prototype.showPlayheadTime = function(show) {\n  if (show) {\n    if (!this._playheadText) {\n      // Create it\n      this._createPlayheadText(this._playheadTextColor,\n        this._playheadBackgroundColor, this._playheadPadding);\n      this.fitToView();\n    }\n  }\n  else {\n    if (this._playheadText) {\n      this._playheadText.remove();\n      this._playheadText.destroy();\n      this._playheadText = null;\n    }\n  }\n};\n\nPlayheadLayer.prototype.updatePlayheadText = function() {\n  if (this._playheadText) {\n    const time = this._player.getCurrentTime();\n    const text = this._view.formatTime(time);\n\n    this._playheadText.setText(text);\n  }\n};\n\nPlayheadLayer.prototype.destroy = function() {\n  if (this._playheadLineAnimation) {\n    this._playheadLineAnimation.stop();\n    this._playheadLineAnimation = null;\n  }\n};\n\nexport default PlayheadLayer;\n","/**\n * @file\n *\n * Defines the {@link OverlaySegmentMarker} class.\n *\n * @module overlay-segment-marker\n */\n\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\nimport { clamp } from './utils';\n\n/**\n * Creates a segment marker handle.\n *\n * @class\n * @alias OverlaySegmentMarker\n *\n * @param {CreateSegmentMarkerOptions} options\n */\n\nfunction OverlaySegmentMarker(options) {\n  this._options = options;\n}\n\nOverlaySegmentMarker.prototype.init = function(group) {\n  const handleWidth  = 10;\n  const handleHeight = 20;\n  const handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  const xPosition = this._options.startMarker ? -24 : 24;\n\n  const time = this._options.startMarker ? this._options.segment.startTime :\n                                           this._options.segment.endTime;\n\n  // Label - create with default y, the real value is set in fitToView().\n  this._label = new Text({\n    x:          xPosition,\n    y:          0,\n    text:       this._options.layer.formatTime(time),\n    fontFamily: this._options.fontFamily,\n    fontSize:   this._options.fontSize,\n    fontStyle:  this._options.fontStyle,\n    fill:       '#000',\n    textAlign:  'center',\n    visible:    false\n  });\n\n  // Handle - create with default y, the real value is set in fitToView().\n  this._handle = new Rect({\n    x:       handleX,\n    y:       0,\n    width:   handleWidth,\n    height:  handleHeight\n  });\n\n  group.add(this._label);\n  group.add(this._handle);\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nOverlaySegmentMarker.prototype.bindEventHandlers = function(group) {\n  const self = this;\n\n  const xPosition = self._options.startMarker ? -24 : 24;\n\n  group.on('dragstart', function() {\n    if (self._options.startMarker) {\n      self._label.setX(xPosition - self._label.getWidth());\n    }\n\n    self._label.show();\n  });\n\n  group.on('dragend', function() {\n    self._label.hide();\n  });\n\n  self._handle.on('mouseover touchstart', function() {\n    if (self._options.startMarker) {\n      self._label.setX(xPosition - self._label.getWidth());\n    }\n\n    self._label.show();\n\n    document.body.style.cursor = 'ew-resize';\n  });\n\n  self._handle.on('mouseout touchend', function() {\n    self._label.hide();\n\n    document.body.style.cursor = 'default';\n  });\n};\n\nOverlaySegmentMarker.prototype.fitToView = function() {\n  const viewHeight = this._options.layer.getHeight();\n\n  const overlayOffset = this._options.segmentOptions.overlayOffset;\n  const overlayRectHeight = clamp(0, viewHeight - 2 * overlayOffset);\n\n  this._label.y(viewHeight / 2 - 5);\n  this._handle.y(overlayOffset);\n  this._handle.height(overlayRectHeight);\n};\n\nOverlaySegmentMarker.prototype.update = function(options) {\n  if (options.startTime !== undefined && this._options.startMarker) {\n    this._label.text(this._options.layer.formatTime(options.startTime));\n  }\n\n  if (options.endTime !== undefined && !this._options.startMarker) {\n    this._label.text(this._options.layer.formatTime(options.endTime));\n  }\n};\n\nexport default OverlaySegmentMarker;\n","/**\n * @file\n *\n * Defines the {@link SegmentMarker} class.\n *\n * @module segment-marker\n */\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Parameters for the {@link SegmentMarker} constructor.\n *\n * @typedef {Object} SegmentMarkerOptions\n * @global\n * @property {Segment} segment\n * @property {SegmentShape} segmentShape\n * @property {Boolean} editable If true, marker is draggable.\n * @property {Boolean} startMarker If <code>true</code>, the marker indicates\n *   the start time of the segment. If <code>false</code>, the marker\n *   indicates the end time of the segment.\n * @property {Function} onDragStart\n * @property {Function} onDragMove\n * @property {Function} onDragEnd\n * @property {Function} dragBoundFunc\n */\n\n/**\n * Creates a segment handle marker for the start or end of a segment.\n *\n * @class\n * @alias SegmentMarker\n *\n * @param {SegmentMarkerOptions} options\n */\n\nfunction SegmentMarker(options) {\n  const self = this;\n\n  self._segment      = options.segment;\n  self._marker       = options.marker;\n  self._segmentShape = options.segmentShape;\n  self._editable     = options.editable;\n  self._startMarker  = options.startMarker;\n\n  self._onClick      = options.onClick;\n  self._onDragStart  = options.onDragStart;\n  self._onDragMove   = options.onDragMove;\n  self._onDragEnd    = options.onDragEnd;\n\n  self._group = new Konva.Group({\n    name:          'segment-marker',\n    segment:       self._segment,\n    draggable:     self._editable,\n    visible:       self._editable,\n    dragBoundFunc: function(pos) {\n      return options.dragBoundFunc(self, pos);\n    }\n  });\n\n  self._bindDefaultEventHandlers();\n\n  self._marker.init(self._group);\n}\n\nSegmentMarker.prototype._bindDefaultEventHandlers = function() {\n  const self = this;\n\n  self._group.on('click', function(event) {\n    self._onClick(self, event);\n  });\n\n  self._group.on('dragstart', function(event) {\n    self._onDragStart(self, event);\n  });\n\n  self._group.on('dragmove', function(event) {\n    self._onDragMove(self, event);\n  });\n\n  self._group.on('dragend', function(event) {\n    self._onDragEnd(self, event);\n  });\n};\n\nSegmentMarker.prototype.addToLayer = function(layer) {\n  layer.add(this._group);\n};\n\nSegmentMarker.prototype.moveToTop = function() {\n  this._group.moveToTop();\n};\n\nSegmentMarker.prototype.fitToView = function() {\n  this._marker.fitToView();\n};\n\nSegmentMarker.prototype.getSegment = function() {\n  return this._segment;\n};\n\nSegmentMarker.prototype.getX = function() {\n  return this._group.getX();\n};\n\nSegmentMarker.prototype.setX = function(x) {\n  this._group.setX(x);\n};\n\nSegmentMarker.prototype.getWidth = function() {\n  return this._group.getWidth();\n};\n\nSegmentMarker.prototype.getAbsolutePosition = function() {\n  return this._group.getAbsolutePosition();\n};\n\nSegmentMarker.prototype.isStartMarker = function() {\n  return this._startMarker;\n};\n\nSegmentMarker.prototype.update = function(options) {\n  if (options.editable !== undefined) {\n    this._group.visible(options.editable);\n    this._group.draggable(options.editable);\n  }\n\n  if (this._marker.update) {\n    this._marker.update(options);\n  }\n};\n\nSegmentMarker.prototype.destroy = function() {\n  if (this._marker.destroy) {\n    this._marker.destroy();\n  }\n\n  this._group.destroyChildren();\n  this._group.destroy();\n};\n\nSegmentMarker.prototype.startDrag = function() {\n  this._group.startDrag();\n};\n\nSegmentMarker.prototype.stopDrag = function() {\n  this._group.stopDrag();\n};\n\nexport default SegmentMarker;\n","/**\n * @file\n *\n * Defines the {@link WaveformShape} class.\n *\n * @module waveform-shape\n */\n\nimport { clamp, isLinearGradientColor, isString } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Waveform shape options.\n *\n * @typedef {Object} WaveformShapeOptions\n * @global\n * @property {String | LinearGradientColor} color Waveform color.\n * @property {WaveformOverview|WaveformZoomView} view The view object\n *   that contains the waveform shape.\n * @property {Segment?} segment If given, render a waveform image\n *   covering the segment's time range. Otherwise, render the entire\n *   waveform duration.\n */\n\n/**\n * Creates a Konva.Shape object that renders a waveform image.\n *\n * @class\n * @alias WaveformShape\n *\n * @param {WaveformShapeOptions} options\n */\n\nfunction WaveformShape(options) {\n  this._color = options.color;\n\n  const shapeOptions = {};\n\n  if (isString(options.color)) {\n    shapeOptions.fill = options.color;\n  }\n  else if (isLinearGradientColor(options.color)) {\n    const startY = options.view._height * (options.color.linearGradientStart / 100);\n    const endY = options.view._height * (options.color.linearGradientEnd / 100);\n\n    shapeOptions.fillLinearGradientStartPointY = startY;\n    shapeOptions.fillLinearGradientEndPointY = endY;\n    shapeOptions.fillLinearGradientColorStops = [\n      0, options.color.linearGradientColorStops[0],\n      1, options.color.linearGradientColorStops[1]\n    ];\n  }\n  else {\n    throw new TypeError('Unknown type for color property');\n  }\n\n  this._shape = new Konva.Shape(shapeOptions);\n  this._view = options.view;\n  this._segment = options.segment;\n\n  this._shape.sceneFunc(this._sceneFunc.bind(this));\n}\n\nWaveformShape.prototype.getX = function() {\n  return this._shape.getX();\n};\n\nWaveformShape.prototype.setX = function(x) {\n  return this._shape.setX(x);\n};\n\nWaveformShape.prototype.setSegment = function(segment) {\n  this._segment = segment;\n};\n\nWaveformShape.prototype.setWaveformColor = function(color) {\n  if (isString(color)) {\n    this._shape.fill(color);\n\n    this._shape.fillLinearGradientStartPointY(null);\n    this._shape.fillLinearGradientEndPointY(null);\n    this._shape.fillLinearGradientColorStops(null);\n  }\n  else if (isLinearGradientColor(color)) {\n    this._shape.fill(null);\n\n    const startY = this._view._height * (color.linearGradientStart / 100);\n    const endY = this._view._height * (color.linearGradientEnd / 100);\n\n    this._shape.fillLinearGradientStartPointY(startY);\n    this._shape.fillLinearGradientEndPointY(endY);\n    this._shape.fillLinearGradientColorStops([\n      0, color.linearGradientColorStops[0],\n      1, color.linearGradientColorStops[1]\n    ]);\n  }\n  else {\n    throw new TypeError('Unknown type for color property');\n  }\n};\n\nWaveformShape.prototype.fitToView = function() {\n  this.setWaveformColor(this._color);\n};\n\nWaveformShape.prototype._sceneFunc = function(context) {\n  const frameOffset = this._view.getFrameOffset();\n  const width = this._view.getWidth();\n  const height = this._view.getHeight();\n\n  this._drawWaveform(\n    context,\n    this._view.getWaveformData(),\n    frameOffset,\n    this._segment ? this._view.timeToPixels(this._segment.startTime) : frameOffset,\n    this._segment ? this._view.timeToPixels(this._segment.endTime)   : frameOffset + width,\n    width,\n    height\n  );\n};\n\n/**\n * Draws a waveform on a canvas context.\n *\n * @param {Konva.Context} context The canvas context to draw on.\n * @param {WaveformData} waveformData The waveform data to draw.\n * @param {Number} frameOffset The start position of the waveform shown\n *   in the view, in pixels.\n * @param {Number} startPixels The start position of the waveform to draw,\n *   in pixels.\n * @param {Number} endPixels The end position of the waveform to draw,\n *   in pixels.\n * @param {Number} width The width of the waveform area, in pixels.\n * @param {Number} height The height of the waveform area, in pixels.\n */\n\nWaveformShape.prototype._drawWaveform = function(context, waveformData,\n    frameOffset, startPixels, endPixels, width, height) {\n  if (startPixels < frameOffset) {\n    startPixels = frameOffset;\n  }\n\n  const limit = frameOffset + width;\n\n  if (endPixels > limit) {\n    endPixels = limit;\n  }\n\n  if (endPixels > waveformData.length - 1) {\n    endPixels = waveformData.length - 1;\n  }\n\n  const channels = waveformData.channels;\n\n  let waveformTop = 0;\n  let waveformHeight = Math.floor(height / channels);\n\n  for (let i = 0; i < channels; i++) {\n    if (i === channels - 1) {\n      waveformHeight = height - (channels - 1) * waveformHeight;\n    }\n\n    this._drawChannel(\n      context,\n      waveformData.channel(i),\n      frameOffset,\n      startPixels,\n      endPixels,\n      waveformTop,\n      waveformHeight\n    );\n\n    waveformTop += waveformHeight;\n  }\n};\n\n/**\n * Draws a single waveform channel on a canvas context.\n *\n * @param {Konva.Context} context The canvas context to draw on.\n * @param {WaveformDataChannel} channel The waveform data to draw.\n * @param {Number} frameOffset The start position of the waveform shown\n *   in the view, in pixels.\n * @param {Number} startPixels The start position of the waveform to draw,\n *   in pixels.\n * @param {Number} endPixels The end position of the waveform to draw,\n *   in pixels.\n * @param {Number} top The top of the waveform channel area, in pixels.\n * @param {Number} height The height of the waveform channel area, in pixels.\n */\n\nWaveformShape.prototype._drawChannel = function(context, channel,\n    frameOffset, startPixels, endPixels, top, height) {\n  let x, amplitude;\n\n  const amplitudeScale = this._view.getAmplitudeScale();\n\n  let lineX, lineY;\n\n  context.beginPath();\n\n  for (x = startPixels; x <= endPixels; x++) {\n    amplitude = channel.min_sample(x);\n\n    lineX = x - frameOffset + 0.5;\n    lineY = top + WaveformShape.scaleY(amplitude, height, amplitudeScale) + 0.5;\n\n    context.lineTo(lineX, lineY);\n  }\n\n  for (x = endPixels; x >= startPixels; x--) {\n    amplitude = channel.max_sample(x);\n\n    lineX = x - frameOffset + 0.5;\n    lineY = top + WaveformShape.scaleY(amplitude, height, amplitudeScale) + 1.0;\n\n    context.lineTo(lineX, lineY);\n  }\n\n  context.closePath();\n\n  context.fillShape(this._shape);\n};\n\nWaveformShape.prototype.addToLayer = function(layer) {\n  layer.add(this._shape);\n};\n\nWaveformShape.prototype.destroy = function() {\n  this._shape.destroy();\n  this._shape = null;\n};\n\nWaveformShape.prototype.on = function(event, handler) {\n  this._shape.on(event, handler);\n};\n\nWaveformShape.prototype.off = function(event, handler) {\n  this._shape.off(event, handler);\n};\n\n/**\n * Scales the waveform data for drawing on a canvas context.\n *\n * @see {@link https://stats.stackexchange.com/questions/281162}\n *\n * @todo Assumes 8-bit waveform data (-128 to 127 range)\n *\n * @param {Number} amplitude The waveform data point amplitude.\n * @param {Number} height The height of the waveform, in pixels.\n * @param {Number} scale Amplitude scaling factor.\n * @returns {Number} The scaled waveform data point.\n */\n\nWaveformShape.scaleY = function(amplitude, height, scale) {\n  const y = -(height - 1) * (amplitude * scale + 128) / 255 + (height - 1);\n\n  return clamp(Math.floor(y), 0, height - 1);\n};\n\nexport default WaveformShape;\n","/**\n * @file\n *\n * Defines the {@link SegmentShape} class.\n *\n * @module segment-shape\n */\n\nimport Konva from 'konva/lib/Core';\n\nimport OverlaySegmentMarker from './overlay-segment-marker';\nimport SegmentMarker from './segment-marker';\nimport WaveformShape from './waveform-shape';\nimport { clamp } from './utils';\n\n/**\n * Options that control segments' visual appearance\n *\n * @typedef {Object} SegmentDisplayOptions\n * @global\n * @property {Boolean} markers\n * @property {Boolean} overlay\n * @property {String} startMarkerColor\n * @property {String} endMarkerColor\n * @property {String} waveformColor\n * @property {String} overlayColor\n * @property {Number} overlayOpacity\n * @property {String} overlayBorderColor\n * @property {Number} overlayBorderWidth\n * @property {Number} overlayCornerRadius\n * @property {Number} overlayOffset\n * @property {String} overlayLabelAlign\n * @property {String} overlayLabelVerticalAlign\n * @property {Number} overlayLabelPadding\n * @property {String} overlayLabelColor\n * @property {String} overlayFontFamily\n * @property {Number} overlayFontSize\n * @property {String} overlayFontStyle\n */\n\n/**\n * Creates a waveform segment shape with optional start and end markers.\n *\n * @class\n * @alias SegmentShape\n *\n * @param {Segment} segment\n * @param {Peaks} peaks\n * @param {SegmentsLayer} layer\n * @param {WaveformOverview|WaveformZoomView} view\n */\n\nfunction SegmentShape(segment, peaks, layer, view) {\n  this._segment     = segment;\n  this._peaks       = peaks;\n  this._layer       = layer;\n  this._view        = view;\n  this._label       = null;\n  this._startMarker = null;\n  this._endMarker   = null;\n  this._color       = segment.color;\n  this._borderColor = segment.borderColor;\n  this._draggable   = this._segment.editable && this._view.isSegmentDraggingEnabled();\n  this._dragging    = false;\n\n  const viewOptions = view.getViewOptions();\n  const segmentOptions = viewOptions.segmentOptions;\n\n  this._overlayOffset = segmentOptions.overlayOffset;\n\n  if (!segment.overlay) {\n    this._waveformShape = new WaveformShape({\n      color:   segment.color,\n      view:    view,\n      segment: segment\n    });\n  }\n\n  this._onMouseEnter = this._onMouseEnter.bind(this);\n  this._onMouseLeave = this._onMouseLeave.bind(this);\n  this._onMouseDown  = this._onMouseDown.bind(this);\n  this._onMouseUp    = this._onMouseUp.bind(this);\n\n  this._dragBoundFunc      = this._dragBoundFunc.bind(this);\n  this._onSegmentDragStart = this._onSegmentDragStart.bind(this);\n  this._onSegmentDragMove  = this._onSegmentDragMove.bind(this);\n  this._onSegmentDragEnd   = this._onSegmentDragEnd.bind(this);\n\n  // Event handlers for markers\n  this._onSegmentMarkerClick       = this._onSegmentMarkerClick.bind(this);\n  this._onSegmentMarkerDragStart   = this._onSegmentMarkerDragStart.bind(this);\n  this._onSegmentMarkerDragMove    = this._onSegmentMarkerDragMove.bind(this);\n  this._onSegmentMarkerDragEnd     = this._onSegmentMarkerDragEnd.bind(this);\n  this._segmentMarkerDragBoundFunc = this._segmentMarkerDragBoundFunc.bind(this);\n\n  this._label = this._peaks.options.createSegmentLabel({\n    segment:    segment,\n    view:       this._view.getName(),\n    layer:      this._layer,\n    fontFamily: viewOptions.fontFamily,\n    fontSize:   viewOptions.fontSize,\n    fontStyle:  viewOptions.fontStyle\n  });\n\n  if (this._label) {\n    this._label.hide();\n  }\n\n  // Create with default y and height, the real values are set in fitToView().\n  const segmentStartOffset = this._view.timeToPixelOffset(this._segment.startTime);\n  const segmentEndOffset   = this._view.timeToPixelOffset(this._segment.endTime);\n\n  const overlayRectHeight = clamp(0, this._view.getHeight() - 2 * this._overlayOffset);\n\n  // The clip rectangle prevents text in the overlay from appearing\n  // outside the overlay.\n\n  this._overlay = new Konva.Group({\n    name:          'segment-overlay',\n    segment:       this._segment,\n    x:             segmentStartOffset,\n    y:             0,\n    width:         segmentEndOffset - segmentStartOffset,\n    height:        this._view.getHeight(),\n    clipX:         0,\n    clipY:         this._overlayOffset,\n    clipWidth:     segmentEndOffset - segmentStartOffset,\n    clipHeight:    overlayRectHeight,\n    draggable:     this._draggable,\n    dragBoundFunc: this._dragBoundFunc\n  });\n\n  let overlayBorderColor, overlayBorderWidth, overlayColor, overlayOpacity, overlayCornerRadius;\n\n  if (segment.overlay) {\n    overlayBorderColor  = this._borderColor || segmentOptions.overlayBorderColor;\n    overlayBorderWidth  = segmentOptions.overlayBorderWidth;\n    overlayColor        = this._color || segmentOptions.overlayColor;\n    overlayOpacity      = segmentOptions.overlayOpacity;\n    overlayCornerRadius = segmentOptions.overlayCornerRadius;\n  }\n\n  this._overlayRect = new Konva.Rect({\n    x:            0,\n    y:            this._overlayOffset,\n    width:        segmentEndOffset - segmentStartOffset,\n    stroke:       overlayBorderColor,\n    strokeWidth:  overlayBorderWidth,\n    height:       overlayRectHeight,\n    fill:         overlayColor,\n    opacity:      overlayOpacity,\n    cornerRadius: overlayCornerRadius\n  });\n\n  this._overlay.add(this._overlayRect);\n\n  if (segment.overlay) {\n    this._overlayText = new Konva.Text({\n      x:             0,\n      y:             this._overlayOffset,\n      text:          this._segment.labelText,\n      fontFamily:    segmentOptions.overlayFontFamily,\n      fontSize:      segmentOptions.overlayFontSize,\n      fontStyle:     segmentOptions.overlayFontStyle,\n      fill:          segmentOptions.overlayLabelColor,\n      listening:     false,\n      align:         segmentOptions.overlayLabelAlign,\n      width:         segmentEndOffset - segmentStartOffset,\n      verticalAlign: segmentOptions.overlayLabelVerticalAlign,\n      height:        overlayRectHeight,\n      padding:       segmentOptions.overlayLabelPadding\n    });\n\n    this._overlay.add(this._overlayText);\n  }\n\n  // Set up event handlers to show/hide the segment label text when the user\n  // hovers the mouse over the segment.\n  this._overlay.on('mouseenter', this._onMouseEnter);\n  this._overlay.on('mouseleave', this._onMouseLeave);\n\n  this._overlay.on('mousedown', this._onMouseDown);\n  this._overlay.on('mouseup', this._onMouseUp);\n\n  if (this._draggable) {\n    this._overlay.on('dragstart', this._onSegmentDragStart);\n    this._overlay.on('dragmove', this._onSegmentDragMove);\n    this._overlay.on('dragend', this._onSegmentDragEnd);\n  }\n\n  this._createMarkers();\n}\n\nfunction createOverlayMarker(options) {\n  return new OverlaySegmentMarker(options);\n}\n\nSegmentShape.prototype._createMarkers = function() {\n  const editable = this._layer.isEditingEnabled() && this._segment.editable;\n  const viewOptions = this._view.getViewOptions();\n  const segmentOptions = viewOptions.segmentOptions;\n\n  let createSegmentMarker, startMarker, endMarker;\n\n  if (this._segment.markers) {\n    createSegmentMarker = this._peaks.options.createSegmentMarker;\n  }\n  else if (this._segment.overlay) {\n    createSegmentMarker = createOverlayMarker;\n  }\n\n  if (createSegmentMarker) {\n    startMarker = createSegmentMarker({\n      segment:        this._segment,\n      editable:       editable,\n      startMarker:    true,\n      color:          segmentOptions.startMarkerColor,\n      fontFamily:     viewOptions.fontFamily,\n      fontSize:       viewOptions.fontSize,\n      fontStyle:      viewOptions.fontStyle,\n      layer:          this._layer,\n      view:           this._view.getName(),\n      segmentOptions: this._view.getViewOptions().segmentOptions\n    });\n  }\n\n  if (startMarker) {\n    this._startMarker = new SegmentMarker({\n      segment:       this._segment,\n      segmentShape:  this,\n      editable:      editable,\n      startMarker:   true,\n      marker:        startMarker,\n      onClick:       this._onSegmentMarkerClick,\n      onDragStart:   this._onSegmentMarkerDragStart,\n      onDragMove:    this._onSegmentMarkerDragMove,\n      onDragEnd:     this._onSegmentMarkerDragEnd,\n      dragBoundFunc: this._segmentMarkerDragBoundFunc\n    });\n  }\n\n  if (createSegmentMarker) {\n    endMarker = createSegmentMarker({\n      segment:        this._segment,\n      editable:       editable,\n      startMarker:    false,\n      color:          segmentOptions.endMarkerColor,\n      fontFamily:     viewOptions.fontFamily,\n      fontSize:       viewOptions.fontSize,\n      fontStyle:      viewOptions.fontStyle,\n      layer:          this._layer,\n      view:           this._view.getName(),\n      segmentOptions: this._view.getViewOptions().segmentOptions\n    });\n  }\n\n  if (endMarker) {\n    this._endMarker = new SegmentMarker({\n      segment:       this._segment,\n      segmentShape:  this,\n      editable:      editable,\n      startMarker:   false,\n      marker:        endMarker,\n      onClick:       this._onSegmentMarkerClick,\n      onDragStart:   this._onSegmentMarkerDragStart,\n      onDragMove:    this._onSegmentMarkerDragMove,\n      onDragEnd:     this._onSegmentMarkerDragEnd,\n      dragBoundFunc: this._segmentMarkerDragBoundFunc\n    });\n  }\n};\n\nSegmentShape.prototype._dragBoundFunc = function(pos) {\n  // Allow the segment to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: 0\n  };\n};\n\n/**\n * Update the segment shape after the segment's attributes have changed.\n */\n\nSegmentShape.prototype.update = function(options) {\n  const segmentStartOffset = this._view.timeToPixelOffset(this._segment.startTime);\n  const segmentEndOffset   = this._view.timeToPixelOffset(this._segment.endTime);\n  const width = segmentEndOffset - segmentStartOffset;\n  let marker;\n\n  if ((marker = this.getStartMarker())) {\n    marker.setX(segmentStartOffset - marker.getWidth());\n\n    if (options) {\n      marker.update(options);\n    }\n  }\n\n  if ((marker = this.getEndMarker())) {\n    marker.setX(segmentEndOffset);\n\n    if (options) {\n      marker.update(options);\n    }\n  }\n\n  this._color = this._segment.color;\n  this._borderColor = this._segment.bordercolor;\n\n  if (this._label) {\n    this._label.text(this._segment.labelText);\n  }\n\n  if (this._overlayText) {\n    this._overlayText.text(this._segment.labelText);\n  }\n\n  if (this._segment.overlay) {\n    if (this._color) {\n      this._overlayRect.fill(this._color);\n    }\n\n    if (this._borderColor) {\n      this._overlayRect.stroke(this._borderColor);\n    }\n  }\n  else {\n    this._waveformShape.setWaveformColor(this._segment.color);\n  }\n\n  // While dragging, the overlay position is controlled in _onSegmentDragMove().\n\n  if (!this._dragging) {\n    if (this._overlay) {\n      this._overlay.setAttrs({\n        x:         segmentStartOffset,\n        width:     width,\n        clipWidth: width < 1 ? 1 : width\n      });\n\n      this._overlayRect.setAttrs({\n        x:     0,\n        width: width\n      });\n\n      if (this._overlayText) {\n        this._overlayText.setAttrs({\n          width: width\n        });\n      }\n    }\n  }\n};\n\nSegmentShape.prototype.getSegment = function() {\n  return this._segment;\n};\n\nSegmentShape.prototype.getStartMarker = function() {\n  return this._startMarker;\n};\n\nSegmentShape.prototype.getEndMarker = function() {\n  return this._endMarker;\n};\n\nSegmentShape.prototype.addToLayer = function(layer) {\n  if (this._waveformShape) {\n    this._waveformShape.addToLayer(layer);\n  }\n\n  if (this._label) {\n    layer.add(this._label);\n  }\n\n  if (this._overlay) {\n    layer.add(this._overlay);\n  }\n\n  if (this._startMarker) {\n    this._startMarker.addToLayer(layer);\n  }\n\n  if (this._endMarker) {\n    this._endMarker.addToLayer(layer);\n  }\n};\n\nSegmentShape.prototype.isDragging = function() {\n  return this._dragging;\n};\n\nSegmentShape.prototype._onMouseEnter = function(event) {\n  if (this._label) {\n    this._label.moveToTop();\n    this._label.show();\n  }\n\n  this._peaks.emit('segments.mouseenter', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onMouseLeave = function(event) {\n  if (this._label) {\n    this._label.hide();\n  }\n\n  this._peaks.emit('segments.mouseleave', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onMouseDown = function(event) {\n  this._peaks.emit('segments.mousedown', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onMouseUp = function(event) {\n  this._peaks.emit('segments.mouseup', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype.segmentClicked = function(eventName, event) {\n  this._moveToTop();\n\n  this._peaks.emit('segments.' + eventName, event);\n};\n\nSegmentShape.prototype._moveToTop = function() {\n  this._overlay.moveToTop();\n\n  this._layer.moveSegmentMarkersToTop();\n};\n\nSegmentShape.prototype.enableSegmentDragging = function(enable) {\n  if (!this._segment.editable) {\n    return;\n  }\n\n  if (!this._draggable && enable) {\n    this._overlay.on('dragstart', this._onSegmentDragStart);\n    this._overlay.on('dragmove', this._onSegmentDragMove);\n    this._overlay.on('dragend', this._onSegmentDragEnd);\n  }\n  else if (this._draggable && !enable) {\n    this._overlay.off('dragstart', this._onSegmentDragStart);\n    this._overlay.off('dragmove', this._onSegmentDragMove);\n    this._overlay.off('dragend', this._onSegmentDragEnd);\n  }\n\n  this._overlay.draggable(enable);\n  this._draggable = enable;\n};\n\nSegmentShape.prototype._setPreviousAndNextSegments = function() {\n  if (this._view.getSegmentDragMode() !== 'overlap') {\n    this._nextSegment = this._peaks.segments.findNextSegment(this._segment);\n    this._previousSegment = this._peaks.segments.findPreviousSegment(this._segment);\n  }\n  else {\n    this._nextSegment = null;\n    this._previousSegment = null;\n  }\n};\n\nSegmentShape.prototype._onSegmentDragStart = function(event) {\n  this._setPreviousAndNextSegments();\n\n  this._dragging = true;\n  this._dragStartX = this._overlay.getX();\n  this._dragStartTime = this._segment.startTime;\n  this._dragEndTime = this._segment.endTime;\n\n  this._peaks.emit('segments.dragstart', {\n    segment: this._segment,\n    marker: false,\n    startMarker: false,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onSegmentDragMove = function(event) {\n  const x = this._overlay.getX();\n  const offsetX = x - this._dragStartX;\n  const timeOffset = this._view.pixelsToTime(offsetX);\n\n  // The WaveformShape for a segment fills the canvas width\n  // but only draws a subset of the horizontal range. When dragged\n  // we need to keep the shape object in its position but\n  // update the segment start and end time so that the right\n  // subset is drawn.\n\n  // Calculate new segment start/end time based on drag position. We'll\n  // correct this later based on the drag mode, to prevent overlapping\n  // segments or to compress the adjacent segment.\n\n  let startTime = this._dragStartTime + timeOffset;\n  let endTime = this._dragEndTime + timeOffset;\n  const segmentDuration = this._segment.endTime - this._segment.startTime;\n  let dragMode;\n  const minSegmentWidth = this._view.getMinSegmentDragWidth();\n  const minSegmentDuration = this._view.pixelsToTime(minSegmentWidth);\n  let previousSegmentUpdated = false;\n  let nextSegmentUpdated = false;\n\n  // Prevent the segment from being dragged beyond the start of the waveform.\n\n  if (startTime < 0) {\n    startTime = 0;\n    endTime = segmentDuration;\n    this._overlay.setX(this._view.timeToPixelOffset(startTime));\n  }\n\n  // Adjust segment position if it now overlaps the previous segment?\n\n  if (this._previousSegment) {\n    let previousSegmentEndX = this._view.timeToPixelOffset(this._previousSegment.endTime);\n\n    if (startTime < this._previousSegment.endTime) {\n      dragMode = this._view.getSegmentDragMode();\n\n      if (dragMode === 'no-overlap' ||\n          (dragMode === 'compress' && !this._previousSegment.editable)) {\n        startTime = this._previousSegment.endTime;\n        endTime = startTime + segmentDuration;\n        this._overlay.setX(previousSegmentEndX);\n      }\n      else if (dragMode === 'compress') {\n        let previousSegmentEndTime = startTime;\n\n        const minPreviousSegmentEndTime = this._previousSegment.startTime + minSegmentDuration;\n\n        if (previousSegmentEndTime < minPreviousSegmentEndTime) {\n          previousSegmentEndTime = minPreviousSegmentEndTime;\n\n          previousSegmentEndX = this._view.timeToPixelOffset(previousSegmentEndTime);\n\n          this._overlay.setX(previousSegmentEndX);\n\n          startTime = previousSegmentEndTime;\n          endTime = startTime + segmentDuration;\n        }\n\n        this._previousSegment.update({ endTime: previousSegmentEndTime });\n\n        previousSegmentUpdated = true;\n      }\n    }\n  }\n\n  // Adjust segment position if it now overlaps the following segment?\n\n  if (this._nextSegment) {\n    let nextSegmentStartX = this._view.timeToPixelOffset(this._nextSegment.startTime);\n\n    if (endTime > this._nextSegment.startTime) {\n      dragMode = this._view.getSegmentDragMode();\n\n      if (dragMode === 'no-overlap' ||\n          (dragMode === 'compress' && !this._nextSegment.editable)) {\n        endTime = this._nextSegment.startTime;\n        startTime = endTime - segmentDuration;\n        this._overlay.setX(nextSegmentStartX - this._overlay.getWidth());\n      }\n      else if (dragMode === 'compress') {\n        let nextSegmentStartTime = endTime;\n\n        const maxNextSegmentStartTime = this._nextSegment.endTime - minSegmentDuration;\n\n        if (nextSegmentStartTime > maxNextSegmentStartTime) {\n          nextSegmentStartTime = maxNextSegmentStartTime;\n\n          nextSegmentStartX = this._view.timeToPixelOffset(nextSegmentStartTime);\n\n          this._overlay.setX(nextSegmentStartX - this._overlay.getWidth());\n\n          endTime = nextSegmentStartTime;\n          startTime = endTime - segmentDuration;\n        }\n\n        this._nextSegment.update({ startTime: nextSegmentStartTime });\n\n        nextSegmentUpdated = true;\n      }\n    }\n  }\n\n  this._segment._setStartTime(startTime);\n  this._segment._setEndTime(endTime);\n\n  this._peaks.emit('segments.dragged', {\n    segment: this._segment,\n    marker: false,\n    startMarker: false,\n    evt: event.evt\n  });\n\n  if (previousSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._previousSegment,\n      marker: false,\n      startMarker: false,\n      evt: event.evt\n    });\n  }\n  else if (nextSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._nextSegment,\n      marker: false,\n      startMarker: false,\n      evt: event.evt\n    });\n  }\n};\n\nSegmentShape.prototype._onSegmentDragEnd = function(event) {\n  this._dragging = false;\n\n  this._peaks.emit('segments.dragend', {\n    segment: this._segment,\n    marker: false,\n    startMarker: false,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype.moveMarkersToTop = function() {\n  if (this._startMarker) {\n    this._startMarker.moveToTop();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.moveToTop();\n  }\n};\n\nSegmentShape.prototype.startDrag = function() {\n  if (this._endMarker) {\n    this._endMarker.startDrag();\n  }\n};\n\nSegmentShape.prototype.stopDrag = function() {\n  if (this._endMarker) {\n    this._endMarker.stopDrag();\n  }\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentMarkerDragStart = function(segmentMarker, event) {\n  this._setPreviousAndNextSegments();\n\n  // Move this segment to the top of the z-order, so that it remains on top\n  // of any adjacent segments that the marker is dragged over.\n  this._moveToTop();\n\n  this._startMarkerX = this._startMarker.getX();\n  this._endMarkerX = this._endMarker.getX();\n\n  this._peaks.emit('segments.dragstart', {\n    segment: this._segment,\n    marker: true,\n    startMarker: segmentMarker.isStartMarker(),\n    evt: event.evt\n  });\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentMarkerDragMove = function(segmentMarker, event) {\n  if (segmentMarker.isStartMarker()) {\n    this._segmentStartMarkerDragMove(segmentMarker, event);\n    segmentMarker.update({ startTime: this._segment.startTime });\n  }\n  else {\n    this._segmentEndMarkerDragMove(segmentMarker, event);\n    segmentMarker.update({ endTime: this._segment.endTime });\n  }\n};\n\nfunction getDuration(segment) {\n  return segment.endTime - segment.startTime;\n}\n\nSegmentShape.prototype._segmentStartMarkerDragMove = function(segmentMarker, event) {\n  const width = this._view.getWidth();\n\n  let startMarkerX = this._startMarker.getX();\n  const endMarkerX = this._endMarker.getX();\n\n  let minSegmentDuration = this._view.pixelsToTime(50);\n  const minSegmentWidth = this._view.getMinSegmentDragWidth();\n\n  let upperLimit = this._endMarker.getX() - minSegmentWidth;\n\n  if (upperLimit > width) {\n    upperLimit = width;\n  }\n\n  let previousSegmentVisible = false;\n  let previousSegmentUpdated = false;\n  let previousSegmentEndX;\n\n  if (this._previousSegment) {\n    previousSegmentEndX = this._view.timeToPixelOffset(this._previousSegment.endTime);\n    previousSegmentVisible = previousSegmentEndX >= 0;\n  }\n\n  if (startMarkerX > upperLimit) {\n    segmentMarker.setX(upperLimit);\n    this._overlay.clipWidth(upperLimit - endMarkerX);\n\n    if (minSegmentWidth === 0 && upperLimit < width) {\n      this._segment._setStartTime(this._segment.endTime);\n    }\n    else {\n      this._segment._setStartTime(this._view.pixelOffsetToTime(upperLimit));\n    }\n  }\n  else if (this._previousSegment && previousSegmentVisible) {\n    const dragMode = this._view.getSegmentDragMode();\n\n    const fixedPreviousSegment = dragMode === 'no-overlap' ||\n      (dragMode === 'compress' && !this._previousSegment.editable);\n\n    const compressPreviousSegment = dragMode === 'compress' && this._previousSegment.editable;\n\n    if (startMarkerX <= previousSegmentEndX) {\n      if (fixedPreviousSegment) {\n        segmentMarker.setX(previousSegmentEndX);\n        this._overlay.clipWidth(previousSegmentEndX - endMarkerX);\n\n        this._segment._setStartTime(this._previousSegment.endTime);\n      }\n      else if (compressPreviousSegment) {\n        const previousSegmentDuration = getDuration(this._previousSegment);\n\n        if (previousSegmentDuration < minSegmentDuration) {\n          minSegmentDuration = previousSegmentDuration;\n        }\n\n        const lowerLimit = this._view.timeToPixelOffset(\n          this._previousSegment.startTime + minSegmentDuration\n        );\n\n        if (startMarkerX < lowerLimit) {\n          startMarkerX = lowerLimit;\n        }\n\n        segmentMarker.setX(startMarkerX);\n        this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n        this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerX));\n\n        this._previousSegment.update({\n          endTime: this._view.pixelOffsetToTime(startMarkerX)\n        });\n\n        previousSegmentUpdated = true;\n      }\n    }\n    else {\n      if (startMarkerX < 0) {\n        startMarkerX = 0;\n      }\n\n      segmentMarker.setX(startMarkerX);\n      this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n      this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerX));\n    }\n  }\n  else {\n    if (startMarkerX < 0) {\n      startMarkerX = 0;\n    }\n\n    segmentMarker.setX(startMarkerX);\n    this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n    this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerX));\n  }\n\n  this._peaks.emit('segments.dragged', {\n    segment: this._segment,\n    marker: true,\n    startMarker: true,\n    evt: event.evt\n  });\n\n  if (previousSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._previousSegment,\n      marker: true,\n      startMarker: false,\n      evt: event.evt\n    });\n  }\n};\n\nSegmentShape.prototype._segmentEndMarkerDragMove = function(segmentMarker, event) {\n  const width = this._view.getWidth();\n\n  const startMarkerX = this._startMarker.getX();\n  let endMarkerX = this._endMarker.getX();\n\n  let minSegmentDuration = this._view.pixelsToTime(50);\n  const minSegmentWidth = this._view.getMinSegmentDragWidth();\n\n  let lowerLimit = this._startMarker.getX() + minSegmentWidth;\n\n  if (lowerLimit < 0) {\n    lowerLimit = 0;\n  }\n\n  let nextSegmentVisible = false;\n  let nextSegmentUpdated = false;\n  let nextSegmentStartX;\n\n  if (this._nextSegment) {\n    nextSegmentStartX = this._view.timeToPixelOffset(this._nextSegment.startTime);\n    nextSegmentVisible = nextSegmentStartX < width;\n  }\n\n  if (endMarkerX < lowerLimit) {\n    segmentMarker.setX(lowerLimit);\n    this._overlay.clipWidth(lowerLimit - startMarkerX);\n\n    if (minSegmentWidth === 0 && lowerLimit > 0) {\n      this._segment._setEndTime(this._segment.startTime);\n    }\n    else {\n      this._segment._setEndTime(this._view.pixelOffsetToTime(lowerLimit));\n    }\n  }\n  else if (this._nextSegment && nextSegmentVisible) {\n    const dragMode = this._view.getSegmentDragMode();\n\n    const fixedNextSegment = dragMode === 'no-overlap' ||\n      (dragMode === 'compress' && !this._nextSegment.editable);\n\n    const compressNextSegment = dragMode === 'compress' && this._nextSegment.editable;\n\n    if (endMarkerX >= nextSegmentStartX) {\n      if (fixedNextSegment) {\n        segmentMarker.setX(nextSegmentStartX);\n        this._overlay.clipWidth(nextSegmentStartX - startMarkerX);\n\n        this._segment._setEndTime(this._nextSegment.startTime);\n      }\n      else if (compressNextSegment) {\n        const nextSegmentDuration = getDuration(this._nextSegment);\n\n        if (nextSegmentDuration < minSegmentDuration) {\n          minSegmentDuration = nextSegmentDuration;\n        }\n\n        const upperLimit = this._view.timeToPixelOffset(\n          this._nextSegment.endTime - minSegmentDuration\n        );\n\n        if (endMarkerX > upperLimit) {\n          endMarkerX = upperLimit;\n        }\n\n        segmentMarker.setX(endMarkerX);\n        this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n        this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerX));\n\n        this._nextSegment.update({\n          startTime: this._view.pixelOffsetToTime(endMarkerX)\n        });\n\n        nextSegmentUpdated = true;\n      }\n    }\n    else {\n      if (endMarkerX > width) {\n        endMarkerX = width;\n      }\n\n      segmentMarker.setX(endMarkerX);\n      this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n      this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerX));\n    }\n  }\n  else {\n    if (endMarkerX > width) {\n      endMarkerX = width;\n    }\n\n    segmentMarker.setX(endMarkerX);\n    this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n    this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerX));\n  }\n\n  this._peaks.emit('segments.dragged', {\n    segment: this._segment,\n    marker: true,\n    startMarker: false,\n    evt: event.evt\n  });\n\n  if (nextSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._nextSegment,\n      marker: true,\n      startMarker: true,\n      evt: event.evt\n    });\n  }\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentMarkerDragEnd = function(segmentMarker, event) {\n  this._nextSegment = null;\n  this._previousSegment = null;\n\n  const startMarker = segmentMarker.isStartMarker();\n\n  this._peaks.emit('segments.dragend', {\n    segment: this._segment,\n    marker: true,\n    startMarker: startMarker,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._segmentMarkerDragBoundFunc = function(segmentMarker, pos) {\n  // Allow the marker to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: segmentMarker.getAbsolutePosition().y\n  };\n};\n\nSegmentShape.prototype._onSegmentMarkerClick = function() {\n  // Move this segment to the top of the z-order.\n  this._moveToTop();\n};\n\nSegmentShape.prototype.fitToView = function() {\n  if (this._startMarker) {\n    this._startMarker.fitToView();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.fitToView();\n  }\n\n  if (this._overlay) {\n    const height = this._view.getHeight();\n\n    const overlayRectHeight = clamp(0, height - (this._overlayOffset * 2));\n\n    this._overlay.setAttrs({\n      y:          0,\n      height:     height,\n      clipY:      this._overlayOffset,\n      clipHeight: overlayRectHeight\n    });\n\n    this._overlayRect.setAttrs({\n      y:      this._overlayOffset,\n      height: overlayRectHeight\n    });\n\n    if (this._overlayText) {\n      this._overlayText.setAttrs({\n        y:      this._overlayOffset,\n        height: overlayRectHeight\n      });\n    }\n  }\n};\n\nSegmentShape.prototype.destroy = function() {\n  if (this._waveformShape) {\n    this._waveformShape.destroy();\n  }\n\n  if (this._label) {\n    this._label.destroy();\n  }\n\n  if (this._startMarker) {\n    this._startMarker.destroy();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.destroy();\n  }\n\n  if (this._overlay) {\n    this._overlay.destroy();\n  }\n};\n\nexport default SegmentShape;\n","/**\n * @file\n *\n * Defines the {@link SegmentsLayer} class.\n *\n * @module segments-layer\n */\n\nimport SegmentShape from './segment-shape';\nimport { objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates a Konva.Layer that displays segment markers against the audio\n * waveform.\n *\n * @class\n * @alias SegmentsLayer\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Boolean} enableEditing\n */\n\nfunction SegmentsLayer(peaks, view, enableEditing) {\n  this._peaks         = peaks;\n  this._view          = view;\n  this._enableEditing = enableEditing;\n  this._segmentShapes = {};\n  this._layer         = new Konva.Layer();\n\n  this._onSegmentsUpdate    = this._onSegmentsUpdate.bind(this);\n  this._onSegmentsAdd       = this._onSegmentsAdd.bind(this);\n  this._onSegmentsRemove    = this._onSegmentsRemove.bind(this);\n  this._onSegmentsRemoveAll = this._onSegmentsRemoveAll.bind(this);\n  this._onSegmentsDragged   = this._onSegmentsDragged.bind(this);\n\n  this._peaks.on('segments.update', this._onSegmentsUpdate);\n  this._peaks.on('segments.add', this._onSegmentsAdd);\n  this._peaks.on('segments.remove', this._onSegmentsRemove);\n  this._peaks.on('segments.remove_all', this._onSegmentsRemoveAll);\n  this._peaks.on('segments.dragged', this._onSegmentsDragged);\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nSegmentsLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nSegmentsLayer.prototype.setListening = function(listening) {\n  this._layer.listening(listening);\n};\n\nSegmentsLayer.prototype.enableEditing = function(enable) {\n  this._enableEditing = enable;\n};\n\nSegmentsLayer.prototype.isEditingEnabled = function() {\n  return this._enableEditing;\n};\n\nSegmentsLayer.prototype.enableSegmentDragging = function(enable) {\n  for (const segmentPid in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentPid)) {\n      this._segmentShapes[segmentPid].enableSegmentDragging(enable);\n    }\n  }\n};\n\nSegmentsLayer.prototype.getSegmentShape = function(segment) {\n  return this._segmentShapes[segment.pid];\n};\n\nSegmentsLayer.prototype.formatTime = function(time) {\n  return this._view.formatTime(time);\n};\n\nSegmentsLayer.prototype._onSegmentsUpdate = function(segment, options) {\n  const frameStartTime = this._view.getStartTime();\n  const frameEndTime = this._view.getEndTime();\n\n  let segmentShape = this.getSegmentShape(segment);\n  const isVisible = segment.isVisible(frameStartTime, frameEndTime);\n\n  if (segmentShape && !isVisible) {\n    // Remove segment shape that is no longer visible.\n\n    if (!segmentShape.isDragging()) {\n      this._removeSegment(segment);\n    }\n  }\n  else if (!segmentShape && isVisible) {\n    // Add segment shape for visible segment.\n    segmentShape = this._updateSegment(segment);\n  }\n  else if (segmentShape && isVisible) {\n    // Update the segment shape with the changed attributes.\n    segmentShape.update(options);\n  }\n};\n\nSegmentsLayer.prototype._onSegmentsAdd = function(event) {\n  const self = this;\n\n  const frameStartTime = self._view.getStartTime();\n  const frameEndTime   = self._view.getEndTime();\n\n  event.segments.forEach(function(segment) {\n    if (segment.isVisible(frameStartTime, frameEndTime)) {\n      const segmentShape = self._addSegmentShape(segment);\n\n      segmentShape.update();\n    }\n  });\n\n  // Ensure segment markers are always draggable.\n  this.moveSegmentMarkersToTop();\n};\n\nSegmentsLayer.prototype._onSegmentsRemove = function(event) {\n  const self = this;\n\n  event.segments.forEach(function(segment) {\n    self._removeSegment(segment);\n  });\n};\n\nSegmentsLayer.prototype._onSegmentsRemoveAll = function() {\n  this._layer.removeChildren();\n  this._segmentShapes = {};\n};\n\nSegmentsLayer.prototype._onSegmentsDragged = function(event) {\n  this._updateSegment(event.segment);\n};\n\n/**\n * Creates the Konva UI objects for a given segment.\n *\n * @private\n * @param {Segment} segment\n * @returns {SegmentShape}\n */\n\nSegmentsLayer.prototype._createSegmentShape = function(segment) {\n  return new SegmentShape(segment, this._peaks, this, this._view);\n};\n\n/**\n * Adds a Konva UI object to the layer for a given segment.\n *\n * @private\n * @param {Segment} segment\n * @returns {SegmentShape}\n */\n\nSegmentsLayer.prototype._addSegmentShape = function(segment) {\n  const segmentShape = this._createSegmentShape(segment);\n\n  segmentShape.addToLayer(this._layer);\n\n  this._segmentShapes[segment.pid] = segmentShape;\n\n  return segmentShape;\n};\n\n/**\n * Updates the positions of all displayed segments in the view.\n *\n * @param {Number} startTime The start of the visible range in the view,\n *   in seconds.\n * @param {Number} endTime The end of the visible range in the view,\n *   in seconds.\n */\n\nSegmentsLayer.prototype.updateSegments = function(startTime, endTime) {\n  // Update segments in visible time range.\n  const segments = this._peaks.segments.find(startTime, endTime);\n\n  segments.forEach(this._updateSegment.bind(this));\n\n  // TODO: In the overview all segments are visible, so no need to do this.\n  this._removeInvisibleSegments(startTime, endTime);\n};\n\n/**\n * @private\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._updateSegment = function(segment) {\n  let segmentShape = this.getSegmentShape(segment);\n\n  if (!segmentShape) {\n    segmentShape = this._addSegmentShape(segment);\n  }\n\n  segmentShape.update();\n};\n\n/**\n * Removes any segments that are not visible, i.e., are not within and do not\n * overlap the given time range.\n *\n * @private\n * @param {Number} startTime The start of the visible time range, in seconds.\n * @param {Number} endTime The end of the visible time range, in seconds.\n */\n\nSegmentsLayer.prototype._removeInvisibleSegments = function(startTime, endTime) {\n  for (const segmentPid in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentPid)) {\n      const segment = this._segmentShapes[segmentPid].getSegment();\n\n      if (!segment.isVisible(startTime, endTime)) {\n        this._removeSegment(segment);\n      }\n    }\n  }\n};\n\n/**\n * Removes the given segment from the view.\n *\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._removeSegment = function(segment) {\n  const segmentShape = this._segmentShapes[segment.pid];\n\n  if (segmentShape) {\n    segmentShape.destroy();\n    delete this._segmentShapes[segment.pid];\n  }\n};\n\n/**\n * Moves all segment markers to the top of the z-order,\n * so the user can always drag them.\n */\n\nSegmentsLayer.prototype.moveSegmentMarkersToTop = function() {\n  for (const segmentPid in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentPid)) {\n      this._segmentShapes[segmentPid].moveMarkersToTop();\n    }\n  }\n};\n\n/**\n * Toggles visibility of the segments layer.\n *\n * @param {Boolean} visible\n */\n\nSegmentsLayer.prototype.setVisible = function(visible) {\n  this._layer.setVisible(visible);\n};\n\nSegmentsLayer.prototype.segmentClicked = function(eventName, event) {\n  const segmentShape = this._segmentShapes[event.segment.pid];\n\n  if (segmentShape) {\n    segmentShape.segmentClicked(eventName, event);\n  }\n};\n\nSegmentsLayer.prototype.destroy = function() {\n  this._peaks.off('segments.update', this._onSegmentsUpdate);\n  this._peaks.off('segments.add', this._onSegmentsAdd);\n  this._peaks.off('segments.remove', this._onSegmentsRemove);\n  this._peaks.off('segments.remove_all', this._onSegmentsRemoveAll);\n  this._peaks.off('segments.dragged', this._onSegmentsDragged);\n};\n\nSegmentsLayer.prototype.fitToView = function() {\n  for (const segmentPid in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentPid)) {\n      const segmentShape = this._segmentShapes[segmentPid];\n\n      segmentShape.fitToView();\n    }\n  }\n};\n\nSegmentsLayer.prototype.draw = function() {\n  this._layer.draw();\n};\n\nSegmentsLayer.prototype.getHeight = function() {\n  return this._layer.getHeight();\n};\n\nexport default SegmentsLayer;\n","/**\n * @file\n *\n * Defines the {@link WaveformAxis} class.\n *\n * @module waveform-axis\n */\n\nimport { formatTime, objectHasProperty, roundUpToNearest } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates the waveform axis shapes and adds them to the given view layer.\n *\n * @class\n * @alias WaveformAxis\n *\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Object} options\n * @param {String} options.axisGridlineColor\n * @param {String} options.axisLabelColor\n * @param {Boolean} options.showAxisLabels\n * @param {Function} options.formatAxisTime\n * @param {String} options.fontFamily\n * @param {Number} options.fontSize\n * @param {String} options.fontStyle\n */\n\nfunction WaveformAxis(view, options) {\n  const self = this;\n\n  self._axisGridlineColor      = options.axisGridlineColor;\n  self._axisLabelColor         = options.axisLabelColor;\n  self._showAxisLabels         = options.showAxisLabels;\n  self._axisTopMarkerHeight    = options.axisTopMarkerHeight;\n  self._axisBottomMarkerHeight = options.axisBottomMarkerHeight;\n\n  if (options.formatAxisTime) {\n    self._formatAxisTime = options.formatAxisTime;\n  }\n  else {\n    self._formatAxisTime = function(time) {\n      // precision = 0, drops the fractional seconds\n      return formatTime(time, 0);\n    };\n  }\n\n  self._axisLabelFont = WaveformAxis._buildFontString(\n    options.fontFamily,\n    options.fontSize,\n    options.fontStyle\n  );\n\n  self._axisShape = new Konva.Shape({\n    sceneFunc: function(context) {\n      self._drawAxis(context, view);\n    }\n  });\n}\n\nWaveformAxis._buildFontString = function(fontFamily, fontSize, fontStyle) {\n  if (!fontSize) {\n    fontSize = 11;\n  }\n\n  if (!fontFamily) {\n    fontFamily = 'sans-serif';\n  }\n\n  if (!fontStyle) {\n    fontStyle = 'normal';\n  }\n\n  return fontStyle + ' ' + fontSize + 'px ' + fontFamily;\n};\n\nWaveformAxis.prototype.addToLayer = function(layer) {\n  layer.add(this._axisShape);\n};\n\nWaveformAxis.prototype.showAxisLabels = function(show, options) {\n  this._showAxisLabels = show;\n\n  if (options) {\n    if (objectHasProperty(options, 'topMarkerHeight')) {\n      this._axisTopMarkerHeight = options.topMarkerHeight;\n    }\n\n    if (objectHasProperty(options, 'bottomMarkerHeight')) {\n      this._axisBottomMarkerHeight = options.bottomMarkerHeight;\n    }\n  }\n};\n\nWaveformAxis.prototype.setAxisLabelColor = function(color) {\n  this._axisLabelColor = color;\n};\n\nWaveformAxis.prototype.setAxisGridlineColor = function(color) {\n  this._axisGridlineColor = color;\n};\n\n/**\n * Returns number of seconds for each x-axis marker, appropriate for the\n * current zoom level, ensuring that markers are not too close together\n * and that markers are placed at intuitive time intervals (i.e., every 1,\n * 2, 5, 10, 20, 30 seconds, then every 1, 2, 5, 10, 20, 30 minutes, then\n * every 1, 2, 5, 10, 20, 30 hours).\n *\n * @param {WaveformOverview|WaveformZoomView} view\n * @returns {Number}\n */\n\nWaveformAxis.prototype._getAxisLabelScale = function(view) {\n  let baseSecs = 1; // seconds\n  const steps = [1, 2, 5, 10, 20, 30];\n  const minSpacing = 60;\n  let index = 0;\n\n  let secs;\n\n  for (;;) {\n    secs = baseSecs * steps[index];\n    const pixels = view.timeToPixels(secs);\n\n    if (pixels < minSpacing) {\n      if (++index === steps.length) {\n        baseSecs *= 60; // seconds -> minutes -> hours\n        index = 0;\n      }\n    }\n    else {\n      break;\n    }\n  }\n\n  return secs;\n};\n\n/**\n * Draws the time axis and labels onto a view.\n *\n * @param {Konva.Context} context The context to draw on.\n * @param {WaveformOverview|WaveformZoomView} view\n */\n\nWaveformAxis.prototype._drawAxis = function(context, view) {\n  const currentFrameStartTime = view.getStartTime();\n\n  // Time interval between axis markers (seconds)\n  const axisLabelIntervalSecs = this._getAxisLabelScale(view);\n\n  // Time of first axis marker (seconds)\n  const firstAxisLabelSecs = roundUpToNearest(currentFrameStartTime, axisLabelIntervalSecs);\n\n  // Distance between waveform start time and first axis marker (seconds)\n  const axisLabelOffsetSecs = firstAxisLabelSecs - currentFrameStartTime;\n\n  // Distance between waveform start time and first axis marker (pixels)\n  const axisLabelOffsetPixels = view.timeToPixels(axisLabelOffsetSecs);\n\n  context.setAttr('strokeStyle', this._axisGridlineColor);\n  context.setAttr('lineWidth', 1);\n\n  // Set text style\n  context.setAttr('font', this._axisLabelFont);\n  context.setAttr('fillStyle', this._axisLabelColor);\n  context.setAttr('textAlign', 'left');\n  context.setAttr('textBaseline', 'bottom');\n\n  const width  = view.getWidth();\n  const height = view.getHeight();\n\n  let secs = firstAxisLabelSecs;\n\n  for (;;) {\n    // Position of axis marker (pixels)\n    const x = axisLabelOffsetPixels + view.timeToPixels(secs - firstAxisLabelSecs);\n\n    if (x >= width) {\n      break;\n    }\n\n    if (this._axisTopMarkerHeight > 0) {\n      context.beginPath();\n      context.moveTo(x + 0.5, 0);\n      context.lineTo(x + 0.5, 0 + this._axisTopMarkerHeight);\n      context.stroke();\n    }\n\n    if (this._axisBottomMarkerHeight > 0) {\n      context.beginPath();\n      context.moveTo(x + 0.5, height);\n      context.lineTo(x + 0.5, height - this._axisBottomMarkerHeight);\n      context.stroke();\n    }\n\n    if (this._showAxisLabels) {\n      const label      = this._formatAxisTime(secs);\n      const labelWidth = context.measureText(label).width;\n      const labelX     = x - labelWidth / 2;\n      const labelY     = height - 1 - this._axisBottomMarkerHeight;\n\n      if (labelX >= 0) {\n        context.fillText(label, labelX, labelY);\n      }\n    }\n\n    secs += axisLabelIntervalSecs;\n  }\n};\n\nexport default WaveformAxis;\n","/**\n * @file\n *\n * Defines the {@link WaveformView} class.\n *\n * @module waveform-view\n */\n\nimport PointsLayer from './points-layer';\nimport PlayheadLayer from './playhead-layer';\nimport SegmentsLayer from './segments-layer';\nimport WaveformAxis from './waveform-axis';\nimport WaveformShape from './waveform-shape';\n\nimport { formatTime, getMarkerObject, isFinite, isNumber } from './utils';\n\nimport Konva from 'konva/lib/Core';\n\nfunction WaveformView(waveformData, container, peaks, viewOptions) {\n  const self = this;\n\n  self._container = container;\n  self._peaks = peaks;\n  self._options = peaks.options;\n  self._viewOptions = viewOptions;\n\n  self._originalWaveformData = waveformData;\n  self._data = waveformData;\n\n  // The pixel offset of the current frame being displayed\n  self._frameOffset = 0;\n  self._width = container.clientWidth;\n  self._height = container.clientHeight;\n\n  self._amplitudeScale = 1.0;\n\n  self._waveformColor = self._viewOptions.waveformColor;\n  self._playedWaveformColor = self._viewOptions.playedWaveformColor;\n\n  self._timeLabelPrecision = self._viewOptions.timeLabelPrecision;\n\n  if (self._viewOptions.formatPlayheadTime) {\n    self._formatPlayheadTime = self._viewOptions.formatPlayheadTime;\n  }\n  else {\n    self._formatPlayheadTime = function(time) {\n      return formatTime(time, self._timeLabelPrecision);\n    };\n  }\n\n  self._enableSeek = true;\n\n  self.initWaveformData();\n\n  // Disable warning: The stage has 6 layers.\n  // Recommended maximum number of layers is 3-5.\n  Konva.showWarnings = false;\n\n  self._stage = new Konva.Stage({\n    container: container,\n    width: self._width,\n    height: self._height\n  });\n\n  self._createWaveform();\n\n  if (self._viewOptions.enableSegments) {\n    self._segmentsLayer = new SegmentsLayer(peaks, self, self._viewOptions.enableEditing);\n    self._segmentsLayer.addToStage(self._stage);\n  }\n\n  if (self._viewOptions.enablePoints) {\n    self._pointsLayer = new PointsLayer(peaks, self, self._viewOptions.enableEditing);\n    self._pointsLayer.addToStage(self._stage);\n  }\n\n  self.initHighlightLayer();\n\n  self._createAxisLabels();\n\n  self._playheadLayer = new PlayheadLayer(\n    self._peaks.player,\n    self,\n    self._viewOptions\n  );\n\n  self._playheadLayer.addToStage(self._stage);\n\n  self._onClick = self._onClick.bind(self);\n  self._onDblClick = self._onDblClick.bind(self);\n  self._onContextMenu = self._onContextMenu.bind(self);\n\n  self._stage.on('click', self._onClick);\n  self._stage.on('dblclick', self._onDblClick);\n  self._stage.on('contextmenu', self._onContextMenu);\n}\n\nWaveformView.prototype.getViewOptions = function() {\n  return this._viewOptions;\n};\n\n/**\n * @returns {WaveformData} The view's waveform data.\n */\n\nWaveformView.prototype.getWaveformData = function() {\n  return this._data;\n};\n\nWaveformView.prototype.setWaveformData = function(waveformData) {\n  this._data = waveformData;\n};\n\n/**\n * Returns the pixel index for a given time, for the current zoom level.\n *\n * @param {Number} time Time, in seconds.\n * @returns {Number} Pixel index.\n */\n\nWaveformView.prototype.timeToPixels = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale);\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformView.prototype.pixelsToTime = function(pixels) {\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/**\n * Returns the time for a given pixel offset (relative to the\n * current scroll position), for the current zoom level.\n *\n * @param {Number} offset Offset from left-visible-edge of view\n * @returns {Number} Time, in seconds.\n */\n\nWaveformView.prototype.pixelOffsetToTime = function(offset) {\n  const pixels = this._frameOffset + offset;\n\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\nWaveformView.prototype.timeToPixelOffset = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale) - this._frameOffset;\n};\n\n/**\n * @returns {Number} The start position of the waveform shown in the view,\n *   in pixels.\n */\n\nWaveformView.prototype.getFrameOffset = function() {\n  return this._frameOffset;\n};\n\n/**\n * @returns {Number} The width of the view, in pixels.\n */\n\nWaveformView.prototype.getWidth = function() {\n  return this._width;\n};\n\n/**\n * @returns {Number} The height of the view, in pixels.\n */\n\nWaveformView.prototype.getHeight = function() {\n  return this._height;\n};\n\n/**\n * @returns {Number} The time at the left edge of the waveform view.\n */\n\nWaveformView.prototype.getStartTime = function() {\n  return this.pixelOffsetToTime(0);\n};\n\n/**\n * @returns {Number} The time at the right edge of the waveform view.\n */\n\nWaveformView.prototype.getEndTime = function() {\n  return this.pixelOffsetToTime(this._width);\n};\n\n/**\n * @returns {Number} The media duration, in seconds.\n */\n\nWaveformView.prototype._getDuration = function() {\n  return this._peaks.player.getDuration();\n};\n\nWaveformView.prototype._createWaveform = function() {\n  this._waveformLayer = new Konva.Layer({ listening: false });\n\n  this._createWaveformShapes();\n\n  this._stage.add(this._waveformLayer);\n};\n\nWaveformView.prototype._createWaveformShapes = function() {\n  if (!this._waveformShape) {\n    this._waveformShape = new WaveformShape({\n      color: this._waveformColor,\n      view: this\n    });\n\n    this._waveformShape.addToLayer(this._waveformLayer);\n  }\n\n  if (this._playedWaveformColor && !this._playedWaveformShape) {\n    const time = this._peaks.player.getCurrentTime();\n\n    this._playedSegment = {\n      startTime: 0,\n      endTime: time\n    };\n\n    this._unplayedSegment = {\n      startTime: time,\n      endTime: this._getDuration()\n    };\n\n    this._waveformShape.setSegment(this._unplayedSegment);\n\n    this._playedWaveformShape = new WaveformShape({\n      color: this._playedWaveformColor,\n      view: this,\n      segment: this._playedSegment\n    });\n\n    this._playedWaveformShape.addToLayer(this._waveformLayer);\n  }\n};\n\nWaveformView.prototype.setWaveformColor = function(color) {\n  this._waveformColor = color;\n  this._waveformShape.setWaveformColor(color);\n};\n\nWaveformView.prototype.setPlayedWaveformColor = function(color) {\n  this._playedWaveformColor = color;\n\n  if (color) {\n    if (!this._playedWaveformShape) {\n      this._createWaveformShapes();\n    }\n\n    this._playedWaveformShape.setWaveformColor(color);\n  }\n  else {\n    if (this._playedWaveformShape) {\n      this._destroyPlayedWaveformShape();\n    }\n  }\n};\n\nWaveformView.prototype._destroyPlayedWaveformShape = function() {\n  this._waveformShape.setSegment(null);\n\n  this._playedWaveformShape.destroy();\n  this._playedWaveformShape = null;\n\n  this._playedSegment = null;\n  this._unplayedSegment = null;\n};\n\nWaveformView.prototype._createAxisLabels = function() {\n  this._axisLayer = new Konva.Layer({ listening: false });\n  this._axis = new WaveformAxis(this, this._viewOptions);\n\n  this._axis.addToLayer(this._axisLayer);\n  this._stage.add(this._axisLayer);\n};\n\nWaveformView.prototype.showAxisLabels = function(show, options) {\n  this._axis.showAxisLabels(show, options);\n  this._axisLayer.draw();\n};\n\nWaveformView.prototype.setAxisLabelColor = function(color) {\n  this._axis.setAxisLabelColor(color);\n  this._axisLayer.draw();\n};\n\nWaveformView.prototype.setAxisGridlineColor = function(color) {\n  this._axis.setAxisGridlineColor(color);\n  this._axisLayer.draw();\n};\n\nWaveformView.prototype.showPlayheadTime = function(show) {\n  this._playheadLayer.showPlayheadTime(show);\n};\n\nWaveformView.prototype.setTimeLabelPrecision = function(precision) {\n  this._timeLabelPrecision = precision;\n  this._playheadLayer.updatePlayheadText();\n};\n\nWaveformView.prototype.formatTime = function(time) {\n  return this._formatPlayheadTime(time);\n};\n\n/**\n * Adjusts the amplitude scale of waveform shown in the view, which allows\n * users to zoom the waveform vertically.\n *\n * @param {Number} scale The new amplitude scale factor\n */\n\nWaveformView.prototype.setAmplitudeScale = function(scale) {\n  if (!isNumber(scale) || !isFinite(scale)) {\n    throw new Error('view.setAmplitudeScale(): Scale must be a valid number');\n  }\n\n  this._amplitudeScale = scale;\n\n  this.drawWaveformLayer();\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.draw();\n  }\n};\n\nWaveformView.prototype.getAmplitudeScale = function() {\n  return this._amplitudeScale;\n};\n\nWaveformView.prototype.enableSeek = function(enable) {\n  this._enableSeek = enable;\n};\n\nWaveformView.prototype.isSeekEnabled = function() {\n  return this._enableSeek;\n};\n\nWaveformView.prototype._onClick = function(event) {\n  this._clickHandler(event, 'click');\n};\n\nWaveformView.prototype._onDblClick = function(event) {\n  this._clickHandler(event, 'dblclick');\n};\n\nWaveformView.prototype._onContextMenu = function(event) {\n  this._clickHandler(event, 'contextmenu');\n};\n\nWaveformView.prototype._clickHandler = function(event, eventName) {\n  let offsetX = event.evt.offsetX;\n\n  if (offsetX < 0) {\n    offsetX = 0;\n  }\n\n  let emitViewEvent = true;\n\n  if (event.target !== this._stage) {\n    const marker = getMarkerObject(event.target);\n\n    if (marker) {\n      if (marker.attrs.name === 'point-marker') {\n        const point = marker.getAttr('point');\n\n        if (point) {\n          this._peaks.emit('points.' + eventName, {\n            point: point,\n            evt: event.evt,\n            preventViewEvent: function() {\n              emitViewEvent = false;\n            }\n          });\n        }\n      }\n      else if (marker.attrs.name === 'segment-overlay') {\n        const segment = marker.getAttr('segment');\n\n        if (segment) {\n          const clickEvent = {\n            segment: segment,\n            evt: event.evt,\n            preventViewEvent: function() {\n              emitViewEvent = false;\n            }\n          };\n\n          if (this._segmentsLayer) {\n            this._segmentsLayer.segmentClicked(eventName, clickEvent);\n          }\n        }\n      }\n    }\n  }\n\n  if (emitViewEvent) {\n    const time = this.pixelOffsetToTime(offsetX);\n    const viewName = this.getName();\n\n    this._peaks.emit(viewName + '.' + eventName, {\n      time: time,\n      evt: event.evt\n    });\n  }\n};\n\nWaveformView.prototype.updatePlayheadTime = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformView.prototype.playheadPosChanged = function(time) {\n  if (this._playedWaveformShape) {\n    this._playedSegment.endTime = time;\n    this._unplayedSegment.startTime = time;\n\n    this.drawWaveformLayer();\n  }\n};\n\nWaveformView.prototype.drawWaveformLayer = function() {\n  this._waveformLayer.draw();\n};\n\nWaveformView.prototype.enableMarkerEditing = function(enable) {\n  if (this._segmentsLayer) {\n    this._segmentsLayer.enableEditing(enable);\n  }\n\n  if (this._pointsLayer) {\n    this._pointsLayer.enableEditing(enable);\n  }\n};\n\n/**\n * Called when the user starts or stops dragging the playhead.\n * We use this to disable interaction with the points and segments layers,\n * e.g., so that when the user drags the playhead over a marker, the timestamp\n * labels don't appear.\n */\n\nWaveformView.prototype.dragSeek = function(dragging) {\n  if (this._segmentsLayer) {\n    this._segmentsLayer.setListening(!dragging);\n  }\n\n  if (this._pointsLayer) {\n    this._pointsLayer.setListening(!dragging);\n  }\n};\n\nWaveformView.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  let updateWaveform = false;\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.setWidth(this._width);\n\n    updateWaveform = this.containerWidthChange();\n  }\n\n  let heightChanged = false;\n\n  if (this._container.clientHeight !== this._height) {\n    this._height = this._container.clientHeight;\n    this._stage.setHeight(this._height);\n\n    this._waveformShape.fitToView();\n    this._playheadLayer.fitToView();\n\n    this.containerHeightChange();\n\n    heightChanged = true;\n  }\n\n  if (updateWaveform) {\n    this.updateWaveform(this._frameOffset, true);\n  }\n  else if (heightChanged) {\n    if (this._segmentsLayer) {\n      this._segmentsLayer.fitToView();\n    }\n\n    if (this._pointsLayer) {\n      this._pointsLayer.fitToView();\n    }\n  }\n};\n\nWaveformView.prototype.destroy = function() {\n  this._playheadLayer.destroy();\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.destroy();\n  }\n\n  if (this._pointsLayer) {\n    this._pointsLayer.destroy();\n  }\n\n  if (this._stage) {\n    this._stage.destroy();\n    this._stage = null;\n  }\n};\n\nexport default WaveformView;\n","/**\n * @file\n *\n * Defines the {@link MouseDragHandler} class.\n *\n * @module mouse-drag-handler\n */\n\nimport { getMarkerObject } from './utils';\n\n/**\n * An object to receive callbacks on mouse drag events. Each function is\n * called with the current mouse X position, relative to the stage's\n * container HTML element.\n *\n * @typedef {Object} MouseDragHandlers\n * @global\n * @property {Function} onMouseDown Mouse down event handler.\n * @property {Function} onMouseMove Mouse move event handler.\n * @property {Function} onMouseUp Mouse up event handler.\n */\n\n/**\n * Creates a handler for mouse events to allow interaction with the waveform\n * views by clicking and dragging the mouse.\n *\n * @class\n * @alias MouseDragHandler\n *\n * @param {Konva.Stage} stage\n * @param {MouseDragHandlers} handlers\n */\n\nfunction MouseDragHandler(stage, handlers) {\n  this._stage     = stage;\n  this._handlers  = handlers;\n  this._dragging  = false;\n  this._mouseDown = this._mouseDown.bind(this);\n  this._mouseUp   = this._mouseUp.bind(this);\n  this._mouseMove = this._mouseMove.bind(this);\n\n  this._stage.on('mousedown', this._mouseDown);\n  this._stage.on('touchstart', this._mouseDown);\n\n  this._lastMouseClientX = null;\n}\n\n/**\n * Mouse down event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseDown = function(event) {\n  let segment = null;\n\n  if (event.type === 'mousedown' && event.evt.button !== 0) {\n    // Mouse drag only applies to the primary mouse button.\n    // The secondary button may be used to show a context menu\n    // and we don't want to also treat this as a mouse drag operation.\n    return;\n  }\n\n  const marker = getMarkerObject(event.target);\n\n  if (marker) {\n    // Avoid interfering with drag/drop of point and segment markers.\n    if (marker.attrs.name === 'point-marker' ||\n        marker.attrs.name === 'segment-marker') {\n      return;\n    }\n\n    // Check if we're dragging a segment.\n    if (marker.attrs.name === 'segment-overlay') {\n      segment = marker;\n    }\n  }\n\n  this._lastMouseClientX = Math.floor(\n    event.type === 'touchstart' ? event.evt.touches[0].clientX : event.evt.clientX\n  );\n\n  if (this._handlers.onMouseDown) {\n    const mouseDownPosX = this._getMousePosX(this._lastMouseClientX);\n\n    this._handlers.onMouseDown(mouseDownPosX, segment);\n  }\n\n  // Use the window mousemove and mouseup handlers instead of the\n  // Konva.Stage ones so that we still receive events if the user moves the\n  // mouse outside the stage.\n  window.addEventListener('mousemove', this._mouseMove, { capture: false, passive: true });\n  window.addEventListener('touchmove', this._mouseMove, { capture: false, passive: true });\n  window.addEventListener('mouseup', this._mouseUp, { capture: false, passive: true });\n  window.addEventListener('touchend', this._mouseUp, { capture: false /* , passive: true */ });\n  window.addEventListener('blur', this._mouseUp, { capture: false, passive: true });\n};\n\n/**\n * Mouse move event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseMove = function(event) {\n  const clientX = Math.floor(\n    event.type === 'touchmove' ? event.changedTouches[0].clientX : event.clientX\n  );\n\n  // Don't update on vertical mouse movement.\n  if (clientX === this._lastMouseClientX) {\n    return;\n  }\n\n  this._lastMouseClientX = clientX;\n\n  this._dragging = true;\n\n  if (this._handlers.onMouseMove) {\n    const mousePosX = this._getMousePosX(clientX);\n\n    this._handlers.onMouseMove(mousePosX);\n  }\n};\n\n/**\n * Mouse up event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseUp = function(event) {\n  let clientX;\n\n  if (event.type === 'touchend') {\n    clientX = Math.floor(event.changedTouches[0].clientX);\n\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  else {\n    clientX = Math.floor(event.clientX);\n  }\n\n  if (this._handlers.onMouseUp) {\n    const mousePosX = this._getMousePosX(clientX);\n\n    this._handlers.onMouseUp(mousePosX);\n  }\n\n  window.removeEventListener('mousemove', this._mouseMove, { capture: false });\n  window.removeEventListener('touchmove', this._mouseMove, { capture: false });\n  window.removeEventListener('mouseup', this._mouseUp, { capture: false });\n  window.removeEventListener('touchend', this._mouseUp, { capture: false });\n  window.removeEventListener('blur', this._mouseUp, { capture: false });\n\n  this._dragging = false;\n};\n\n/**\n * @returns {Number} The mouse X position, relative to the container that\n * received the mouse down event.\n *\n * @private\n * @param {Number} clientX Mouse client X position.\n */\n\nMouseDragHandler.prototype._getMousePosX = function(clientX) {\n  const containerPos = this._stage.getContainer().getBoundingClientRect();\n\n  return Math.floor(clientX - containerPos.left);\n};\n\n/**\n * Returns <code>true</code> if the mouse is being dragged, i.e., moved with\n * the mouse button held down.\n *\n * @returns {Boolean}\n */\n\nMouseDragHandler.prototype.isDragging = function() {\n  return this._dragging;\n};\n\nMouseDragHandler.prototype.destroy = function() {\n  this._stage.off('mousedown', this._mouseDown);\n  this._stage.off('touchstart', this._mouseDown);\n};\n\nexport default MouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link SeekMouseDragHandler} class.\n *\n * @module seek-mouse-drag-handler\n */\n\nimport MouseDragHandler from './mouse-drag-handler';\nimport { clamp } from './utils';\n\n/**\n * Creates a handler for mouse events to allow seeking the waveform\n * views by clicking and dragging the mouse.\n *\n * @class\n * @alias SeekMouseDragHandler\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview} view\n */\n\nfunction SeekMouseDragHandler(peaks, view) {\n  this._peaks = peaks;\n  this._view = view;\n  this._firstMove = false;\n\n  this._onMouseDown = this._onMouseDown.bind(this);\n  this._onMouseMove = this._onMouseMove.bind(this);\n  this._onMouseUp = this._onMouseUp.bind(this);\n\n  this._mouseDragHandler = new MouseDragHandler(view._stage, {\n    onMouseDown: this._onMouseDown,\n    onMouseMove: this._onMouseMove,\n    onMouseUp: this._onMouseUp\n  });\n}\n\nSeekMouseDragHandler.prototype._onMouseDown = function(mousePosX) {\n  this._firstMove = true;\n  this._seek(mousePosX);\n};\n\nSeekMouseDragHandler.prototype._onMouseMove = function(mousePosX) {\n  if (this._firstMove) {\n    this._view.dragSeek(true);\n    this._firstMove = false;\n  }\n\n  this._seek(mousePosX);\n};\n\nSeekMouseDragHandler.prototype._onMouseUp = function() {\n  this._view.dragSeek(false);\n};\n\nSeekMouseDragHandler.prototype._seek = function(mousePosX) {\n  if (!this._view.isSeekEnabled()) {\n    return;\n  }\n\n  mousePosX = clamp(mousePosX, 0, this._width);\n\n  let time = this._view.pixelsToTime(mousePosX);\n  const duration = this._peaks.player.getDuration();\n\n  // Prevent the playhead position from jumping by limiting click\n  // handling to the waveform duration.\n  if (time > duration) {\n    time = duration;\n  }\n\n  // Update the playhead position. This gives a smoother visual update\n  // than if we only use the player.timeupdate event.\n  this._view.updatePlayheadTime(time);\n\n  this._peaks.player.seek(time);\n};\n\nSeekMouseDragHandler.prototype.destroy = function() {\n  this._mouseDragHandler.destroy();\n};\n\nexport default SeekMouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link WaveformOverview} class.\n *\n * @module waveform-overview\n */\n\nimport HighlightLayer from './highlight-layer';\nimport WaveformView from './waveform-view';\nimport SeekMouseDragHandler from './seek-mouse-drag-handler';\n\n/**\n * Creates the overview waveform view.\n *\n * @class\n * @alias WaveformOverview\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction WaveformOverview(waveformData, container, peaks) {\n  const self = this;\n\n  WaveformView.call(self, waveformData, container, peaks, peaks.options.overview);\n\n  // Bind event handlers\n  self._onTimeUpdate = self._onTimeUpdate.bind(self);\n  self._onPlaying = self._onPlaying.bind(self);\n  self._onPause = self._onPause.bind(self);\n  self._onZoomviewUpdate = self._onZoomviewUpdate.bind(self);\n\n  // Register event handlers\n  peaks.on('player.timeupdate', self._onTimeUpdate);\n  peaks.on('player.playing', self._onPlaying);\n  peaks.on('player.pause', self._onPause);\n  peaks.on('zoomview.update', self._onZoomviewUpdate);\n\n  const time = self._peaks.player.getCurrentTime();\n\n  self._playheadLayer.updatePlayheadTime(time);\n\n  self._mouseDragHandler = new SeekMouseDragHandler(peaks, self);\n\n  const zoomview = peaks.views.getView('zoomview');\n\n  if (zoomview) {\n    self._highlightLayer.showHighlight(zoomview.getStartTime(), zoomview.getEndTime());\n  }\n}\n\nWaveformOverview.prototype = Object.create(WaveformView.prototype);\n\nWaveformOverview.prototype.initWaveformData = function() {\n  if (this._width !== 0) {\n    this._resampleAndSetWaveformData(this._originalWaveformData, this._width);\n  }\n};\n\nWaveformOverview.prototype.initHighlightLayer = function() {\n  this._highlightLayer = new HighlightLayer(\n    this,\n    this._viewOptions\n  );\n\n  this._highlightLayer.addToStage(this._stage);\n};\n\nWaveformOverview.prototype.isSegmentDraggingEnabled = function() {\n  return false;\n};\n\nWaveformOverview.prototype.getName = function() {\n  return 'overview';\n};\n\nWaveformOverview.prototype._onTimeUpdate = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype._onPlaying = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype._onPause = function(time) {\n  this._playheadLayer.stop(time);\n};\n\nWaveformOverview.prototype._onZoomviewUpdate = function(event) {\n  this.showHighlight(event.startTime, event.endTime);\n};\n\nWaveformOverview.prototype.showHighlight = function(startTime, endTime) {\n  this._highlightLayer.showHighlight(startTime, endTime);\n};\n\nWaveformOverview.prototype.setWaveformData = function(waveformData) {\n  this._originalWaveformData = waveformData;\n\n  if (this._width !== 0) {\n    this._resampleAndSetWaveformData(waveformData, this._width);\n  }\n  else {\n    this._data = waveformData;\n  }\n\n  this.updateWaveform();\n};\n\nWaveformOverview.prototype._resampleAndSetWaveformData = function(waveformData, width) {\n  try {\n    this._data = waveformData.resample({ width: width });\n    return true;\n  }\n  catch (error) { // eslint-disable-line no-unused-vars\n    // This error usually indicates that the waveform length\n    // is less than the container width. Ignore, and use the\n    // given waveform data\n    this._data = waveformData;\n    return false;\n  }\n};\n\nWaveformOverview.prototype.removeHighlightRect = function() {\n  this._highlightLayer.removeHighlight();\n};\n\nWaveformOverview.prototype.updateWaveform = function(/* frameOffset, forceUpdate */) {\n  this._waveformLayer.draw();\n  this._axisLayer.draw();\n\n  const playheadTime = this._peaks.player.getCurrentTime();\n\n  this._playheadLayer.updatePlayheadTime(playheadTime);\n\n  this._highlightLayer.updateHighlight();\n\n  const frameStartTime = 0;\n  const frameEndTime   = this.pixelsToTime(this._width);\n\n  if (this._pointsLayer) {\n    this._pointsLayer.updatePoints(frameStartTime, frameEndTime);\n  }\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.updateSegments(frameStartTime, frameEndTime);\n  }\n};\n\nWaveformOverview.prototype.containerWidthChange = function() {\n  return this._resampleAndSetWaveformData(this._originalWaveformData, this._width);\n};\n\nWaveformOverview.prototype.containerHeightChange = function() {\n  this._highlightLayer.fitToView();\n};\n\nWaveformOverview.prototype.destroy = function() {\n  // Unregister event handlers\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.pause', this._onPause);\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('zoomview.update', this._onZoomviewUpdate);\n\n  this._mouseDragHandler.destroy();\n\n  WaveformView.prototype.destroy.call(this);\n};\n\nexport default WaveformOverview;\n","/**\n * @file\n *\n * Defines the {@link InsertSegmentMouseDragHandler} class.\n *\n * @module insert-segment-mouse-drag-handler\n */\n\nimport MouseDragHandler from './mouse-drag-handler';\n\n/**\n * Creates a handler for mouse events to allow inserting new waveform\n * segments by clicking and dragging the mouse.\n *\n * @class\n * @alias InsertSegmentMouseDragHandler\n *\n * @param {Peaks} peaks\n * @param {WaveformZoomView} view\n */\n\nfunction InsertSegmentMouseDragHandler(peaks, view) {\n  this._peaks = peaks;\n  this._view = view;\n\n  this._onMouseDown = this._onMouseDown.bind(this);\n  this._onMouseMove = this._onMouseMove.bind(this);\n  this._onMouseUp = this._onMouseUp.bind(this);\n\n  this._mouseDragHandler = new MouseDragHandler(view._stage, {\n    onMouseDown: this._onMouseDown,\n    onMouseMove: this._onMouseMove,\n    onMouseUp: this._onMouseUp\n  });\n}\n\nInsertSegmentMouseDragHandler.prototype.isDragging = function() {\n  return this._mouseDragHandler.isDragging();\n};\n\nInsertSegmentMouseDragHandler.prototype._reset = function() {\n  this._insertSegment = null;\n  this._insertSegmentShape = null;\n  this._segmentIsDraggable = false;\n  this._peaks.segments.setInserting(false);\n};\n\nInsertSegmentMouseDragHandler.prototype._onMouseDown = function(mousePosX, segment) {\n  this._reset();\n  this._segment = segment;\n\n  if (this._segment) {\n    if (this._view.getSegmentDragMode() !== 'overlap') {\n      return;\n    }\n    else {\n      // The user has clicked within a segment. We want to prevent\n      // the segment from being dragged while the user inserts a new\n      // segment. So we temporarily make the segment non-draggable,\n      // and restore its draggable state in onMouseUp().\n      this._segmentIsDraggable = this._segment.draggable();\n      this._segment.draggable(false);\n    }\n  }\n\n  const time = this._view.pixelsToTime(mousePosX + this._view.getFrameOffset());\n\n  this._peaks.segments.setInserting(true);\n\n  this._insertSegment = this._peaks.segments.add({\n    startTime: time,\n    endTime: time,\n    editable: true\n  });\n\n  this._insertSegmentShape = this._view._segmentsLayer.getSegmentShape(this._insertSegment);\n\n  if (this._insertSegmentShape) {\n    this._insertSegmentShape.moveMarkersToTop();\n    this._insertSegmentShape.startDrag();\n  }\n};\n\nInsertSegmentMouseDragHandler.prototype._onMouseMove = function() {\n};\n\nInsertSegmentMouseDragHandler.prototype._onMouseUp = function() {\n  if (!this._insertSegment) {\n    return;\n  }\n\n  if (this._insertSegmentShape) {\n    this._insertSegmentShape.stopDrag();\n    this._insertSegmentShape = null;\n  }\n\n  // If the user was dragging within an existing segment,\n  // restore the segment's original draggable state.\n  if (this._segment && this._segmentIsDraggable) {\n    this._segment.draggable(true);\n  }\n\n  this._peaks.emit('segments.insert', {\n    segment: this._insertSegment\n  });\n\n  this._peaks.segments.setInserting(false);\n};\n\nInsertSegmentMouseDragHandler.prototype.destroy = function() {\n  this._mouseDragHandler.destroy();\n};\n\nexport default InsertSegmentMouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link ScrollMouseDragHandler} class.\n *\n * @module scroll-mouse-drag-handler\n */\n\nimport MouseDragHandler from './mouse-drag-handler';\nimport { clamp } from './utils';\n\n/**\n * Creates a handler for mouse events to allow scrolling the zoomable\n * waveform view by clicking and dragging the mouse.\n *\n * @class\n * @alias ScrollMouseDragHandler\n *\n * @param {Peaks} peaks\n * @param {WaveformZoomView} view\n */\n\nfunction ScrollMouseDragHandler(peaks, view) {\n  this._peaks = peaks;\n  this._view = view;\n  this._seeking = false;\n  this._firstMove = false;\n  this._segment = null;\n  this._segmentIsDraggable = false;\n  this._initialFrameOffset = 0;\n  this._mouseDownX = 0;\n\n  this._onMouseDown = this._onMouseDown.bind(this);\n  this._onMouseMove = this._onMouseMove.bind(this);\n  this._onMouseUp = this._onMouseUp.bind(this);\n\n  this._mouseDragHandler = new MouseDragHandler(view._stage, {\n    onMouseDown: this._onMouseDown,\n    onMouseMove: this._onMouseMove,\n    onMouseUp: this._onMouseUp\n  });\n}\n\nScrollMouseDragHandler.prototype.isDragging = function() {\n  return this._mouseDragHandler.isDragging();\n};\n\nScrollMouseDragHandler.prototype._onMouseDown = function(mousePosX, segment) {\n  this._seeking = false;\n  this._firstMove = true;\n\n  if (segment && !segment.attrs.draggable) {\n    this._segment = null;\n  }\n  else {\n    this._segment = segment;\n  }\n\n  const playheadOffset = this._view.getPlayheadOffset();\n\n  if (this._view.isSeekEnabled() &&\n      Math.abs(mousePosX - playheadOffset) <= this._view.getPlayheadClickTolerance()) {\n    this._seeking = true;\n\n    // The user has clicked near the playhead, and the playhead is within\n    // a segment. In this case we want to allow the playhead to move, but\n    // prevent the segment from being dragged. So we temporarily make the\n    // segment non-draggable, and restore its draggable state in onMouseUp().\n    if (this._segment) {\n      this._segmentIsDraggable = this._segment.draggable();\n      this._segment.draggable(false);\n    }\n  }\n\n  if (this._seeking) {\n    mousePosX = clamp(mousePosX, 0, this._view.getWidth());\n\n    const time = this._view.pixelsToTime(mousePosX + this._view.getFrameOffset());\n\n    this._seek(time);\n  }\n  else {\n    this._initialFrameOffset = this._view.getFrameOffset();\n    this._mouseDownX = mousePosX;\n  }\n};\n\nScrollMouseDragHandler.prototype._onMouseMove = function(mousePosX) {\n  // Prevent scrolling the waveform if the user is dragging a segment.\n  if (this._segment && !this._seeking) {\n    return;\n  }\n\n  if (this._seeking) {\n    if (this._firstMove) {\n      this._view.dragSeek(true);\n      this._firstMove = false;\n    }\n\n    mousePosX = clamp(mousePosX, 0, this._view.getWidth());\n\n    const time = this._view.pixelsToTime(mousePosX + this._view.getFrameOffset());\n\n    this._seek(time);\n  }\n  else {\n    // TODO: Prevent scrolling when zoomed to fit the waveform to the\n    // view width. Sometimes the waveform is a few pixels longer.\n    if (!this._view.isAutoZoom()) {\n      // Moving the mouse to the left increases the time position of the\n      // left-hand edge of the visible waveform.\n      const diff = this._mouseDownX - mousePosX;\n      const newFrameOffset = this._initialFrameOffset + diff;\n\n      if (newFrameOffset !== this._initialFrameOffset) {\n        this._view.updateWaveform(newFrameOffset);\n      }\n    }\n  }\n};\n\nScrollMouseDragHandler.prototype._onMouseUp = function() {\n  if (this._seeking) {\n    this._view.dragSeek(false);\n  }\n  else {\n    // Set playhead position only on click release, when not dragging.\n    if (this._view._enableSeek && !this._mouseDragHandler.isDragging()) {\n      const time = this._view.pixelOffsetToTime(this._mouseDownX);\n\n      this._seek(time);\n    }\n  }\n\n  // If the user was dragging within an existing segment,\n  // restore the segment's original draggable state.\n  if (this._segment && this._seeking) {\n    if (this._segmentIsDraggable) {\n      this._segment.draggable(true);\n    }\n  }\n};\n\nScrollMouseDragHandler.prototype._seek = function(time) {\n  const duration = this._peaks.player.getDuration();\n\n  // Prevent the playhead position from jumping by limiting click\n  // handling to the waveform duration.\n  if (time > duration) {\n    time = duration;\n  }\n\n  // Update the playhead position. This gives a smoother visual update\n  // than if we only use the player.timeupdate event.\n  this._view.updatePlayheadTime(time);\n\n  this._peaks.player.seek(time);\n};\n\nScrollMouseDragHandler.prototype.destroy = function() {\n  this._mouseDragHandler.destroy();\n};\n\nexport default ScrollMouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link WaveformZoomView} class.\n *\n * @module waveform-zoomview\n */\n\nimport WaveformView from './waveform-view';\nimport InsertSegmentMouseDragHandler from './insert-segment-mouse-drag-handler';\nimport ScrollMouseDragHandler from './scroll-mouse-drag-handler';\nimport { clamp, isValidTime, objectHasProperty } from './utils';\n\n/**\n * Creates a zoomable waveform view.\n *\n * @class\n * @alias WaveformZoomView\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction WaveformZoomView(waveformData, container, peaks) {\n  const self = this;\n\n  WaveformView.call(self, waveformData, container, peaks, peaks.options.zoomview);\n\n  // Bind event handlers\n  self._onTimeUpdate = self._onTimeUpdate.bind(self);\n  self._onPlaying = self._onPlaying.bind(self);\n  self._onPause = self._onPause.bind(self);\n  self._onKeyboardLeft = self._onKeyboardLeft.bind(self);\n  self._onKeyboardRight = self._onKeyboardRight.bind(self);\n  self._onKeyboardShiftLeft  = self._onKeyboardShiftLeft.bind(self);\n  self._onKeyboardShiftRight = self._onKeyboardShiftRight.bind(self);\n\n  // Register event handlers\n  self._peaks.on('player.timeupdate', self._onTimeUpdate);\n  self._peaks.on('player.playing', self._onPlaying);\n  self._peaks.on('player.pause', self._onPause);\n  self._peaks.on('keyboard.left', self._onKeyboardLeft);\n  self._peaks.on('keyboard.right', self._onKeyboardRight);\n  self._peaks.on('keyboard.shift_left', self._onKeyboardShiftLeft);\n  self._peaks.on('keyboard.shift_right', self._onKeyboardShiftRight);\n\n  self._autoScroll = self._viewOptions.autoScroll;\n  self._autoScrollOffset = self._viewOptions.autoScrollOffset;\n\n  self._enableSegmentDragging = false;\n  self._segmentDragMode = 'overlap';\n  self._minSegmentDragWidth = 0;\n  self._insertSegmentShape = null;\n\n  self._playheadClickTolerance = self._viewOptions.playheadClickTolerance;\n\n  self._zoomLevelAuto = false;\n  self._zoomLevelSeconds = null;\n\n  const time = self._peaks.player.getCurrentTime();\n\n  self._syncPlayhead(time);\n\n  self._mouseDragHandler = new ScrollMouseDragHandler(peaks, self);\n\n  self._onWheel = self._onWheel.bind(self);\n  self._onWheelCaptureVerticalScroll = self._onWheelCaptureVerticalScroll.bind(self);\n  self.setWheelMode(self._viewOptions.wheelMode);\n\n  self._peaks.emit('zoomview.update', {\n    startTime: 0,\n    endTime: self.getEndTime()\n  });\n}\n\nWaveformZoomView.prototype = Object.create(WaveformView.prototype);\n\nWaveformZoomView.prototype.initWaveformData = function() {\n  this._enableWaveformCache = this._options.waveformCache;\n\n  this._initWaveformCache();\n\n  const initialZoomLevel = this._peaks.zoom.getZoomLevel();\n\n  this._resampleData({ scale: initialZoomLevel });\n};\n\nWaveformZoomView.prototype._initWaveformCache = function() {\n  if (this._enableWaveformCache) {\n    this._waveformData = new Map();\n    this._waveformData.set(this._originalWaveformData.scale, this._originalWaveformData);\n    this._waveformScales = [this._originalWaveformData.scale];\n  }\n};\n\nWaveformZoomView.prototype.initHighlightLayer = function() {\n};\n\nWaveformZoomView.prototype.setWheelMode = function(mode, options) {\n  if (!options) {\n    options = {};\n  }\n\n  if (mode !== this._wheelMode ||\n      options.captureVerticalScroll !== this._captureVerticalScroll) {\n    this._stage.off('wheel');\n\n    this._wheelMode = mode;\n    this._captureVerticalScroll = options.captureVerticalScroll;\n\n    switch (mode) {\n      case 'scroll':\n        if (options.captureVerticalScroll) {\n          this._stage.on('wheel', this._onWheelCaptureVerticalScroll);\n        }\n        else {\n          this._stage.on('wheel', this._onWheel);\n        }\n        break;\n    }\n  }\n};\n\nWaveformZoomView.prototype._onWheel = function(event) {\n  const wheelEvent = event.evt;\n  let delta;\n\n  if (wheelEvent.shiftKey) {\n    if (wheelEvent.deltaY !== 0) {\n      delta = wheelEvent.deltaY;\n    }\n    else if (wheelEvent.deltaX !== 0) {\n      delta = wheelEvent.deltaX;\n    }\n    else {\n      return;\n    }\n  }\n  else {\n    // Ignore the event if it looks like the user is scrolling vertically\n    // down the page\n    if (Math.abs(wheelEvent.deltaX) < Math.abs(wheelEvent.deltaY)) {\n      return;\n    }\n\n    delta = wheelEvent.deltaX;\n  }\n\n  if (wheelEvent.deltaMode === WheelEvent.DOM_DELTA_PAGE) {\n    delta *= this._width;\n  }\n\n  wheelEvent.preventDefault();\n\n  const frameOffset = clamp(\n    this._frameOffset + Math.floor(delta), 0, this._pixelLength - this._width\n  );\n\n  this.updateWaveform(frameOffset, false);\n};\n\nWaveformZoomView.prototype._onWheelCaptureVerticalScroll = function(event) {\n  const wheelEvent = event.evt;\n\n  const delta = Math.abs(wheelEvent.deltaX) < Math.abs(wheelEvent.deltaY) ?\n    wheelEvent.deltaY : wheelEvent.deltaX;\n\n  wheelEvent.preventDefault();\n\n  const frameOffset = clamp(\n    this._frameOffset + Math.floor(delta), 0, this._pixelLength - this._width\n  );\n\n  this.updateWaveform(frameOffset, false);\n};\n\nWaveformZoomView.prototype.setWaveformDragMode = function(mode) {\n  if (this._segmentsLayer) {\n    this._mouseDragHandler.destroy();\n    this.dragSeek(false);\n\n    if (mode === 'insert-segment') {\n      this._mouseDragHandler = new InsertSegmentMouseDragHandler(this._peaks, this);\n    }\n    else {\n      this._mouseDragHandler = new ScrollMouseDragHandler(this._peaks, this);\n    }\n  }\n};\n\nWaveformZoomView.prototype.enableSegmentDragging = function(enable) {\n  this._enableSegmentDragging = enable;\n\n  // Update all existing segments\n  if (this._segmentsLayer) {\n    this._segmentsLayer.enableSegmentDragging(enable);\n  }\n};\n\nWaveformZoomView.prototype.isSegmentDraggingEnabled = function() {\n  return this._enableSegmentDragging;\n};\n\nWaveformZoomView.prototype.setSegmentDragMode = function(mode) {\n  this._segmentDragMode = mode;\n};\n\nWaveformZoomView.prototype.getSegmentDragMode = function() {\n  return this._segmentDragMode;\n};\n\nWaveformZoomView.prototype.getName = function() {\n  return 'zoomview';\n};\n\nWaveformZoomView.prototype._onTimeUpdate = function(time) {\n  if (this._mouseDragHandler.isDragging()) {\n    return;\n  }\n\n  this._syncPlayhead(time);\n};\n\nWaveformZoomView.prototype._onPlaying = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformZoomView.prototype._onPause = function(time) {\n  this._playheadLayer.stop(time);\n};\n\nWaveformZoomView.prototype._onKeyboardLeft = function() {\n  this._keyboardScroll(-1, false);\n};\n\nWaveformZoomView.prototype._onKeyboardRight = function() {\n  this._keyboardScroll(1, false);\n};\n\nWaveformZoomView.prototype._onKeyboardShiftLeft = function() {\n  this._keyboardScroll(-1, true);\n};\n\nWaveformZoomView.prototype._onKeyboardShiftRight = function() {\n  this._keyboardScroll(1, true);\n};\n\nWaveformZoomView.prototype._keyboardScroll = function(direction, large) {\n  let increment;\n\n  if (large) {\n    increment = direction * this._width;\n  }\n  else {\n    increment = direction * this.timeToPixels(this._options.nudgeIncrement);\n  }\n\n  this.scrollWaveform({ pixels: increment });\n};\n\nWaveformZoomView.prototype.setWaveformData = function(waveformData) {\n  this._originalWaveformData = waveformData;\n  // Clear cached waveforms\n  this._initWaveformCache();\n\n  // Don't update the UI here, call setZoom().\n};\n\n/**\n * Returns the position of the playhead marker, in pixels relative to the\n * left hand side of the waveform view.\n *\n * @return {Number}\n */\n\nWaveformZoomView.prototype.getPlayheadOffset = function() {\n  return this._playheadLayer.getPlayheadPixel() - this._frameOffset;\n};\n\nWaveformZoomView.prototype.getPlayheadClickTolerance = function() {\n  return this._playheadClickTolerance;\n};\n\nWaveformZoomView.prototype._syncPlayhead = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n\n  if (this._autoScroll && !this._zoomLevelAuto) {\n    // Check for the playhead reaching the right-hand side of the window.\n\n    const pixelIndex = this.timeToPixels(time);\n\n    // TODO: move this code to animation function?\n    // TODO: don't scroll if user has positioned view manually (e.g., using\n    // the keyboard)\n    const endThreshold = this._frameOffset + this._width - this._autoScrollOffset;\n\n    let frameOffset = this._frameOffset;\n\n    if (pixelIndex >= endThreshold || pixelIndex < frameOffset) {\n      // Put the playhead at 100 pixels from the left edge\n      frameOffset = pixelIndex - this._autoScrollOffset;\n\n      if (frameOffset < 0) {\n        frameOffset = 0;\n      }\n\n      this.updateWaveform(frameOffset, false);\n    }\n  }\n};\n\nWaveformZoomView.prototype._getScale = function(duration) {\n  return Math.floor(duration * this._data.sample_rate / this._width);\n};\n\nfunction isAutoScale(options) {\n  return ((objectHasProperty(options, 'scale') && options.scale === 'auto') ||\n          (objectHasProperty(options, 'seconds') && options.seconds === 'auto'));\n}\n\n/**\n * Options for [WaveformZoomView.setZoom]{@link WaveformZoomView#setZoom}.\n *\n * @typedef {Object} SetZoomOptions\n * @global\n * @property {Number|String} scale Zoom level, in samples per pixel, or 'auto'\n *   to fit the entire waveform to the view width\n * @property {Number|String} seconds Number of seconds to fit to the view width,\n *   or 'auto' to fit the entire waveform to the view width\n */\n\n/**\n * Changes the zoom level.\n *\n * @param {SetZoomOptions} options\n * @returns {Boolean}\n */\n\nWaveformZoomView.prototype.setZoom = function(options) {\n  let scale;\n\n  if (isAutoScale(options)) {\n    // Use waveform duration, to match WaveformOverview\n    const seconds = this._originalWaveformData.duration;\n\n    this._zoomLevelAuto = true;\n    this._zoomLevelSeconds = null;\n    scale = this._getScale(seconds);\n  }\n  else {\n    if (objectHasProperty(options, 'scale')) {\n      this._zoomLevelSeconds = null;\n      scale = Math.floor(options.scale);\n    }\n    else if (objectHasProperty(options, 'seconds')) {\n      if (!isValidTime(options.seconds)) {\n        return false;\n      }\n\n      this._zoomLevelSeconds = options.seconds;\n      scale = this._getScale(options.seconds);\n    }\n\n    this._zoomLevelAuto = false;\n  }\n\n  if (scale < this._originalWaveformData.scale) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    this._peaks._logger('peaks.zoomview.setZoom(): zoom level must be at least ' + this._originalWaveformData.scale);\n    scale = this._originalWaveformData.scale;\n  }\n\n  const currentTime = this._peaks.player.getCurrentTime();\n  let apexTime;\n  let playheadOffsetPixels = this.getPlayheadOffset();\n\n  if (playheadOffsetPixels >= 0 && playheadOffsetPixels < this._width) {\n    // Playhead is visible. Change the zoom level while keeping the\n    // playhead at the same position in the window.\n    apexTime = currentTime;\n  }\n  else {\n    // Playhead is not visible. Change the zoom level while keeping the\n    // centre of the window at the same position in the waveform.\n    playheadOffsetPixels = Math.floor(this._width / 2);\n    apexTime = this.pixelOffsetToTime(playheadOffsetPixels);\n  }\n\n  const prevScale = this._scale;\n\n  this._resampleData({ scale: scale });\n\n  const apexPixel = this.timeToPixels(apexTime);\n\n  const frameOffset = apexPixel - playheadOffsetPixels;\n\n  this.updateWaveform(frameOffset, true);\n\n  this._playheadLayer.zoomLevelChanged();\n\n  // Update the playhead position after zooming.\n  this._playheadLayer.updatePlayheadTime(currentTime);\n\n  this._peaks.emit('zoom.update', {\n    currentZoom: scale,\n    previousZoom: prevScale\n  });\n\n  return true;\n};\n\nWaveformZoomView.prototype._resampleData = function(options) {\n  const scale = options.scale;\n\n  if (this._enableWaveformCache) {\n    if (!this._waveformData.has(scale)) {\n      let sourceWaveform = this._originalWaveformData;\n\n      // Resample from the next lowest available zoom level\n\n      for (let i = 0; i < this._waveformScales.length; i++) {\n        if (this._waveformScales[i] < scale) {\n          sourceWaveform = this._waveformData.get(this._waveformScales[i]);\n        }\n        else {\n          break;\n        }\n      }\n\n      this._waveformData.set(scale, sourceWaveform.resample(options));\n\n      this._waveformScales.push(scale);\n      this._waveformScales.sort(function(a, b) {\n        return a - b; // Ascending order\n      });\n    }\n\n    this._data = this._waveformData.get(scale);\n  }\n  else {\n    this._data = this._originalWaveformData.resample(options);\n  }\n\n  this._scale = this._data.scale;\n  this._pixelLength = this._data.length;\n};\n\nWaveformZoomView.prototype.isAutoZoom = function() {\n  return this._zoomLevelAuto;\n};\n\nWaveformZoomView.prototype.setStartTime = function(time) {\n  if (time < 0) {\n    time = 0;\n  }\n\n  if (this._zoomLevelAuto) {\n    time = 0;\n  }\n\n  this.updateWaveform(this.timeToPixels(time), false);\n};\n\n/**\n * @returns {Number} The length of the waveform, in pixels.\n */\n\nWaveformZoomView.prototype.getPixelLength = function() {\n  return this._pixelLength;\n};\n\n/**\n * Scrolls the region of waveform shown in the view.\n *\n * @param {Number} scrollAmount How far to scroll, in pixels\n */\n\nWaveformZoomView.prototype.scrollWaveform = function(options) {\n  let scrollAmount;\n\n  if (objectHasProperty(options, 'pixels')) {\n    scrollAmount = Math.floor(options.pixels);\n  }\n  else if (objectHasProperty(options, 'seconds')) {\n    scrollAmount = this.timeToPixels(options.seconds);\n  }\n  else {\n    throw new TypeError('view.scrollWaveform(): Missing umber of pixels or seconds');\n  }\n\n  this.updateWaveform(this._frameOffset + scrollAmount, false);\n};\n\n/**\n * Updates the region of waveform shown in the view.\n *\n * @param {Number} frameOffset The new frame offset, in pixels.\n * @param {Boolean} forceUpdate Forces the waveform view to be redrawn, if the\n *   frameOffset is unchanged.\n */\n\nWaveformZoomView.prototype.updateWaveform = function(frameOffset, forceUpdate) {\n  let upperLimit;\n\n  if (this._pixelLength < this._width) {\n    // Total waveform is shorter than viewport, so reset the offset to 0.\n    frameOffset = 0;\n    upperLimit = this._width;\n  }\n  else {\n    // Calculate the very last possible position.\n    upperLimit = this._pixelLength - this._width;\n  }\n\n  frameOffset = clamp(frameOffset, 0, upperLimit);\n\n  if (!forceUpdate && frameOffset === this._frameOffset) {\n    return;\n  }\n\n  this._frameOffset = frameOffset;\n\n  // Display playhead if it is within the zoom frame width.\n  const playheadPixel = this._playheadLayer.getPlayheadPixel();\n\n  this._playheadLayer.updatePlayheadTime(this.pixelsToTime(playheadPixel));\n\n  this.drawWaveformLayer();\n  this._axisLayer.draw();\n\n  const frameStartTime = this.getStartTime();\n  const frameEndTime   = this.getEndTime();\n\n  if (this._pointsLayer) {\n    this._pointsLayer.updatePoints(frameStartTime, frameEndTime);\n  }\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.updateSegments(frameStartTime, frameEndTime);\n  }\n\n  this._peaks.emit('zoomview.update', {\n    startTime: frameStartTime,\n    endTime: frameEndTime\n  });\n};\n\nWaveformZoomView.prototype.enableAutoScroll = function(enable, options) {\n  if (!options) {\n    options = {};\n  }\n\n  this._autoScroll = enable;\n\n  if (objectHasProperty(options, 'offset')) {\n    this._autoScrollOffset = options.offset;\n  }\n};\n\nWaveformZoomView.prototype.getMinSegmentDragWidth = function() {\n  return this._insertSegmentShape ? 0 : this._minSegmentDragWidth;\n};\n\nWaveformZoomView.prototype.setMinSegmentDragWidth = function(width) {\n  this._minSegmentDragWidth = width;\n};\n\nWaveformZoomView.prototype.containerWidthChange = function() {\n  let resample = false;\n  let resampleOptions;\n\n  if (this._zoomLevelAuto) {\n    resample = true;\n    resampleOptions = { width: this._width };\n  }\n  else if (this._zoomLevelSeconds !== null) {\n    resample = true;\n    resampleOptions = { scale: this._getScale(this._zoomLevelSeconds) };\n  }\n\n  if (resample) {\n    try {\n      this._resampleData(resampleOptions);\n    }\n    catch (error) { // eslint-disable-line no-unused-vars\n      // Ignore, and leave this._data as it was\n    }\n  }\n\n  return true;\n};\n\nWaveformZoomView.prototype.containerHeightChange = function() {\n  // Nothing\n};\n\nWaveformZoomView.prototype.getStage = function() {\n  return this._stage;\n};\n\nWaveformZoomView.prototype.getSegmentsLayer = function() {\n  return this._segmentsLayer;\n};\n\nWaveformZoomView.prototype.destroy = function() {\n  // Unregister event handlers\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.pause', this._onPause);\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('keyboard.left', this._onKeyboardLeft);\n  this._peaks.off('keyboard.right', this._onKeyboardRight);\n  this._peaks.off('keyboard.shift_left', this._onKeyboardShiftLeft);\n  this._peaks.off('keyboard.shift_right', this._onKeyboardShiftRight);\n\n  if (this._enableWaveformCache) {\n    this._waveformData.clear();\n    delete this._waveformData;\n    delete this._waveformScales;\n  }\n  else {\n    delete this._data;\n  }\n\n  this._mouseDragHandler.destroy();\n\n  WaveformView.prototype.destroy.call(this);\n};\n\nexport default WaveformZoomView;\n","/**\n * @file\n *\n * Defines the {@link Scrollbar} class.\n *\n * @module scrollbar\n */\n\nimport { clamp } from './utils';\n\nimport Konva from 'konva/lib/Core';\nimport { Rect } from 'konva/lib/shapes/Rect';\n\n/**\n * Creates a scrollbar.\n *\n * @class\n * @alias Scrollbar\n *\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction Scrollbar(container, peaks) {\n  this._container = container;\n  this._peaks = peaks;\n  this._options = peaks.options.scrollbar;\n  this._zoomview = peaks.views.getView('zoomview');\n\n  this._dragBoundFunc = this._dragBoundFunc.bind(this);\n  this._onScrollboxDragStart = this._onScrollboxDragStart.bind(this);\n  this._onScrollboxDragMove = this._onScrollboxDragMove.bind(this);\n  this._onScrollboxDragEnd = this._onScrollboxDragEnd.bind(this);\n  this._onZoomviewUpdate = this._onZoomviewUpdate.bind(this);\n  this._onScrollbarClick = this._onScrollbarClick.bind(this);\n\n  this._peaks.on('zoomview.update', this._onZoomviewUpdate);\n\n  this._width = container.clientWidth;\n  this._height = container.clientHeight;\n\n  this._stage = new Konva.Stage({\n    container: container,\n    width: this._width,\n    height: this._height\n  });\n\n  this._layer = new Konva.Layer();\n  this._stage.on('click', this._onScrollbarClick);\n\n  this._stage.add(this._layer);\n\n  this._color = this._options.color;\n  this._scrollboxX = 0;\n  this._minScrollboxWidth = this._options.minWidth;\n\n  this._offsetY = 0;\n\n  this._scrollbox = new Konva.Group({\n    draggable:     true,\n    dragBoundFunc: this._dragBoundFunc\n  });\n\n  this._scrollboxRect = new Rect({\n    x:      this._scrollboxX,\n    y:      this._offsetY,\n    width:  0,\n    height: this._height,\n    fill:   this._color\n  });\n\n  this._scrollbox.add(this._scrollboxRect);\n  this._setScrollboxWidth();\n\n  this._scrollbox.on('dragstart', this._onScrollboxDragStart);\n  this._scrollbox.on('dragmove', this._onScrollboxDragMove);\n  this._scrollbox.on('dragend', this._onScrollboxDragEnd);\n\n  this._layer.add(this._scrollbox);\n\n  this._updateScrollbarWidthAndPosition();\n}\n\nScrollbar.prototype.setZoomview = function(zoomview) {\n  this._zoomview = zoomview;\n\n  this._updateScrollbarWidthAndPosition();\n};\n\n/**\n * Sets the width of the scrollbox, based on the visible waveform region\n * in the zoomview and minimum scrollbox width option.\n */\n\nScrollbar.prototype._setScrollboxWidth = function() {\n  if (this._zoomview) {\n    this._scrollboxWidth = Math.floor(\n      this._width * this._zoomview.pixelsToTime(this._zoomview.getWidth()) /\n        this._peaks.player.getDuration()\n    );\n\n    if (this._scrollboxWidth < this._minScrollboxWidth) {\n      this._scrollboxWidth = this._minScrollboxWidth;\n    }\n  }\n  else {\n    this._scrollboxWidth = this._width;\n  }\n\n  this._scrollboxRect.width(this._scrollboxWidth);\n};\n\n/**\n * @returns {Number} The maximum scrollbox position, in pixels.\n */\n\nScrollbar.prototype._getScrollbarRange = function() {\n  return this._width - this._scrollboxWidth;\n};\n\nScrollbar.prototype._dragBoundFunc = function(pos) {\n  // Allow the scrollbar to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: 0\n  };\n};\n\nScrollbar.prototype._onScrollboxDragStart = function() {\n  this._dragging = true;\n};\n\nScrollbar.prototype._onScrollboxDragEnd = function() {\n  this._dragging = false;\n};\n\nScrollbar.prototype._onScrollboxDragMove = function() {\n  const range = this._getScrollbarRange();\n  const x = clamp(this._scrollbox.x(), 0, range);\n\n  this._scrollbox.x(x);\n\n  if (x !== this._scrollboxX) {\n    this._scrollboxX = x;\n\n    if (this._zoomview) {\n      this._updateWaveform(x);\n    }\n  }\n};\n\nScrollbar.prototype._onZoomviewUpdate = function(/* event */) {\n  if (!this._dragging) {\n    this._updateScrollbarWidthAndPosition();\n  }\n};\n\nScrollbar.prototype._updateScrollbarWidthAndPosition = function() {\n  this._setScrollboxWidth();\n\n  if (this._zoomview) {\n    const startTime = this._zoomview.getStartTime();\n\n    const zoomviewRange = this._zoomview.getPixelLength() - this._zoomview.getWidth();\n\n    const scrollBoxPos = Math.floor(\n      this._zoomview.timeToPixels(startTime) * this._getScrollbarRange() / zoomviewRange\n    );\n\n    this._scrollbox.x(scrollBoxPos);\n    this._layer.draw();\n  }\n};\n\nScrollbar.prototype._onScrollbarClick = function(event) {\n  // Handle clicks on the scrollbar outside the scrollbox.\n  if (event.target === this._stage) {\n    if (this._zoomview) {\n      // Centre the scrollbox where the user clicked.\n      let x = Math.floor(event.evt.offsetX - this._scrollboxWidth / 2);\n\n      if (x < 0) {\n        x = 0;\n      }\n\n      this._updateWaveform(x);\n    }\n  }\n};\n\n/**\n * Sets the zoomview waveform position based on scrollbar position.\n */\n\nScrollbar.prototype._updateWaveform = function(x) {\n  const offset = Math.floor(\n    (this._zoomview.getPixelLength() - this._zoomview.getWidth()) * x / this._getScrollbarRange()\n  );\n\n  this._zoomview.updateWaveform(offset);\n};\n\nScrollbar.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.width(this._width);\n\n    this._updateScrollbarWidthAndPosition();\n  }\n\n  this._height = this._container.clientHeight;\n  this._stage.height(this._height);\n};\n\nScrollbar.prototype.destroy = function() {\n  this._peaks.off('zoomview.update', this._onZoomviewUpdate);\n\n  this._layer.destroy();\n\n  this._stage.destroy();\n  this._stage = null;\n};\n\nexport default Scrollbar;\n","/**\n * @file\n *\n * Defines the {@link ViewController} class.\n *\n * @module view-controller\n */\n\nimport WaveformOverview from './waveform-overview';\nimport WaveformZoomView from './waveform-zoomview';\nimport Scrollbar from './scrollbar';\nimport { isNullOrUndefined } from './utils';\n\n/**\n * Creates an object that allows users to create and manage waveform views.\n *\n * @class\n * @alias ViewController\n *\n * @param {Peaks} peaks\n */\n\nfunction ViewController(peaks) {\n  this._peaks = peaks;\n  this._overview = null;\n  this._zoomview = null;\n  this._scrollbar = null;\n}\n\nViewController.prototype.createOverview = function(container) {\n  if (this._overview) {\n    return this._overview;\n  }\n\n  const waveformData = this._peaks.getWaveformData();\n\n  this._overview = new WaveformOverview(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  if (this._zoomview) {\n    this._overview.showHighlight(\n      this._zoomview.getStartTime(),\n      this._zoomview.getEndTime()\n    );\n  }\n\n  return this._overview;\n};\n\nViewController.prototype.createZoomview = function(container) {\n  if (this._zoomview) {\n    return this._zoomview;\n  }\n\n  const waveformData = this._peaks.getWaveformData();\n\n  this._zoomview = new WaveformZoomView(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  if (this._scrollbar) {\n    this._scrollbar.setZoomview(this._zoomview);\n  }\n\n  return this._zoomview;\n};\n\nViewController.prototype.createScrollbar = function(container) {\n  this._scrollbar = new Scrollbar(\n    container,\n    this._peaks\n  );\n\n  return this._scrollbar;\n};\n\nViewController.prototype.destroyOverview = function() {\n  if (!this._overview) {\n    return;\n  }\n\n  if (!this._zoomview) {\n    return;\n  }\n\n  this._overview.destroy();\n  this._overview = null;\n};\n\nViewController.prototype.destroyZoomview = function() {\n  if (!this._zoomview) {\n    return;\n  }\n\n  if (!this._overview) {\n    return;\n  }\n\n  this._zoomview.destroy();\n  this._zoomview = null;\n\n  this._overview.removeHighlightRect();\n};\n\nViewController.prototype.destroy = function() {\n  if (this._overview) {\n    this._overview.destroy();\n    this._overview = null;\n  }\n\n  if (this._zoomview) {\n    this._zoomview.destroy();\n    this._zoomview = null;\n  }\n\n  if (this._scrollbar) {\n    this._scrollbar.destroy();\n    this._scrollbar = null;\n  }\n};\n\nViewController.prototype.getView = function(name) {\n  if (isNullOrUndefined(name)) {\n    if (this._overview && this._zoomview) {\n      return null;\n    }\n    else if (this._overview) {\n      return this._overview;\n    }\n    else if (this._zoomview) {\n      return this._zoomview;\n    }\n    else {\n      return null;\n    }\n  }\n  else {\n    switch (name) {\n      case 'overview':\n        return this._overview;\n\n      case 'zoomview':\n        return this._zoomview;\n\n      default:\n        return null;\n    }\n  }\n};\n\nViewController.prototype.getScrollbar = function() {\n  return this._scrollbar;\n};\n\nexport default ViewController;\n","/**\n * @file\n *\n * Defines the {@link ZoomController} class.\n *\n * @module zoom-controller\n */\n\n/**\n * Creates an object to control zoom levels in a {@link WaveformZoomView}.\n *\n * @class\n * @alias ZoomController\n *\n * @param {Peaks} peaks\n * @param {Array<Integer>} zoomLevels\n */\n\nfunction ZoomController(peaks, zoomLevels) {\n  this._peaks = peaks;\n  this._zoomLevels = zoomLevels;\n  this._zoomLevelIndex = 0;\n}\n\nZoomController.prototype.setZoomLevels = function(zoomLevels) {\n  this._zoomLevels = zoomLevels;\n  this.setZoom(0, true);\n};\n\n/**\n * Zoom in one level.\n */\n\nZoomController.prototype.zoomIn = function() {\n  this.setZoom(this._zoomLevelIndex - 1, false);\n};\n\n/**\n * Zoom out one level.\n */\n\nZoomController.prototype.zoomOut = function() {\n  this.setZoom(this._zoomLevelIndex + 1, false);\n};\n\n/**\n * Given a particular zoom level, triggers a resampling of the data in the\n * zoomed view.\n *\n * @param {number} zoomLevelIndex An index into the options.zoomLevels array.\n */\n\nZoomController.prototype.setZoom = function(zoomLevelIndex, forceUpdate) {\n  if (zoomLevelIndex >= this._zoomLevels.length) {\n    zoomLevelIndex = this._zoomLevels.length - 1;\n  }\n\n  if (zoomLevelIndex < 0) {\n    zoomLevelIndex = 0;\n  }\n\n  if (!forceUpdate && (zoomLevelIndex === this._zoomLevelIndex)) {\n    // Nothing to do.\n    return;\n  }\n\n  this._zoomLevelIndex = zoomLevelIndex;\n\n  const zoomview = this._peaks.views.getView('zoomview');\n\n  if (!zoomview) {\n    return;\n  }\n\n  zoomview.setZoom({ scale: this._zoomLevels[zoomLevelIndex] });\n};\n\n/**\n * Returns the current zoom level index.\n *\n * @returns {Number}\n */\n\nZoomController.prototype.getZoom = function() {\n  return this._zoomLevelIndex;\n};\n\n/**\n * Returns the current zoom level, in samples per pixel.\n *\n * @returns {Number}\n */\n\nZoomController.prototype.getZoomLevel = function() {\n  return this._zoomLevels[this._zoomLevelIndex];\n};\n\nexport default ZoomController;\n","/**\n * @file\n *\n * Defines the {@link WaveformBuilder} class.\n *\n * @module waveform-builder\n */\n\nimport { isArrayBuffer, isObject } from './utils';\nimport WaveformData from 'waveform-data';\n\nconst isXhr2 = ('withCredentials' in new XMLHttpRequest());\n\n/**\n * Creates and returns a WaveformData object, either by requesting the\n * waveform data from the server, or by creating the waveform data using the\n * Web Audio API.\n *\n * @class\n * @alias WaveformBuilder\n *\n * @param {Peaks} peaks\n */\n\nfunction WaveformBuilder(peaks) {\n  this._peaks = peaks;\n}\n\n/**\n * Options for requesting remote waveform data.\n *\n * @typedef {Object} RemoteWaveformDataOptions\n * @global\n * @property {String=} arraybuffer\n * @property {String=} json\n */\n\n/**\n * Options for supplying local waveform data.\n *\n * @typedef {Object} LocalWaveformDataOptions\n * @global\n * @property {ArrayBuffer=} arraybuffer\n * @property {Object=} json\n */\n\n/**\n * Options for the Web Audio waveform builder.\n *\n * @typedef {Object} WaveformBuilderWebAudioOptions\n * @global\n * @property {AudioContext} audioContext\n * @property {AudioBuffer=} audioBuffer\n * @property {Number=} scale\n * @property {Boolean=} multiChannel\n */\n\n/**\n * Options for [WaveformBuilder.init]{@link WaveformBuilder#init}.\n *\n * @typedef {Object} WaveformBuilderInitOptions\n * @global\n * @property {RemoteWaveformDataOptions=} dataUri\n * @property {LocalWaveformDataOptions=} waveformData\n * @property {WaveformBuilderWebAudioOptions=} webAudio\n * @property {Boolean=} withCredentials\n * @property {Array<Number>=} zoomLevels\n */\n\n/**\n * Callback for receiving the waveform data.\n *\n * @callback WaveformBuilderInitCallback\n * @global\n * @param {Error} error\n * @param {WaveformData} waveformData\n */\n\n/**\n * Loads or creates the waveform data.\n *\n * @private\n * @param {WaveformBuilderInitOptions} options\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype.init = function(options, callback) {\n  if ((options.dataUri && (options.webAudio || options.audioContext)) ||\n      (options.waveformData && (options.webAudio || options.audioContext)) ||\n      (options.dataUri && options.waveformData)) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    callback(new TypeError('Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data.'));\n    return;\n  }\n\n  if (options.audioContext) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    this._peaks._logger('Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead');\n\n    options.webAudio = {\n      audioContext: options.audioContext\n    };\n  }\n\n  if (options.dataUri) {\n    return this._getRemoteWaveformData(options, callback);\n  }\n  else if (options.waveformData) {\n    return this._buildWaveformFromLocalData(options, callback);\n  }\n  else if (options.webAudio) {\n    if (options.webAudio.audioBuffer) {\n      return this._buildWaveformDataFromAudioBuffer(options, callback);\n    }\n    else {\n      return this._buildWaveformDataUsingWebAudio(options, callback);\n    }\n  }\n  else {\n    // eslint-disable-next-line @stylistic/js/max-len\n    callback(new Error('Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data'));\n  }\n};\n\nfunction hasValidContentRangeHeader(xhr) {\n  const contentRange = xhr.getResponseHeader('content-range');\n\n  if (!contentRange) {\n    return false;\n  }\n\n  const matches = contentRange.match(/^bytes (\\d+)-(\\d+)\\/(\\d+)$/);\n\n  if (matches && matches.length === 4) {\n    const firstPos = parseInt(matches[1], 10);\n    const lastPos = parseInt(matches[2], 10);\n    const length = parseInt(matches[3], 10);\n\n    if (firstPos === 0 && (lastPos + 1) === length) {\n      return true;\n    }\n\n    return false;\n  }\n\n  return false;\n}\n\n/* eslint-disable @stylistic/js/max-len */\n\n/**\n * Fetches waveform data, based on the given options.\n *\n * @private\n * @param {Object} options\n * @param {String|Object} options.dataUri\n * @param {String} options.dataUri.arraybuffer Waveform data URL\n *   (binary format)\n * @param {String} options.dataUri.json Waveform data URL (JSON format)\n * @param {String} options.defaultUriFormat Either 'arraybuffer' (for binary\n *   data) or 'json'\n * @param {WaveformBuilderInitCallback} callback\n *\n * @see Refer to the <a href=\"https://codeberg.org/chrisn/audiowaveform/src/branch/master/doc/DataFormat.md\">data format documentation</a>\n *   for details of the binary and JSON waveform data formats.\n */\n\n/* eslint-enable @stylistic/js/max-len */\n\nWaveformBuilder.prototype._getRemoteWaveformData = function(options, callback) {\n  const self = this;\n\n  let dataUri = null;\n  let requestType = null;\n  let url;\n\n  if (isObject(options.dataUri)) {\n    dataUri = options.dataUri;\n  }\n  else {\n    callback(new TypeError('Peaks.init(): The dataUri option must be an object'));\n    return;\n  }\n\n  ['ArrayBuffer', 'JSON'].some(function(connector) {\n    if (window[connector]) {\n      requestType = connector.toLowerCase();\n      url = dataUri[requestType];\n\n      return Boolean(url);\n    }\n  });\n\n  if (!url) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    callback(new Error('Peaks.init(): Unable to determine a compatible dataUri format for this browser'));\n    return;\n  }\n\n  self._xhr = self._createXHR(url, requestType, options.withCredentials, function(event) {\n    if (this.readyState !== 4) {\n      return;\n    }\n\n    // See https://codeberg.org/chrisn/peaks.js/issues/491\n\n    if (this.status !== 200 &&\n        !(this.status === 206 && hasValidContentRangeHeader(this))) {\n      callback(\n        new Error('Unable to fetch remote data. HTTP status ' + this.status)\n      );\n\n      return;\n    }\n\n    self._xhr = null;\n\n    const waveformData = WaveformData.create(event.target.response);\n\n    if (waveformData.channels !== 1 && waveformData.channels !== 2) {\n      callback(new Error('Peaks.init(): Only mono or stereo waveforms are currently supported'));\n      return;\n    }\n    else if (waveformData.bits !== 8) {\n      callback(new Error('Peaks.init(): 16-bit waveform data is not supported'));\n      return;\n    }\n\n    callback(undefined, waveformData);\n  },\n  function() {\n    callback(new Error('XHR failed'));\n  },\n  function() {\n    callback(new Error('XHR aborted'));\n  });\n\n  self._xhr.send();\n};\n\n/* eslint-disable @stylistic/js/max-len */\n\n/**\n * Creates a waveform from given data, based on the given options.\n *\n * @private\n * @param {Object} options\n * @param {Object} options.waveformData\n * @param {ArrayBuffer} options.waveformData.arraybuffer Waveform data (binary format)\n * @param {Object} options.waveformData.json Waveform data (JSON format)\n * @param {WaveformBuilderInitCallback} callback\n *\n * @see Refer to the <a href=\"https://codeberg.org/chrisn/audiowaveform/src/branch/master/doc/DataFormat.md\">data format documentation</a>\n *   for details of the binary and JSON waveform data formats.\n */\n\n/* eslint-enable @stylistic/js/max-len */\n\nWaveformBuilder.prototype._buildWaveformFromLocalData = function(options, callback) {\n  let waveformData = null;\n  let data = null;\n\n  if (isObject(options.waveformData)) {\n    waveformData = options.waveformData;\n  }\n  else {\n    callback(new Error('Peaks.init(): The waveformData option must be an object'));\n    return;\n  }\n\n  if (isObject(waveformData.json)) {\n    data = waveformData.json;\n  }\n  else if (isArrayBuffer(waveformData.arraybuffer)) {\n    data = waveformData.arraybuffer;\n  }\n\n  if (!data) {\n    callback(new Error('Peaks.init(): Unable to determine a compatible waveformData format'));\n    return;\n  }\n\n  try {\n    const createdWaveformData = WaveformData.create(data);\n\n    if (createdWaveformData.channels !== 1 && createdWaveformData.channels !== 2) {\n      callback(new Error('Peaks.init(): Only mono or stereo waveforms are currently supported'));\n      return;\n    }\n    else if (createdWaveformData.bits !== 8) {\n      callback(new Error('Peaks.init(): 16-bit waveform data is not supported'));\n      return;\n    }\n\n    callback(undefined, createdWaveformData);\n  }\n  catch (err) {\n    callback(err);\n  }\n};\n\n/**\n * Creates waveform data using the Web Audio API.\n *\n * @private\n * @param {Object} options\n * @param {AudioContext} options.audioContext\n * @param {HTMLMediaElement} options.mediaElement\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype._buildWaveformDataUsingWebAudio = function(options, callback) {\n  const self = this;\n\n  const audioContext = window.AudioContext || window.webkitAudioContext;\n\n  if (!(options.webAudio.audioContext instanceof audioContext)) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    callback(new TypeError('Peaks.init(): The webAudio.audioContext option must be a valid AudioContext'));\n    return;\n  }\n\n  const webAudioOptions = options.webAudio;\n\n  if (webAudioOptions.scale !== options.zoomLevels[0]) {\n    webAudioOptions.scale = options.zoomLevels[0];\n  }\n\n  // If the media element has already selected which source to play, its\n  // currentSrc attribute will contain the source media URL. Otherwise,\n  // we wait for a canplay event to tell us when the media is ready.\n\n  const mediaSourceUrl = self._peaks.options.mediaElement.currentSrc;\n\n  if (mediaSourceUrl) {\n    self._requestAudioAndBuildWaveformData(\n      mediaSourceUrl,\n      webAudioOptions,\n      options.withCredentials,\n      callback\n    );\n  }\n  else {\n    self._peaks.once('player.canplay', function() {\n      self._requestAudioAndBuildWaveformData(\n        self._peaks.options.mediaElement.currentSrc,\n        webAudioOptions,\n        options.withCredentials,\n        callback\n      );\n    });\n  }\n};\n\nWaveformBuilder.prototype._buildWaveformDataFromAudioBuffer = function(options, callback) {\n  const webAudioOptions = options.webAudio;\n\n  if (webAudioOptions.scale !== options.zoomLevels[0]) {\n    webAudioOptions.scale = options.zoomLevels[0];\n  }\n\n  const webAudioBuilderOptions = {\n    audio_buffer: webAudioOptions.audioBuffer,\n    split_channels: webAudioOptions.multiChannel,\n    scale: webAudioOptions.scale,\n    disable_worker: true\n  };\n\n  WaveformData.createFromAudio(webAudioBuilderOptions, callback);\n};\n\n/**\n * Fetches the audio content, based on the given options, and creates waveform\n * data using the Web Audio API.\n *\n * @private\n * @param {url} The media source URL\n * @param {WaveformBuilderWebAudioOptions} webAudio\n * @param {Boolean} withCredentials\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype._requestAudioAndBuildWaveformData = function(url,\n    webAudio, withCredentials, callback) {\n  const self = this;\n\n  if (!url) {\n    self._peaks._logger('Peaks.init(): The mediaElement src is invalid');\n    return;\n  }\n\n  self._xhr = self._createXHR(url, 'arraybuffer', withCredentials, function(event) {\n    if (this.readyState !== 4) {\n      return;\n    }\n\n    // See https://codeberg.org/chrisn/peaks.js/issues/491\n\n    if (this.status !== 200 &&\n        !(this.status === 206 && hasValidContentRangeHeader(this))) {\n      callback(\n        new Error('Unable to fetch remote data. HTTP status ' + this.status)\n      );\n\n      return;\n    }\n\n    self._xhr = null;\n\n    const webAudioBuilderOptions = {\n      audio_context: webAudio.audioContext,\n      array_buffer: event.target.response,\n      split_channels: webAudio.multiChannel,\n      scale: webAudio.scale\n    };\n\n    WaveformData.createFromAudio(webAudioBuilderOptions, callback);\n  },\n  function() {\n    callback(new Error('XHR failed'));\n  },\n  function() {\n    callback(new Error('XHR aborted'));\n  });\n\n  self._xhr.send();\n};\n\nWaveformBuilder.prototype.abort = function() {\n  if (this._xhr) {\n    this._xhr.abort();\n  }\n};\n\n/**\n * @private\n * @param {String} url\n * @param {String} requestType\n * @param {Boolean} withCredentials\n * @param {Function} onLoad\n * @param {Function} onError\n *\n * @returns {XMLHttpRequest}\n */\n\nWaveformBuilder.prototype._createXHR = function(url, requestType,\n    withCredentials, onLoad, onError, onAbort) {\n  const xhr = new XMLHttpRequest();\n\n  // open an XHR request to the data source file\n  xhr.open('GET', url, true);\n\n  if (isXhr2) {\n    try {\n      xhr.responseType = requestType;\n    }\n    catch (error) { // eslint-disable-line no-unused-vars\n      // Some browsers like Safari 6 do handle XHR2 but not the json\n      // response type, doing only a try/catch fails in IE9\n    }\n  }\n\n  xhr.onload = onLoad;\n  xhr.onerror = onError;\n\n  if (isXhr2 && withCredentials) {\n    xhr.withCredentials = true;\n  }\n\n  xhr.addEventListener('abort', onAbort);\n\n  return xhr;\n};\n\nexport default WaveformBuilder;\n","/**\n * @file\n *\n * Defines the {@link Peaks} class.\n *\n * @module main\n */\n\nimport EventEmitter from 'eventemitter3';\nimport CueEmitter from './cue-emitter';\nimport WaveformPoints from './waveform-points';\nimport WaveformSegments from './waveform-segments';\nimport KeyboardHandler from './keyboard-handler';\nimport MediaElementPlayer from './mediaelement-player';\nimport Player from './player';\nimport { createPointMarker, createSegmentMarker, createSegmentLabel } from './marker-factories';\nimport ViewController from './view-controller';\nimport ZoomController from './zoom-controller';\nimport WaveformBuilder from './waveform-builder';\nimport {\n  isHTMLElement, isFunction, isInAscendingOrder, isObject,\n  objectHasProperty,\n  extend\n} from './utils';\n\n/**\n * Initialises a new Peaks instance with default option settings.\n *\n * @class\n * @alias Peaks\n *\n * @param {Object} opts Configuration options\n */\n\nfunction Peaks() {\n  EventEmitter.call(this);\n\n  // Set default options\n  this.options = {\n    zoomLevels:          [512, 1024, 2048, 4096],\n    waveformCache:       true,\n\n    mediaElement:        null,\n    mediaUrl:            null,\n\n    dataUri:             null,\n    withCredentials:     false,\n\n    waveformData:        null,\n    webAudio:            null,\n\n    nudgeIncrement:      1.0,\n\n    pointMarkerColor:    '#39cccc',\n\n    createSegmentMarker: createSegmentMarker,\n    createSegmentLabel:  createSegmentLabel,\n    createPointMarker:   createPointMarker,\n\n    // eslint-disable-next-line no-console\n    logger:              console.error.bind(console)\n  };\n\n  return this;\n}\n\nPeaks.prototype = Object.create(EventEmitter.prototype);\n\nconst defaultViewOptions = {\n  playheadColor:           '#111111',\n  playheadTextColor:       '#aaaaaa',\n  playheadBackgroundColor: 'transparent',\n  playheadPadding:         2,\n  playheadWidth:           1,\n  axisGridlineColor:       '#cccccc',\n  showAxisLabels:          true,\n  axisTopMarkerHeight:     10,\n  axisBottomMarkerHeight:  10,\n  axisLabelColor:          '#aaaaaa',\n  fontFamily:              'sans-serif',\n  fontSize:                11,\n  fontStyle:               'normal',\n  timeLabelPrecision:      2,\n  enablePoints:            true,\n  enableSegments:          true\n};\n\nconst defaultZoomviewOptions = {\n  // showPlayheadTime:    true,\n  playheadClickTolerance: 3,\n  waveformColor:          'rgba(0, 225, 128, 1)',\n  wheelMode:              'none',\n  autoScroll:             true,\n  autoScrollOffset:       100,\n  enableEditing:          true\n};\n\nconst defaultOverviewOptions = {\n  // showPlayheadTime:    false,\n  waveformColor:          'rgba(0, 0, 0, 0.2)',\n  highlightColor:         '#aaaaaa',\n  highlightStrokeColor:   'transparent',\n  highlightOpacity:       0.3,\n  highlightOffset:        11,\n  highlightCornerRadius:  2,\n  enableEditing:          false\n};\n\nconst defaultSegmentOptions = {\n  overlay:                   false,\n  markers:                   true,\n  startMarkerColor:          '#aaaaaa',\n  endMarkerColor:            '#aaaaaa',\n  waveformColor:             '#0074d9',\n  overlayColor:              '#ff0000',\n  overlayOpacity:            0.3,\n  overlayBorderColor:        '#ff0000',\n  overlayBorderWidth:        2,\n  overlayCornerRadius:       5,\n  overlayOffset:             25,\n  overlayLabelAlign:         'left',\n  overlayLabelVerticalAlign: 'top',\n  overlayLabelPadding:       8,\n  overlayLabelColor:         '#000000',\n  overlayFontFamily:         'sans-serif',\n  overlayFontSize:           12,\n  overlayFontStyle:          'normal'\n};\n\nconst defaultScrollbarOptions = {\n  color: '#888888',\n  minWidth: 50\n};\n\nfunction getOverviewOptions(opts) {\n  const overviewOptions = {};\n\n  if (opts.overview && opts.overview.showPlayheadTime) {\n    overviewOptions.showPlayheadTime = opts.overview.showPlayheadTime;\n  }\n\n  const optNames = [\n    'container',\n    'waveformColor',\n    'playedWaveformColor',\n    'playheadColor',\n    'playheadTextColor',\n    'playheadBackgroundColor',\n    'playheadPadding',\n    'playheadWidth',\n    'formatPlayheadTime',\n    'timeLabelPrecision',\n    'axisGridlineColor',\n    'showAxisLabels',\n    'axisTopMarkerHeight',\n    'axisBottomMarkerHeight',\n    'axisLabelColor',\n    'formatAxisTime',\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'highlightColor',\n    'highlightStrokeColor',\n    'highlightOpacity',\n    'highlightCornerRadius',\n    'highlightOffset',\n    'enablePoints',\n    'enableSegments',\n    'enableEditing'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (opts.overview && objectHasProperty(opts.overview, optName)) {\n      overviewOptions[optName] = opts.overview[optName];\n    }\n    else if (objectHasProperty(opts, optName)) {\n      overviewOptions[optName] = opts[optName];\n    }\n    else if (!objectHasProperty(overviewOptions, optName)) {\n      if (objectHasProperty(defaultOverviewOptions, optName)) {\n        overviewOptions[optName] = defaultOverviewOptions[optName];\n      }\n      else if (objectHasProperty(defaultViewOptions, optName)) {\n        overviewOptions[optName] = defaultViewOptions[optName];\n      }\n    }\n  });\n\n  return overviewOptions;\n}\n\nfunction getZoomviewOptions(opts) {\n  const zoomviewOptions = {};\n\n  if (opts.showPlayheadTime) {\n    zoomviewOptions.showPlayheadTime = opts.showPlayheadTime;\n  }\n  else if (opts.zoomview && opts.zoomview.showPlayheadTime) {\n    zoomviewOptions.showPlayheadTime = opts.zoomview.showPlayheadTime;\n  }\n\n  const optNames = [\n    'container',\n    'waveformColor',\n    'playedWaveformColor',\n    'playheadColor',\n    'playheadTextColor',\n    'playheadBackgroundColor',\n    'playheadPadding',\n    'playheadWidth',\n    'formatPlayheadTime',\n    'playheadClickTolerance',\n    'timeLabelPrecision',\n    'axisGridlineColor',\n    'showAxisLabels',\n    'axisTopMarkerHeight',\n    'axisBottomMarkerHeight',\n    'axisLabelColor',\n    'formatAxisTime',\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'wheelMode',\n    'autoScroll',\n    'autoScrollOffset',\n    'enablePoints',\n    'enableSegments',\n    'enableEditing'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (opts.zoomview && objectHasProperty(opts.zoomview, optName)) {\n      zoomviewOptions[optName] = opts.zoomview[optName];\n    }\n    else if (objectHasProperty(opts, optName)) {\n      zoomviewOptions[optName] = opts[optName];\n    }\n    else if (!objectHasProperty(zoomviewOptions, optName)) {\n      if (objectHasProperty(defaultZoomviewOptions, optName)) {\n        zoomviewOptions[optName] = defaultZoomviewOptions[optName];\n      }\n      else if (objectHasProperty(defaultViewOptions, optName)) {\n        zoomviewOptions[optName] = defaultViewOptions[optName];\n      }\n    }\n  });\n\n  return zoomviewOptions;\n}\n\nfunction getScrollbarOptions(opts) {\n  if (!objectHasProperty(opts, 'scrollbar')) {\n    return null;\n  }\n\n  const scrollbarOptions = {};\n\n  const optNames = [\n    'container',\n    'color',\n    'minWidth'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (objectHasProperty(opts.scrollbar, optName)) {\n      scrollbarOptions[optName] = opts.scrollbar[optName];\n    }\n    else {\n      scrollbarOptions[optName] = defaultScrollbarOptions[optName];\n    }\n  });\n\n  return scrollbarOptions;\n}\n\nfunction extendOptions(to, from) {\n  for (const key in from) {\n    if (objectHasProperty(from, key) &&\n        objectHasProperty(to, key)) {\n      to[key] = from[key];\n    }\n  }\n\n  return to;\n}\n\nfunction addSegmentOptions(options, opts) {\n  options.segmentOptions = {};\n\n  extend(options.segmentOptions, defaultSegmentOptions);\n\n  if (opts.segmentOptions) {\n    extendOptions(options.segmentOptions, opts.segmentOptions);\n  }\n\n  options.zoomview.segmentOptions = {};\n  extend(options.zoomview.segmentOptions, options.segmentOptions);\n\n  if (opts.zoomview && opts.zoomview.segmentOptions) {\n    extendOptions(options.zoomview.segmentOptions, opts.zoomview.segmentOptions);\n  }\n\n  options.overview.segmentOptions = {};\n  extend(options.overview.segmentOptions, options.segmentOptions);\n\n  if (opts.overview && opts.overview.segmentOptions) {\n    extendOptions(options.overview.segmentOptions, opts.overview.segmentOptions);\n  }\n}\n\nfunction checkContainerElements(options) {\n  const zoomviewContainer = options.zoomview.container;\n  const overviewContainer = options.overview.container;\n\n  if (!isHTMLElement(zoomviewContainer) &&\n      !isHTMLElement(overviewContainer)) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    return new TypeError('Peaks.init(): The zoomview and/or overview container options must be valid HTML elements');\n  }\n\n  if (zoomviewContainer &&\n      (zoomviewContainer.clientWidth  <= 0 ||\n       zoomviewContainer.clientHeight <= 0)) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    return new Error('Peaks.init(): The zoomview container must be visible and have non-zero width and height');\n  }\n\n  if (overviewContainer &&\n      (overviewContainer.clientWidth  <= 0 ||\n       overviewContainer.clientHeight <= 0)) {\n    // eslint-disable-next-line @stylistic/js/max-len\n    return new Error('Peaks.init(): The overview container must be visible and have non-zero width and height');\n  }\n}\n\n/**\n * Creates and initialises a new Peaks instance with the given options.\n *\n * @param {Object} opts Configuration options\n * @param {Function} callback\n *\n * @return {Peaks}\n */\n\nPeaks.init = function(opts, callback) {\n  if (!callback) {\n    throw new Error('Peaks.init(): Missing callback function');\n  }\n\n  const instance = new Peaks();\n\n  let err = instance._setOptions(opts);\n\n  if (!err) {\n    err = checkContainerElements(instance.options);\n  }\n\n  if (err) {\n    callback(err);\n    return;\n  }\n\n  let scrollbarContainer = null;\n\n  if (instance.options.scrollbar) {\n    scrollbarContainer = instance.options.scrollbar.container;\n\n    if (!isHTMLElement(scrollbarContainer)) {\n    // eslint-disable-next-line @stylistic/js/max-len\n      callback(new TypeError('Peaks.init(): The scrollbar container option must be a valid HTML element'));\n      return;\n    }\n\n    if (scrollbarContainer.clientWidth <= 0) {\n    // eslint-disable-next-line @stylistic/js/max-len\n      callback(new TypeError('Peaks.init(): The scrollbar container must be visible and have non-zero width'));\n      return;\n    }\n  }\n\n  if (opts.keyboard) {\n    instance._keyboardHandler = new KeyboardHandler(instance);\n  }\n\n  const player = opts.player ?\n    opts.player :\n    new MediaElementPlayer(instance.options.mediaElement);\n\n  instance.player = new Player(instance, player);\n  instance.segments = new WaveformSegments(instance);\n  instance.points = new WaveformPoints(instance);\n  instance.zoom = new ZoomController(instance, instance.options.zoomLevels);\n  instance.views = new ViewController(instance);\n\n  // Setup the UI components\n  instance._waveformBuilder = new WaveformBuilder(instance);\n\n  instance.player.init(instance)\n    .then(function() {\n      instance._waveformBuilder.init(instance.options, function(err, waveformData) {\n        if (err) {\n          callback(err);\n          return;\n        }\n\n        err = checkContainerElements(instance.options);\n\n        if (err) {\n          callback(err);\n          return;\n        }\n\n        instance._waveformBuilder = null;\n        instance._waveformData = waveformData;\n\n        const zoomviewContainer = instance.options.zoomview.container;\n        const overviewContainer = instance.options.overview.container;\n\n        if (zoomviewContainer) {\n          instance.views.createZoomview(zoomviewContainer);\n        }\n\n        if (overviewContainer) {\n          instance.views.createOverview(overviewContainer);\n        }\n\n        if (scrollbarContainer) {\n          instance.views.createScrollbar(scrollbarContainer);\n        }\n\n        if (opts.segments) {\n          instance.segments.add(opts.segments);\n        }\n\n        if (opts.points) {\n          instance.points.add(opts.points);\n        }\n\n        if (opts.emitCueEvents) {\n          instance._cueEmitter = new CueEmitter(instance);\n        }\n\n        callback(null, instance);\n      });\n    })\n    .catch(function(err) {\n      callback(err);\n    });\n};\n\nPeaks.prototype._setOptions = function(opts) {\n  if (!isObject(opts)) {\n    return new TypeError('Peaks.init(): The options parameter should be an object');\n  }\n\n  if (!opts.player) {\n    if (!opts.mediaElement) {\n      return new Error('Peaks.init(): Missing mediaElement option');\n    }\n\n    if (!(opts.mediaElement instanceof HTMLMediaElement)) {\n      return new TypeError('Peaks.init(): The mediaElement option should be an HTMLMediaElement');\n    }\n  }\n\n  if (opts.logger && !isFunction(opts.logger)) {\n    return new TypeError('Peaks.init(): The logger option should be a function');\n  }\n\n  if (opts.segments && !Array.isArray(opts.segments)) {\n    return new TypeError('Peaks.init(): options.segments must be an array of segment objects');\n  }\n\n  if (opts.points && !Array.isArray(opts.points)) {\n    return new TypeError('Peaks.init(): options.points must be an array of point objects');\n  }\n\n  extendOptions(this.options, opts);\n\n  this.options.overview = getOverviewOptions(opts);\n  this.options.zoomview = getZoomviewOptions(opts);\n  this.options.scrollbar = getScrollbarOptions(opts);\n\n  addSegmentOptions(this.options, opts);\n\n  if (!Array.isArray(this.options.zoomLevels)) {\n    return new TypeError('Peaks.init(): The zoomLevels option should be an array');\n  }\n  else if (this.options.zoomLevels.length === 0) {\n    return new Error('Peaks.init(): The zoomLevels array must not be empty');\n  }\n  else {\n    if (!isInAscendingOrder(this.options.zoomLevels)) {\n      return new Error('Peaks.init(): The zoomLevels array must be sorted in ascending order');\n    }\n  }\n\n  this._logger = this.options.logger;\n};\n\n/**\n * Remote waveform data options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} RemoteWaveformDataOptions\n * @global\n * @property {String=} arraybuffer\n * @property {String=} json\n */\n\n/**\n * Local waveform data options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} LocalWaveformDataOptions\n * @global\n * @property {ArrayBuffer=} arraybuffer\n * @property {Object=} json\n */\n\n/**\n * Web Audio options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} WebAudioOptions\n * @global\n * @property {AudioContext=} audioContext\n * @property {AudioBuffer=} audioBuffer\n * @property {Number=} scale\n * @property {Boolean=} multiChannel\n */\n\n/**\n * Options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} PeaksSetSourceOptions\n * @global\n * @property {String=} mediaUrl\n * @property {RemoteWaveformDataOptions=} dataUri\n * @property {LocalWaveformDataOptions=} waveformData\n * @property {WebAudioOptions=} webAudio\n * @property {Boolean=} withCredentials\n * @property {Array<Number>=} zoomLevels\n */\n\n/**\n * Changes the audio or video media source associated with the {@link Peaks}\n * instance.\n *\n * @see SetSourceHandler\n *\n * @param {PeaksSetSourceOptions} options\n * @param {Function} callback\n */\n\nPeaks.prototype.setSource = function(options, callback) {\n  const self = this;\n\n  self.player._setSource(options)\n    .then(function() {\n      if (!options.zoomLevels) {\n        options.zoomLevels = self.options.zoomLevels;\n      }\n\n      self._waveformBuilder = new WaveformBuilder(self);\n\n      self._waveformBuilder.init(options, function(err, waveformData) {\n        if (err) {\n          callback(err);\n          return;\n        }\n\n        self._waveformBuilder = null;\n        self._waveformData = waveformData;\n\n        ['overview', 'zoomview'].forEach(function(viewName) {\n          const view = self.views.getView(viewName);\n\n          if (view) {\n            view.setWaveformData(waveformData);\n          }\n        });\n\n        self.zoom.setZoomLevels(options.zoomLevels);\n\n        callback();\n      });\n    })\n    .catch(function(err) {\n      callback(err);\n    });\n};\n\nPeaks.prototype.getWaveformData = function() {\n  return this._waveformData;\n};\n\n/**\n * Cleans up a Peaks instance after use.\n */\n\nPeaks.prototype.destroy = function() {\n  if (this._waveformBuilder) {\n    this._waveformBuilder.abort();\n  }\n\n  if (this._keyboardHandler) {\n    this._keyboardHandler.destroy();\n  }\n\n  if (this.views) {\n    this.views.destroy();\n  }\n\n  if (this.player) {\n    this.player.destroy();\n  }\n\n  if (this._cueEmitter) {\n    this._cueEmitter.destroy();\n  }\n};\n\nexport default Peaks;\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","Cue","time","type","id","zeroPad","number","precision","toString","formatTime","result","fractionSeconds","Math","floor","pow","seconds","minutes","hours","join","clamp","value","min","max","objectHasProperty","object","field","extend","to","from","key","isNumber","isValidTime","Number","isFinite","isObject","_typeof","isArray","isString","isNullOrUndefined","isBoolean","isHTMLElement","HTMLElement","isLinearGradientColor","linearGradientStart","linearGradientEnd","linearGradientColorStops","getMarkerObject","obj","parent","Konva","Layer","POINT","SEGMENT_START","SEGMENT_END","sorter","a","b","isHeadless","test","navigator","userAgent","requestAnimationFrame","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","cancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","msCancelAnimationFrame","eventTypes","forward","reverse","eventAttributes","getPointOrSegment","peaks","cue","points","getPoint","segments","getSegment","Error","CueEmitter","_cues","_peaks","_previousTime","_updateCues","bind","_onPlaying","_onSeeked","_onTimeUpdate","_onAnimationFrame","_rAFHandle","_activeSegments","_attachEventHandlers","getSegmentIdComparator","segment","self","getPoints","getSegments","forEach","point","startTime","endTime","sort","player","getCurrentTime","_updateActiveSegments","_onUpdate","previousTime","start","end","step","isForward","marker","eventType","webdriver","document","visibilityState","isPlaying","isSeeking","activeSegments","getSegmentsAtTime","find","_detachEventHandlers","destroy","pointOptions","invalidOptions","validatePointOptions","options","updating","RangeError","labelText","editable","color","Point","pid","_pid","_setUserData","WaveformPoints","_points","_pointsById","_pointsByPid","_pointIdCounter","_pointPid","indexOf","defineProperties","enumerable","get","_id","_time","_labelText","_color","_editable","update","updatePointId","isVisible","_setTime","_getNextPointId","_getNextPid","_addPoint","_createPoint","peaksOptions","pointMarkerColor","setDefaultPointOptions","filter","add","arrayArgs","map","newPointId","_findPoint","predicate","indexes","_removeIndexes","removed","index","itemRemoved","splice","_removePoints","remove","p","removeById","pointId","removeByTime","removeAll","segmentOptions","validateSegmentOptions","markers","overlay","borderColor","Segment","_startTime","_endTime","_borderColor","_markers","_overlay","WaveformSegments","_segments","_segmentsById","_segmentsByPid","_segmentIdCounter","_segmentPid","_isInserting","updateSegmentId","_setStartTime","_setEndTime","_getNextSegmentId","_addSegment","_createSegment","globalSegmentOptions","overlayColor","waveformColor","overlayBorderColor","setDefaultSegmentOptions","_getSortedSegments","findPreviousSegment","sortedSegments","findIndex","s","findNextSegment","insert","newSegmentId","_findSegment","_removeSegments","segmentId","setInserting","isInserting","nodes","keys","KeyboardHandler","eventEmitter","_handleKeyEvent","addEventListener","MediaElementPlayer","mediaElement","_mediaElement","SetSourceHandler","_eventEmitter","_playerCanPlayHandler","_playerErrorHandler","validateAdapter","adapter","allProperties","getOwnPropertyNames","getPrototypeOf","getAllPropertiesFrom","method","includes","Player","_playingSegment","_segment","_loop","_playSegmentTimerCallback","_adapter","DefaultPointMarker","_options","_draggable","DefaultSegmentMarker","createSegmentMarker","view","createSegmentLabel","Text","x","y","text","textAlign","fontFamily","fontSize","fontStyle","fill","createPointMarker","HighlightLayer","_view","_offset","highlightOffset","highlightColor","_layer","listening","_highlightRect","_strokeColor","highlightStrokeColor","_opacity","highlightOpacity","_cornerRadius","highlightCornerRadius","PointMarker","_point","_marker","draggable","_onDragStart","onDragStart","_onDragMove","onDragMove","_onDragEnd","onDragEnd","_dragBoundFunc","dragBoundFunc","_onMouseEnter","onMouseEnter","_onMouseLeave","onMouseLeave","_group","Group","_bindDefaultEventHandlers","init","PointsLayer","enableEditing","_enableEditing","_pointMarkers","_onPointsDrag","_onPointMarkerDragStart","_onPointMarkerDragMove","_onPointMarkerDragEnd","_pointMarkerDragBoundFunc","_onPointMarkerMouseEnter","_onPointMarkerMouseLeave","_onPointsUpdate","_onPointsAdd","_onPointsRemove","_onPointsRemoveAll","PlayheadLayer","_player","_playheadPixel","_playheadLineAnimation","_playheadVisible","_playheadColor","playheadColor","_playheadTextColor","playheadTextColor","_playheadBackgroundColor","playheadBackgroundColor","_playheadPadding","playheadPadding","_playheadWidth","playheadWidth","_playheadFontFamily","playheadFontFamily","_playheadFontSize","playheadFontSize","_playheadFontStyle","playheadFontStyle","_playheadLayer","_createPlayhead","showPlayheadTime","_createPlayheadText","fitToView","zoomLevelChanged","OverlaySegmentMarker","SegmentMarker","_segmentShape","segmentShape","_startMarker","startMarker","_onClick","onClick","visible","pos","WaveformShape","shapeOptions","startY","_height","endY","fillLinearGradientStartPointY","fillLinearGradientEndPointY","fillLinearGradientColorStops","_shape","Shape","sceneFunc","_sceneFunc","SegmentShape","layer","_label","_endMarker","isSegmentDraggingEnabled","_dragging","viewOptions","getViewOptions","_overlayOffset","overlayOffset","_waveformShape","_onMouseDown","_onMouseUp","_onSegmentDragStart","_onSegmentDragMove","_onSegmentDragEnd","_onSegmentMarkerClick","_onSegmentMarkerDragStart","_onSegmentMarkerDragMove","_onSegmentMarkerDragEnd","_segmentMarkerDragBoundFunc","getName","hide","overlayBorderWidth","overlayOpacity","overlayCornerRadius","segmentStartOffset","timeToPixelOffset","segmentEndOffset","overlayRectHeight","getHeight","width","height","clipX","clipY","clipWidth","clipHeight","_overlayRect","Rect","stroke","strokeWidth","opacity","cornerRadius","_overlayText","overlayFontFamily","overlayFontSize","overlayFontStyle","overlayLabelColor","align","overlayLabelAlign","verticalAlign","overlayLabelVerticalAlign","padding","overlayLabelPadding","_createMarkers","createOverlayMarker","getDuration","SegmentsLayer","_segmentShapes","_onSegmentsUpdate","_onSegmentsAdd","_onSegmentsRemove","_onSegmentsRemoveAll","_onSegmentsDragged","WaveformAxis","_axisGridlineColor","axisGridlineColor","_axisLabelColor","axisLabelColor","_showAxisLabels","showAxisLabels","_axisTopMarkerHeight","axisTopMarkerHeight","_axisBottomMarkerHeight","axisBottomMarkerHeight","formatAxisTime","_formatAxisTime","_axisLabelFont","_buildFontString","_axisShape","_drawAxis","WaveformView","waveformData","container","_container","_viewOptions","_originalWaveformData","_data","_frameOffset","_width","clientWidth","clientHeight","_amplitudeScale","_waveformColor","_playedWaveformColor","playedWaveformColor","_timeLabelPrecision","timeLabelPrecision","formatPlayheadTime","_formatPlayheadTime","_enableSeek","initWaveformData","showWarnings","_stage","Stage","_createWaveform","enableSegments","_segmentsLayer","addToStage","enablePoints","_pointsLayer","initHighlightLayer","_createAxisLabels","_onDblClick","_onContextMenu","MouseDragHandler","stage","_handlers","_mouseDown","_mouseUp","_mouseMove","_lastMouseClientX","SeekMouseDragHandler","_firstMove","_onMouseMove","_mouseDragHandler","onMouseDown","onMouseMove","onMouseUp","WaveformOverview","overview","_onPause","_onZoomviewUpdate","updatePlayheadTime","zoomview","views","getView","_highlightLayer","showHighlight","getStartTime","getEndTime","InsertSegmentMouseDragHandler","ScrollMouseDragHandler","_seeking","_segmentIsDraggable","_initialFrameOffset","_mouseDownX","WaveformZoomView","_onKeyboardLeft","_onKeyboardRight","_onKeyboardShiftLeft","_onKeyboardShiftRight","_autoScroll","autoScroll","_autoScrollOffset","autoScrollOffset","_enableSegmentDragging","_segmentDragMode","_minSegmentDragWidth","_insertSegmentShape","_playheadClickTolerance","playheadClickTolerance","_zoomLevelAuto","_zoomLevelSeconds","_syncPlayhead","_onWheel","_onWheelCaptureVerticalScroll","setWheelMode","wheelMode","Scrollbar","scrollbar","_zoomview","_onScrollboxDragStart","_onScrollboxDragMove","_onScrollboxDragEnd","_onScrollbarClick","_scrollboxX","_minScrollboxWidth","minWidth","_offsetY","_scrollbox","_scrollboxRect","_setScrollboxWidth","_updateScrollbarWidthAndPosition","ViewController","_overview","_scrollbar","ZoomController","zoomLevels","_zoomLevels","_zoomLevelIndex","target","nodeName","preventDefault","keyCode","shiftKey","removeEventListener","_addMediaListener","callback","_listeners","_duration","error","_interval","src","querySelector","code","MediaError","MEDIA_ERR_SRC_NOT_SUPPORTED","Promise","reject","resolve","eventHandler","readyState","HTMLMediaElement","HAVE_NOTHING","load","play","pause","paused","seeking","currentTime","duration","seek","setSource","_callback","_resolve","_reject","setAttribute","mediaUrl","_reset","err","_logger","playSegment","loop","_setSource","group","_handle","_line","Line","bindEventHandlers","setX","getWidth","show","setText","xPosition","_createHighlightRect","_update","startOffset","timeToPixels","endOffset","setAttrs","removeHighlight","updateHighlight","offset","addToLayer","getX","getAbsolutePosition","destroyChildren","setListening","enable","getPointMarker","frameStartTime","frameEndTime","pointMarker","_removePoint","_updatePoint","pointMarkerX","getFrameOffset","removeChildren","_createPointMarker","_addPointMarker","_dragPointMarker","pixelOffsetToTime","updatePoints","_removeInvisiblePoints","pointPid","setVisible","draw","pixelsPerSecond","_useAnimation","_start","stop","_playheadLine","_playheadText","_playheadGroup","shape","fillStyle","fillRect","pixelIndex","frameOffset","playheadX","playheadTextWidth","playheadPosChanged","lastPlayheadPosition","Animation","playheadPosition","getPlayheadPixel","updatePlayheadText","body","style","cursor","viewHeight","moveToTop","isStartMarker","startDrag","stopDrag","setSegment","setWaveformColor","_drawWaveform","getWaveformData","startPixels","endPixels","limit","channels","waveformTop","waveformHeight","_drawChannel","channel","top","amplitude","lineX","lineY","amplitudeScale","getAmplitudeScale","beginPath","min_sample","scaleY","lineTo","max_sample","closePath","fillShape","handler","scale","endMarker","isEditingEnabled","startMarkerColor","endMarkerColor","getStartMarker","getEndMarker","bordercolor","isDragging","segmentClicked","eventName","_moveToTop","moveSegmentMarkersToTop","enableSegmentDragging","_setPreviousAndNextSegments","getSegmentDragMode","_nextSegment","_previousSegment","_dragStartX","_dragStartTime","_dragEndTime","dragMode","offsetX","timeOffset","pixelsToTime","segmentDuration","minSegmentWidth","getMinSegmentDragWidth","minSegmentDuration","previousSegmentUpdated","nextSegmentUpdated","previousSegmentEndX","previousSegmentEndTime","minPreviousSegmentEndTime","nextSegmentStartX","nextSegmentStartTime","maxNextSegmentStartTime","moveMarkersToTop","segmentMarker","_startMarkerX","_endMarkerX","_segmentStartMarkerDragMove","_segmentEndMarkerDragMove","startMarkerX","endMarkerX","upperLimit","previousSegmentVisible","fixedPreviousSegment","compressPreviousSegment","previousSegmentDuration","lowerLimit","nextSegmentVisible","fixedNextSegment","compressNextSegment","nextSegmentDuration","segmentPid","getSegmentShape","_removeSegment","_updateSegment","_addSegmentShape","_createSegmentShape","updateSegments","_removeInvisibleSegments","topMarkerHeight","bottomMarkerHeight","setAxisLabelColor","setAxisGridlineColor","_getAxisLabelScale","secs","baseSecs","steps","currentFrameStartTime","axisLabelIntervalSecs","firstAxisLabelSecs","multiple","multiplier","ceil","roundUpToNearest","axisLabelOffsetSecs","axisLabelOffsetPixels","setAttr","moveTo","label","labelX","measureText","labelY","fillText","setWaveformData","sample_rate","pixels","_getDuration","_waveformLayer","_createWaveformShapes","_playedWaveformShape","_playedSegment","_unplayedSegment","setPlayedWaveformColor","_destroyPlayedWaveformShape","_axisLayer","_axis","setTimeLabelPrecision","setAmplitudeScale","Infinity","drawWaveformLayer","enableSeek","isSeekEnabled","_clickHandler","emitViewEvent","attrs","getAttr","preventViewEvent","clickEvent","viewName","enableMarkerEditing","dragSeek","dragging","fitToContainer","updateWaveform","setWidth","containerWidthChange","heightChanged","setHeight","containerHeightChange","button","touches","clientX","mouseDownPosX","_getMousePosX","capture","passive","changedTouches","mousePosX","cancelable","containerPos","getContainer","getBoundingClientRect","left","_seek","_resampleAndSetWaveformData","resample","removeHighlightRect","playheadTime","_insertSegment","playheadOffset","getPlayheadOffset","abs","getPlayheadClickTolerance","isAutoZoom","diff","newFrameOffset","_enableWaveformCache","waveformCache","_initWaveformCache","initialZoomLevel","zoom","getZoomLevel","_resampleData","_waveformData","Map","set","_waveformScales","mode","_wheelMode","captureVerticalScroll","_captureVerticalScroll","delta","wheelEvent","deltaY","deltaX","deltaMode","WheelEvent","DOM_DELTA_PAGE","_pixelLength","setWaveformDragMode","setSegmentDragMode","_keyboardScroll","direction","large","increment","nudgeIncrement","scrollWaveform","endThreshold","_getScale","setZoom","isAutoScale","apexTime","playheadOffsetPixels","prevScale","_scale","currentZoom","previousZoom","sourceWaveform","setStartTime","getPixelLength","scrollAmount","forceUpdate","playheadPixel","enableAutoScroll","setMinSegmentDragWidth","resampleOptions","getStage","getSegmentsLayer","clear","setZoomview","_scrollboxWidth","_getScrollbarRange","range","_updateWaveform","zoomviewRange","scrollBoxPos","createOverview","createZoomview","createScrollbar","destroyOverview","destroyZoomview","getScrollbar","setZoomLevels","zoomIn","zoomOut","zoomLevelIndex","getZoom","isXhr2","XMLHttpRequest","WaveformBuilder","hasValidContentRangeHeader","xhr","contentRange","getResponseHeader","matches","match","firstPos","parseInt","lastPos","Peaks","dataUri","withCredentials","webAudio","logger","console","audioContext","_getRemoteWaveformData","_buildWaveformFromLocalData","audioBuffer","_buildWaveformDataFromAudioBuffer","_buildWaveformDataUsingWebAudio","url","requestType","some","connector","toLowerCase","Boolean","_xhr","_createXHR","status","WaveformData","response","bits","send","data","json","arraybuffer","createdWaveformData","AudioContext","webkitAudioContext","webAudioOptions","mediaSourceUrl","currentSrc","_requestAudioAndBuildWaveformData","webAudioBuilderOptions","audio_buffer","split_channels","multiChannel","disable_worker","createFromAudio","audio_context","array_buffer","abort","onLoad","onError","onAbort","open","responseType","onload","onerror","defaultViewOptions","defaultZoomviewOptions","defaultOverviewOptions","defaultSegmentOptions","defaultScrollbarOptions","extendOptions","checkContainerElements","zoomviewContainer","overviewContainer","opts","instance","_setOptions","scrollbarContainer","keyboard","_keyboardHandler","_waveformBuilder","then","emitCueEvents","_cueEmitter","catch","overviewOptions","optName","getOverviewOptions","zoomviewOptions","getZoomviewOptions","scrollbarOptions","getScrollbarOptions","addSegmentOptions","array","isInAscendingOrder"],"mappings":"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","x_google_ignoreList":[0]}