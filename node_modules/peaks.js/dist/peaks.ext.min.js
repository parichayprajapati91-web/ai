!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("konva/lib/Core"),require("konva/lib/shapes/Line"),require("konva/lib/shapes/Rect"),require("konva/lib/shapes/Text"),require("konva/lib/Animation"),require("waveform-data")):"function"==typeof define&&define.amd?define(["konva/lib/Core","konva/lib/shapes/Line","konva/lib/shapes/Rect","konva/lib/shapes/Text","konva/lib/Animation","waveform-data"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).peaks=t(e.Konva,e.Konva,e.Konva,e.Konva,e.Konva,e.WaveformData)}(this,function(e,t,i,o,n,s){"use strict";function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var a,h={exports:{}};var l=(a||(a=1,function(e){var t=Object.prototype.hasOwnProperty,i="~";function o(){}function n(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function s(e,t,o,s,r){if("function"!=typeof o)throw new TypeError("The listener must be a function");var a=new n(o,s||e,r),h=i?i+t:t;return e._events[h]?e._events[h].fn?e._events[h]=[e._events[h],a]:e._events[h].push(a):(e._events[h]=a,e._eventsCount++),e}function r(e,t){0===--e._eventsCount?e._events=new o:delete e._events[t]}function a(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,o,n=[];if(0===this._eventsCount)return n;for(o in e=this._events)t.call(e,o)&&n.push(i?o.slice(1):o);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e){var t=i?i+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var n=0,s=o.length,r=new Array(s);n<s;n++)r[n]=o[n].fn;return r},a.prototype.listenerCount=function(e){var t=i?i+e:e,o=this._events[t];return o?o.fn?1:o.length:0},a.prototype.emit=function(e,t,o,n,s,r){var a=i?i+e:e;if(!this._events[a])return!1;var h,l,_=this._events[a],p=arguments.length;if(_.fn){switch(_.once&&this.removeListener(e,_.fn,void 0,!0),p){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,t),!0;case 3:return _.fn.call(_.context,t,o),!0;case 4:return _.fn.call(_.context,t,o,n),!0;case 5:return _.fn.call(_.context,t,o,n,s),!0;case 6:return _.fn.call(_.context,t,o,n,s,r),!0}for(l=1,h=new Array(p-1);l<p;l++)h[l-1]=arguments[l];_.fn.apply(_.context,h)}else{var d,m=_.length;for(l=0;l<m;l++)switch(_[l].once&&this.removeListener(e,_[l].fn,void 0,!0),p){case 1:_[l].fn.call(_[l].context);break;case 2:_[l].fn.call(_[l].context,t);break;case 3:_[l].fn.call(_[l].context,t,o);break;case 4:_[l].fn.call(_[l].context,t,o,n);break;default:if(!h)for(d=1,h=new Array(p-1);d<p;d++)h[d-1]=arguments[d];_[l].fn.apply(_[l].context,h)}}return!0},a.prototype.on=function(e,t,i){return s(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return s(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,o,n){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return r(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||n&&!a.once||o&&a.context!==o||r(this,s);else{for(var h=0,l=[],_=a.length;h<_;h++)(a[h].fn!==t||n&&!a[h].once||o&&a[h].context!==o)&&l.push(a[h]);l.length?this._events[s]=1===l.length?l[0]:l:r(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&r(this,t)):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a}(h)),h.exports),_=r(l);function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function d(e,t,i){this.time=e,this.type=t,this.id=i}function m(e,t){for(e=e.toString();e.length<t;)e="0"+e;return e}function u(e,t){var i=[],o=Math.floor(e%1*Math.pow(10,t)),n=Math.floor(e),s=Math.floor(n/60),r=Math.floor(s/60);r>0&&i.push(r),i.push(s%60),i.push(n%60);for(var a=0;a<i.length;a++)i[a]=m(i[a],2);return i=i.join(":"),t>0&&(i+="."+m(o,t)),i}function g(e,t,i){return e<t?t:e>i?i:e}function f(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){for(var i in t)f(t,i)&&(e[i]=t[i]);return e}function y(e){return"number"==typeof e}function v(e){return"number"==typeof e&&Number.isFinite(e)}function w(e){return null!==e&&"object"===p(e)&&!Array.isArray(e)}function b(e){return"string"==typeof e}function k(e){return null==e}function S(e){return!0===e||!1===e}function T(e){return e instanceof HTMLElement}function M(e){return w(e)&&f(e,"linearGradientStart")&&f(e,"linearGradientEnd")&&f(e,"linearGradientColorStops")&&y(e.linearGradientStart)&&y(e.linearGradientEnd)&&function(e){return Array.isArray(e)}(e.linearGradientColorStops)&&2===e.linearGradientColorStops.length}function x(t){for(;null!==t.parent;){if(t.parent instanceof e.Layer)return t;t=t.parent}return null}d.POINT=0,d.SEGMENT_START=1,d.SEGMENT_END=2,d.sorter=function(e,t){return e.time-t.time};var P=/HeadlessChrome/.test(navigator.userAgent);var E=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,L=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame,D={forward:{},reverse:{}};D.forward[d.POINT]=0,D.forward[d.SEGMENT_START]=1,D.forward[d.SEGMENT_END]=2,D.reverse[d.POINT]=0,D.reverse[d.SEGMENT_START]=2,D.reverse[d.SEGMENT_END]=1;var C={0:"points.enter",1:"segments.enter",2:"segments.exit"},A={};function W(e,t){switch(t.type){case d.POINT:return e.points.getPoint(t.id);case d.SEGMENT_START:case d.SEGMENT_END:return e.segments.getSegment(t.id);default:throw new Error("getPointOrSegment: id not found?")}}function O(e){this._cues=[],this._peaks=e,this._previousTime=-1,this._updateCues=this._updateCues.bind(this),this._onPlaying=this._onPlaying.bind(this),this._onSeeked=this._onSeeked.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._onAnimationFrame=this._onAnimationFrame.bind(this),this._rAFHandle=null,this._activeSegments={},this._attachEventHandlers()}function z(e){return function(t){return t.id===e}}A[0]="point",A[1]="segment",A[2]="segment",O.prototype._updateCues=function(){var e=this,t=e._peaks.points.getPoints(),i=e._peaks.segments.getSegments();e._cues.length=0,t.forEach(function(t){e._cues.push(new d(t.time,d.POINT,t.id))}),i.forEach(function(t){e._cues.push(new d(t.startTime,d.SEGMENT_START,t.id)),e._cues.push(new d(t.endTime,d.SEGMENT_END,t.id))}),e._cues.sort(d.sorter);var o=e._peaks.player.getCurrentTime();e._updateActiveSegments(o)},O.prototype._onUpdate=function(e,t){var i,o,n,s=e>t;s?(i=0,o=this._cues.length,n=1):(i=this._cues.length-1,o=-1,n=-1);for(var r=i;s?r<o:r>o;r+=n){var a=this._cues[r];if(s?a.time>t:a.time<t){if(s?a.time>e:a.time<e)break;var h=W(this._peaks,a),l=s?D.forward[a.type]:D.reverse[a.type];1===l?this._activeSegments[h.id]=h:2===l&&delete this._activeSegments[h.id];var _={time:e};_[A[l]]=h,this._peaks.emit(C[l],_)}}},O.prototype._onTimeUpdate=function(e){(P||navigator.webdriver||"object"!==("undefined"==typeof document?"undefined":p(document))||!("visibilityState"in document)||"visible"!==document.visibilityState)&&(this._peaks.player.isPlaying()&&!this._peaks.player.isSeeking()&&this._onUpdate(e,this._previousTime),this._previousTime=e)},O.prototype._onAnimationFrame=function(){var e=this._peaks.player.getCurrentTime();this._peaks.player.isSeeking()||this._onUpdate(e,this._previousTime),this._previousTime=e,this._peaks.player.isPlaying()&&(this._rAFHandle=E(this._onAnimationFrame))},O.prototype._onPlaying=function(){this._previousTime=this._peaks.player.getCurrentTime(),this._rAFHandle=E(this._onAnimationFrame)},O.prototype._onSeeked=function(e){this._previousTime=e,this._updateActiveSegments(e)},O.prototype._updateActiveSegments=function(e){var t=this,i=t._peaks.segments.getSegmentsAtTime(e);for(var o in t._activeSegments){if(f(t._activeSegments,o))i.find(z(o))||(t._peaks.emit("segments.exit",{segment:t._activeSegments[o],time:e}),delete t._activeSegments[o])}i.forEach(function(i){i.id in t._activeSegments||(t._activeSegments[i.id]=i,t._peaks.emit("segments.enter",{segment:i,time:e}))})};var H=["points.update","points.dragmove","points.add","points.remove","points.remove_all","segments.update","segments.dragged","segments.add","segments.remove","segments.remove_all"];O.prototype._attachEventHandlers=function(){this._peaks.on("player.timeupdate",this._onTimeUpdate),this._peaks.on("player.playing",this._onPlaying),this._peaks.on("player.seeked",this._onSeeked);for(var e=0;e<H.length;e++)this._peaks.on(H[e],this._updateCues);this._updateCues()},O.prototype._detachEventHandlers=function(){this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.seeked",this._onSeeked);for(var e=0;e<H.length;e++)this._peaks.off(H[e],this._updateCues)},O.prototype.destroy=function(){this._rAFHandle&&(L(this._rAFHandle),this._rAFHandle=null),this._detachEventHandlers(),this._previousTime=-1};var F=["id","pid","time","labelText","color","editable"],R=["update","isVisible","peaks","pid"];function B(e,t){var i=t?"update()":"add()";if((!t||t&&f(e,"time"))&&!v(e.time))throw new TypeError("peaks.points."+i+": time should be a numeric value");if(e.time<0)throw new RangeError("peaks.points."+i+": time should not be negative");if(f(e,"labelText")&&!b(e.labelText))throw new TypeError("peaks.points."+i+": labelText must be a string");if(f(e,"editable")&&!S(e.editable))throw new TypeError("peaks.points."+i+": editable must be true or false");if(f(e,"color")&&!b(e.color)&&!M(e.color))throw new TypeError("peaks.points."+i+": color must be a string or a valid linear gradient object");R.forEach(function(t){if(f(e,t))throw new Error("peaks.points."+i+": invalid option name: "+t)}),F.forEach(function(t){if(f(e,"_"+t))throw new Error("peaks.points."+i+": invalid option name: _"+t)})}function U(e,t,i){this._peaks=e,this._pid=t,this._setUserData(i)}function X(e){this._peaks=e,this._points=[],this._pointsById={},this._pointsByPid={},this._pointIdCounter=0,this._pointPid=0}U.prototype._setUserData=function(e){for(var t in e)f(e,t)&&(-1===F.indexOf(t)?this[t]=e[t]:this["_"+t]=e[t])},Object.defineProperties(U.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},time:{enumerable:!0,get:function(){return this._time}},labelText:{get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},editable:{enumerable:!0,get:function(){return this._editable}}}),U.prototype.update=function(e){if(B(e,!0),f(e,"id")){if(k(e.id))throw new TypeError("point.update(): invalid id");this._peaks.points.updatePointId(this,e.id)}this._setUserData(e),this._peaks.emit("points.update",this,e)},U.prototype.isVisible=function(e,t){return this.time>=e&&this.time<t},U.prototype._setTime=function(e){this._time=e},X.prototype._getNextPointId=function(){return"peaks.point."+this._pointIdCounter++},X.prototype._getNextPid=function(){return this._pointPid++},X.prototype._addPoint=function(e){this._points.push(e),this._pointsById[e.id]=e,this._pointsByPid[e.pid]=e},X.prototype._createPoint=function(e){var t={};c(t,e),k(t.id)&&(t.id=this._getNextPointId());var i=this._getNextPid();return function(e,t){k(e.labelText)&&(e.labelText=""),k(e.editable)&&(e.editable=!1),k(e.color)&&(e.color=t.pointMarkerColor)}(t,this._peaks.options),B(t,!1),new U(this._peaks,i,t)},X.prototype.getPoints=function(){return this._points},X.prototype.getPoint=function(e){return this._pointsById[e]},X.prototype.find=function(e,t){return this._points.filter(function(i){return i.isVisible(e,t)})},X.prototype.add=function(){var e=this,t=Array.isArray(arguments[0]),i=t?arguments[0]:Array.prototype.slice.call(arguments);return i=i.map(function(t){var i=e._createPoint(t);if(f(e._pointsById,i.id))throw new Error("peaks.points.add(): duplicate id");return i}),i.forEach(function(t){e._addPoint(t)}),this._peaks.emit("points.add",{points:i}),t?i:i[0]},X.prototype.updatePointId=function(e,t){if(this._pointsById[e.id]){if(this._pointsById[t])throw new Error("point.update(): duplicate id");delete this._pointsById[e.id],this._pointsById[t]=e}},X.prototype._findPoint=function(e){for(var t=[],i=0,o=this._points.length;i<o;i++)e(this._points[i])&&t.push(i);return t},X.prototype._removeIndexes=function(e){for(var t=[],i=0;i<e.length;i++){var o=e[i]-t.length,n=this._points.splice(o,1)[0];delete this._pointsById[n.id],delete this._pointsByPid[n.pid],t.push(n)}return t},X.prototype._removePoints=function(e){var t=this._findPoint(e),i=this._removeIndexes(t);return this._peaks.emit("points.remove",{points:i}),i},X.prototype.remove=function(e){return this._removePoints(function(t){return t===e})},X.prototype.removeById=function(e){return this._removePoints(function(t){return t.id===e})},X.prototype.removeByTime=function(e){return this._removePoints(function(t){return t.time===e})},X.prototype.removeAll=function(){this._points=[],this._pointsById={},this._pointsByPid={},this._peaks.emit("points.remove_all")};var I=["id","pid","startTime","endTime","labelText","color","borderColor","markers","overlay","editable"],V=["update","isVisible","peaks","pid"];function G(e,t){var i=t?"update()":"add()";if(f(e,"startTime")&&!v(e.startTime))throw new TypeError("peaks.segments."+i+": startTime should be a valid number");if(f(e,"endTime")&&!v(e.endTime))throw new TypeError("peaks.segments."+i+": endTime should be a valid number");if(!(t||f(e,"startTime")&&f(e,"endTime")))throw new TypeError("peaks.segments."+i+": missing startTime or endTime");if(e.startTime<0)throw new RangeError("peaks.segments."+i+": startTime should not be negative");if(e.endTime<0)throw new RangeError("peaks.segments."+i+": endTime should not be negative");if(e.endTime<e.startTime)throw new RangeError("peaks.segments."+i+": endTime should not be less than startTime");if(f(e,"labelText")&&!b(e.labelText))throw new TypeError("peaks.segments."+i+": labelText must be a string");if(t&&f(e,"markers"))throw new TypeError("peaks.segments."+i+": cannot update markers attribute");if(f(e,"markers")&&!S(e.markers))throw new TypeError("peaks.segments."+i+": markers must be true or false");if(t&&f(e,"overlay"))throw new TypeError("peaks.segments."+i+": cannot update overlay attribute");if(f(e,"overlay")&&!S(e.overlay))throw new TypeError("peaks.segments."+i+": overlay must be true or false");if(f(e,"editable")&&!S(e.editable))throw new TypeError("peaks.segments."+i+": editable must be true or false");if(f(e,"color")&&!b(e.color)&&!M(e.color))throw new TypeError("peaks.segments."+i+": color must be a string or a valid linear gradient object");if(f(e,"borderColor")&&!b(e.borderColor))throw new TypeError("peaks.segments."+i+": borderColor must be a string");V.forEach(function(t){if(f(e,t))throw new Error("peaks.segments."+i+": invalid option name: "+t)}),I.forEach(function(t){if(f(e,"_"+t))throw new Error("peaks.segments."+i+": invalid option name: _"+t)})}function N(e,t,i){this._peaks=e,this._pid=t,this._id=i.id,this._startTime=i.startTime,this._endTime=i.endTime,this._labelText=i.labelText,this._color=i.color,this._borderColor=i.borderColor,this._editable=i.editable,this._markers=i.markers,this._overlay=i.overlay,this._setUserData(i)}function K(e){this._peaks=e,this._segments=[],this._segmentsById={},this._segmentsByPid={},this._segmentIdCounter=0,this._segmentPid=0,this._isInserting=!1}N.prototype._setUserData=function(e){for(var t in e)f(e,t)&&(-1===I.indexOf(t)?this[t]=e[t]:this["_"+t]=e[t])},Object.defineProperties(N.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},startTime:{enumerable:!0,get:function(){return this._startTime}},endTime:{enumerable:!0,get:function(){return this._endTime}},labelText:{enumerable:!0,get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},borderColor:{enumerable:!0,get:function(){return this._borderColor}},markers:{enumerable:!0,get:function(){return this._markers}},overlay:{enumerable:!0,get:function(){return this._overlay}},editable:{enumerable:!0,get:function(){return this._editable}}}),N.prototype.update=function(e){if(G(e,!0),f(e,"id")){if(k(e.id))throw new TypeError("segment.update(): invalid id");this._peaks.segments.updateSegmentId(this,e.id)}this._setUserData(e),this._peaks.emit("segments.update",this,e)},N.prototype.isVisible=function(e,t){return this.startTime===this.endTime&&this.startTime===e||!(this.endTime<=e)&&!(this.startTime>=t)},N.prototype._setStartTime=function(e){this._startTime=e},N.prototype._setEndTime=function(e){this._endTime=e},K.prototype._getNextSegmentId=function(){return"peaks.segment."+this._segmentIdCounter++},K.prototype._getNextPid=function(){return this._segmentPid++},K.prototype._addSegment=function(e){this._segments.push(e),this._segmentsById[e.id]=e,this._segmentsByPid[e.pid]=e},K.prototype._createSegment=function(e){var t={};c(t,e),k(t.id)&&(t.id=this._getNextSegmentId());var i=this._getNextPid();return function(e,t){k(e.color)&&(t.overlay?e.color=t.overlayColor:e.color=t.waveformColor),k(e.borderColor)&&(e.borderColor=t.overlayBorderColor),k(e.labelText)&&(e.labelText=""),k(e.markers)&&(e.markers=t.markers),k(e.overlay)&&(e.overlay=t.overlay),k(e.editable)&&(e.editable=!1)}(t,this._peaks.options.segmentOptions),G(t,!1),new N(this._peaks,i,t)},K.prototype.getSegments=function(){return this._segments},K.prototype.getSegment=function(e){return this._segmentsById[e]},K.prototype.getSegmentsAtTime=function(e){return this._segments.filter(function(t){return e>=t.startTime&&e<t.endTime})},K.prototype.find=function(e,t){return this._segments.filter(function(i){return i.isVisible(e,t)})},K.prototype._getSortedSegments=function(){return this._segments.slice().sort(function(e,t){return e.startTime-t.startTime})},K.prototype.findPreviousSegment=function(e){var t=this._getSortedSegments(),i=t.findIndex(function(t){return t.id===e.id});if(-1!==i)return t[i-1]},K.prototype.findNextSegment=function(e){var t=this._getSortedSegments(),i=t.findIndex(function(t){return t.id===e.id});if(-1!==i)return t[i+1]},K.prototype.add=function(){var e=this,t=Array.isArray(arguments[0]),i=t?arguments[0]:Array.prototype.slice.call(arguments);return i=i.map(function(t){var i=e._createSegment(t);if(f(e._segmentsById,i.id))throw new Error("peaks.segments.add(): duplicate id");return i}),i.forEach(function(t){e._addSegment(t)}),this._peaks.emit("segments.add",{segments:i,insert:this._isInserting}),t?i:i[0]},K.prototype.updateSegmentId=function(e,t){if(this._segmentsById[e.id]){if(this._segmentsById[t])throw new Error("segment.update(): duplicate id");delete this._segmentsById[e.id],this._segmentsById[t]=e}},K.prototype._findSegment=function(e){for(var t=[],i=0,o=this._segments.length;i<o;i++)e(this._segments[i])&&t.push(i);return t},K.prototype._removeIndexes=function(e){for(var t=[],i=0;i<e.length;i++){var o=e[i]-t.length,n=this._segments.splice(o,1)[0];delete this._segmentsById[n.id],delete this._segmentsByPid[n.pid],t.push(n)}return t},K.prototype._removeSegments=function(e){var t=this._findSegment(e),i=this._removeIndexes(t);return this._peaks.emit("segments.remove",{segments:i}),i},K.prototype.remove=function(e){return this._removeSegments(function(t){return t===e})},K.prototype.removeById=function(e){return this._removeSegments(function(t){return t.id===e})},K.prototype.removeByTime=function(e,t){var i;return i=(t="number"==typeof t?t:0)>0?function(i){return i.startTime===e&&i.endTime===t}:function(t){return t.startTime===e},this._removeSegments(i)},K.prototype.removeAll=function(){this._segments=[],this._segmentsById={},this._segmentsByPid={},this._peaks.emit("segments.remove_all")},K.prototype.setInserting=function(e){this._isInserting=e},K.prototype.isInserting=function(){return this._isInserting};var j=["OBJECT","TEXTAREA","INPUT","SELECT","OPTION"],Z=[32,9,37,39];function Y(e){this.eventEmitter=e,this._handleKeyEvent=this._handleKeyEvent.bind(this),document.addEventListener("keydown",this._handleKeyEvent),document.addEventListener("keypress",this._handleKeyEvent),document.addEventListener("keyup",this._handleKeyEvent)}function q(e){this._mediaElement=e}function J(e,t){this._eventEmitter=e,this._mediaElement=t,this._playerCanPlayHandler=this._playerCanPlayHandler.bind(this),this._playerErrorHandler=this._playerErrorHandler.bind(this)}function $(e){var t=function(e){for(var t=[],i=e;i;)Object.getOwnPropertyNames(i).forEach(function(e){t.push(e)}),i=Object.getPrototypeOf(i);return t}(e);["init","destroy","play","pause","isPlaying","isSeeking","getCurrentTime","getDuration","seek"].forEach(function(i){if(!t.includes(i))throw new TypeError("Peaks.init(): Player method "+i+" is undefined");if("function"!=typeof e[i])throw new TypeError("Peaks.init(): Player method "+i+" is not a function")})}function Q(e,t){this._peaks=e,this._playingSegment=!1,this._segment=null,this._loop=!1,this._playSegmentTimerCallback=this._playSegmentTimerCallback.bind(this),$(t),this._adapter=t}function ee(e){this._options=e,this._draggable=e.editable}function te(e){this._options=e,this._editable=e.editable}function ie(e){return"zoomview"===e.view?new te(e):null}function oe(e){return new o.Text({x:12,y:12,text:e.segment.labelText,textAlign:"center",fontFamily:e.fontFamily||"sans-serif",fontSize:e.fontSize||12,fontStyle:e.fontStyle||"normal",fill:"#000"})}function ne(e){return new ee(e)}function se(t,i){this._view=t,this._offset=i.highlightOffset,this._color=i.highlightColor,this._layer=new e.Layer({listening:!1}),this._highlightRect=null,this._startTime=null,this._endTime=null,this._strokeColor=i.highlightStrokeColor,this._opacity=i.highlightOpacity,this._cornerRadius=i.highlightCornerRadius}function re(t){this._point=t.point,this._marker=t.marker,this._draggable=t.draggable,this._onDragStart=t.onDragStart,this._onDragMove=t.onDragMove,this._onDragEnd=t.onDragEnd,this._dragBoundFunc=t.dragBoundFunc,this._onMouseEnter=t.onMouseEnter,this._onMouseLeave=t.onMouseLeave,this._group=new e.Group({name:"point-marker",point:this._point,draggable:this._draggable,dragBoundFunc:t.dragBoundFunc}),this._bindDefaultEventHandlers(),this._marker.init(this._group)}function ae(t,i,o){this._peaks=t,this._view=i,this._enableEditing=o,this._pointMarkers={},this._layer=new e.Layer,this._onPointsDrag=this._onPointsDrag.bind(this),this._onPointMarkerDragStart=this._onPointMarkerDragStart.bind(this),this._onPointMarkerDragMove=this._onPointMarkerDragMove.bind(this),this._onPointMarkerDragEnd=this._onPointMarkerDragEnd.bind(this),this._pointMarkerDragBoundFunc=this._pointMarkerDragBoundFunc.bind(this),this._onPointMarkerMouseEnter=this._onPointMarkerMouseEnter.bind(this),this._onPointMarkerMouseLeave=this._onPointMarkerMouseLeave.bind(this),this._onPointsUpdate=this._onPointsUpdate.bind(this),this._onPointsAdd=this._onPointsAdd.bind(this),this._onPointsRemove=this._onPointsRemove.bind(this),this._onPointsRemoveAll=this._onPointsRemoveAll.bind(this),this._peaks.on("points.update",this._onPointsUpdate),this._peaks.on("points.add",this._onPointsAdd),this._peaks.on("points.remove",this._onPointsRemove),this._peaks.on("points.remove_all",this._onPointsRemoveAll),this._peaks.on("points.dragstart",this._onPointsDrag),this._peaks.on("points.dragmove",this._onPointsDrag),this._peaks.on("points.dragend",this._onPointsDrag)}function he(t,i,o){this._player=t,this._view=i,this._playheadPixel=0,this._playheadLineAnimation=null,this._playheadVisible=!1,this._playheadColor=o.playheadColor,this._playheadTextColor=o.playheadTextColor,this._playheadBackgroundColor=o.playheadBackgroundColor,this._playheadPadding=o.playheadPadding,this._playheadWidth=o.playheadWidth,this._playheadFontFamily=o.playheadFontFamily,this._playheadFontSize=o.playheadFontSize,this._playheadFontStyle=o.playheadFontStyle,this._playheadLayer=new e.Layer({listening:!1}),this._createPlayhead(),o.showPlayheadTime&&this._createPlayheadText(),this.fitToView(),this.zoomLevelChanged()}function le(e){this._options=e}function _e(t){var i=this;i._segment=t.segment,i._marker=t.marker,i._segmentShape=t.segmentShape,i._editable=t.editable,i._startMarker=t.startMarker,i._onClick=t.onClick,i._onDragStart=t.onDragStart,i._onDragMove=t.onDragMove,i._onDragEnd=t.onDragEnd,i._group=new e.Group({name:"segment-marker",segment:i._segment,draggable:i._editable,visible:i._editable,dragBoundFunc:function(e){return t.dragBoundFunc(i,e)}}),i._bindDefaultEventHandlers(),i._marker.init(i._group)}function pe(t){this._color=t.color;var i={};if(b(t.color))i.fill=t.color;else{if(!M(t.color))throw new TypeError("Unknown type for color property");var o=t.view._height*(t.color.linearGradientStart/100),n=t.view._height*(t.color.linearGradientEnd/100);i.fillLinearGradientStartPointY=o,i.fillLinearGradientEndPointY=n,i.fillLinearGradientColorStops=[0,t.color.linearGradientColorStops[0],1,t.color.linearGradientColorStops[1]]}this._shape=new e.Shape(i),this._view=t.view,this._segment=t.segment,this._shape.sceneFunc(this._sceneFunc.bind(this))}function de(t,i,o,n){this._segment=t,this._peaks=i,this._layer=o,this._view=n,this._label=null,this._startMarker=null,this._endMarker=null,this._color=t.color,this._borderColor=t.borderColor,this._draggable=this._segment.editable&&this._view.isSegmentDraggingEnabled(),this._dragging=!1;var s=n.getViewOptions(),r=s.segmentOptions;this._overlayOffset=r.overlayOffset,t.overlay||(this._waveformShape=new pe({color:t.color,view:n,segment:t})),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onSegmentDragStart=this._onSegmentDragStart.bind(this),this._onSegmentDragMove=this._onSegmentDragMove.bind(this),this._onSegmentDragEnd=this._onSegmentDragEnd.bind(this),this._onSegmentMarkerClick=this._onSegmentMarkerClick.bind(this),this._onSegmentMarkerDragStart=this._onSegmentMarkerDragStart.bind(this),this._onSegmentMarkerDragMove=this._onSegmentMarkerDragMove.bind(this),this._onSegmentMarkerDragEnd=this._onSegmentMarkerDragEnd.bind(this),this._segmentMarkerDragBoundFunc=this._segmentMarkerDragBoundFunc.bind(this),this._label=this._peaks.options.createSegmentLabel({segment:t,view:this._view.getName(),layer:this._layer,fontFamily:s.fontFamily,fontSize:s.fontSize,fontStyle:s.fontStyle}),this._label&&this._label.hide();var a,h,l,_,p,d=this._view.timeToPixelOffset(this._segment.startTime),m=this._view.timeToPixelOffset(this._segment.endTime),u=g(0,this._view.getHeight()-2*this._overlayOffset);this._overlay=new e.Group({name:"segment-overlay",segment:this._segment,x:d,y:0,width:m-d,height:this._view.getHeight(),clipX:0,clipY:this._overlayOffset,clipWidth:m-d,clipHeight:u,draggable:this._draggable,dragBoundFunc:this._dragBoundFunc}),t.overlay&&(a=this._borderColor||r.overlayBorderColor,h=r.overlayBorderWidth,l=this._color||r.overlayColor,_=r.overlayOpacity,p=r.overlayCornerRadius),this._overlayRect=new e.Rect({x:0,y:this._overlayOffset,width:m-d,stroke:a,strokeWidth:h,height:u,fill:l,opacity:_,cornerRadius:p}),this._overlay.add(this._overlayRect),t.overlay&&(this._overlayText=new e.Text({x:0,y:this._overlayOffset,text:this._segment.labelText,fontFamily:r.overlayFontFamily,fontSize:r.overlayFontSize,fontStyle:r.overlayFontStyle,fill:r.overlayLabelColor,listening:!1,align:r.overlayLabelAlign,width:m-d,verticalAlign:r.overlayLabelVerticalAlign,height:u,padding:r.overlayLabelPadding}),this._overlay.add(this._overlayText)),this._overlay.on("mouseenter",this._onMouseEnter),this._overlay.on("mouseleave",this._onMouseLeave),this._overlay.on("mousedown",this._onMouseDown),this._overlay.on("mouseup",this._onMouseUp),this._draggable&&(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)),this._createMarkers()}function me(e){return new le(e)}function ue(e){return e.endTime-e.startTime}function ge(t,i,o){this._peaks=t,this._view=i,this._enableEditing=o,this._segmentShapes={},this._layer=new e.Layer,this._onSegmentsUpdate=this._onSegmentsUpdate.bind(this),this._onSegmentsAdd=this._onSegmentsAdd.bind(this),this._onSegmentsRemove=this._onSegmentsRemove.bind(this),this._onSegmentsRemoveAll=this._onSegmentsRemoveAll.bind(this),this._onSegmentsDragged=this._onSegmentsDragged.bind(this),this._peaks.on("segments.update",this._onSegmentsUpdate),this._peaks.on("segments.add",this._onSegmentsAdd),this._peaks.on("segments.remove",this._onSegmentsRemove),this._peaks.on("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.on("segments.dragged",this._onSegmentsDragged)}function fe(t,i){var o=this;o._axisGridlineColor=i.axisGridlineColor,o._axisLabelColor=i.axisLabelColor,o._showAxisLabels=i.showAxisLabels,o._axisTopMarkerHeight=i.axisTopMarkerHeight,o._axisBottomMarkerHeight=i.axisBottomMarkerHeight,i.formatAxisTime?o._formatAxisTime=i.formatAxisTime:o._formatAxisTime=function(e){return u(e,0)},o._axisLabelFont=fe._buildFontString(i.fontFamily,i.fontSize,i.fontStyle),o._axisShape=new e.Shape({sceneFunc:function(e){o._drawAxis(e,t)}})}function ce(t,i,o,n){var s=this;s._container=i,s._peaks=o,s._options=o.options,s._viewOptions=n,s._originalWaveformData=t,s._data=t,s._frameOffset=0,s._width=i.clientWidth,s._height=i.clientHeight,s._amplitudeScale=1,s._waveformColor=s._viewOptions.waveformColor,s._playedWaveformColor=s._viewOptions.playedWaveformColor,s._timeLabelPrecision=s._viewOptions.timeLabelPrecision,s._viewOptions.formatPlayheadTime?s._formatPlayheadTime=s._viewOptions.formatPlayheadTime:s._formatPlayheadTime=function(e){return u(e,s._timeLabelPrecision)},s._enableSeek=!0,s.initWaveformData(),e.showWarnings=!1,s._stage=new e.Stage({container:i,width:s._width,height:s._height}),s._createWaveform(),s._viewOptions.enableSegments&&(s._segmentsLayer=new ge(o,s,s._viewOptions.enableEditing),s._segmentsLayer.addToStage(s._stage)),s._viewOptions.enablePoints&&(s._pointsLayer=new ae(o,s,s._viewOptions.enableEditing),s._pointsLayer.addToStage(s._stage)),s.initHighlightLayer(),s._createAxisLabels(),s._playheadLayer=new he(s._peaks.player,s,s._viewOptions),s._playheadLayer.addToStage(s._stage),s._onClick=s._onClick.bind(s),s._onDblClick=s._onDblClick.bind(s),s._onContextMenu=s._onContextMenu.bind(s),s._stage.on("click",s._onClick),s._stage.on("dblclick",s._onDblClick),s._stage.on("contextmenu",s._onContextMenu)}function ye(e,t){this._stage=e,this._handlers=t,this._dragging=!1,this._mouseDown=this._mouseDown.bind(this),this._mouseUp=this._mouseUp.bind(this),this._mouseMove=this._mouseMove.bind(this),this._stage.on("mousedown",this._mouseDown),this._stage.on("touchstart",this._mouseDown),this._lastMouseClientX=null}function ve(e,t){this._peaks=e,this._view=t,this._firstMove=!1,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new ye(t._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function we(e,t,i){var o=this;ce.call(o,e,t,i,i.options.overview),o._onTimeUpdate=o._onTimeUpdate.bind(o),o._onPlaying=o._onPlaying.bind(o),o._onPause=o._onPause.bind(o),o._onZoomviewUpdate=o._onZoomviewUpdate.bind(o),i.on("player.timeupdate",o._onTimeUpdate),i.on("player.playing",o._onPlaying),i.on("player.pause",o._onPause),i.on("zoomview.update",o._onZoomviewUpdate);var n=o._peaks.player.getCurrentTime();o._playheadLayer.updatePlayheadTime(n),o._mouseDragHandler=new ve(i,o);var s=i.views.getView("zoomview");s&&o._highlightLayer.showHighlight(s.getStartTime(),s.getEndTime())}function be(e,t){this._peaks=e,this._view=t,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new ye(t._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function ke(e,t){this._peaks=e,this._view=t,this._seeking=!1,this._firstMove=!1,this._segment=null,this._segmentIsDraggable=!1,this._initialFrameOffset=0,this._mouseDownX=0,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new ye(t._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function Se(e,t,i){var o=this;ce.call(o,e,t,i,i.options.zoomview),o._onTimeUpdate=o._onTimeUpdate.bind(o),o._onPlaying=o._onPlaying.bind(o),o._onPause=o._onPause.bind(o),o._onKeyboardLeft=o._onKeyboardLeft.bind(o),o._onKeyboardRight=o._onKeyboardRight.bind(o),o._onKeyboardShiftLeft=o._onKeyboardShiftLeft.bind(o),o._onKeyboardShiftRight=o._onKeyboardShiftRight.bind(o),o._peaks.on("player.timeupdate",o._onTimeUpdate),o._peaks.on("player.playing",o._onPlaying),o._peaks.on("player.pause",o._onPause),o._peaks.on("keyboard.left",o._onKeyboardLeft),o._peaks.on("keyboard.right",o._onKeyboardRight),o._peaks.on("keyboard.shift_left",o._onKeyboardShiftLeft),o._peaks.on("keyboard.shift_right",o._onKeyboardShiftRight),o._autoScroll=o._viewOptions.autoScroll,o._autoScrollOffset=o._viewOptions.autoScrollOffset,o._enableSegmentDragging=!1,o._segmentDragMode="overlap",o._minSegmentDragWidth=0,o._insertSegmentShape=null,o._playheadClickTolerance=o._viewOptions.playheadClickTolerance,o._zoomLevelAuto=!1,o._zoomLevelSeconds=null;var n=o._peaks.player.getCurrentTime();o._syncPlayhead(n),o._mouseDragHandler=new ke(i,o),o._onWheel=o._onWheel.bind(o),o._onWheelCaptureVerticalScroll=o._onWheelCaptureVerticalScroll.bind(o),o.setWheelMode(o._viewOptions.wheelMode),o._peaks.emit("zoomview.update",{startTime:0,endTime:o.getEndTime()})}function Te(t,o){this._container=t,this._peaks=o,this._options=o.options.scrollbar,this._zoomview=o.views.getView("zoomview"),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onScrollboxDragStart=this._onScrollboxDragStart.bind(this),this._onScrollboxDragMove=this._onScrollboxDragMove.bind(this),this._onScrollboxDragEnd=this._onScrollboxDragEnd.bind(this),this._onZoomviewUpdate=this._onZoomviewUpdate.bind(this),this._onScrollbarClick=this._onScrollbarClick.bind(this),this._peaks.on("zoomview.update",this._onZoomviewUpdate),this._width=t.clientWidth,this._height=t.clientHeight,this._stage=new e.Stage({container:t,width:this._width,height:this._height}),this._layer=new e.Layer,this._stage.on("click",this._onScrollbarClick),this._stage.add(this._layer),this._color=this._options.color,this._scrollboxX=0,this._minScrollboxWidth=this._options.minWidth,this._offsetY=0,this._scrollbox=new e.Group({draggable:!0,dragBoundFunc:this._dragBoundFunc}),this._scrollboxRect=new i.Rect({x:this._scrollboxX,y:this._offsetY,width:0,height:this._height,fill:this._color}),this._scrollbox.add(this._scrollboxRect),this._setScrollboxWidth(),this._scrollbox.on("dragstart",this._onScrollboxDragStart),this._scrollbox.on("dragmove",this._onScrollboxDragMove),this._scrollbox.on("dragend",this._onScrollboxDragEnd),this._layer.add(this._scrollbox),this._updateScrollbarWidthAndPosition()}function Me(e){this._peaks=e,this._overview=null,this._zoomview=null,this._scrollbar=null}function xe(e,t){this._peaks=e,this._zoomLevels=t,this._zoomLevelIndex=0}Y.prototype._handleKeyEvent=function(e){if(-1===j.indexOf(e.target.nodeName))if(Z.indexOf(e.type)>-1&&e.preventDefault(),"keydown"===e.type||"keypress"===e.type)switch(e.keyCode){case 32:this.eventEmitter.emit("keyboard.space");break;case 9:this.eventEmitter.emit("keyboard.tab")}else if("keyup"===e.type)switch(e.keyCode){case 37:e.shiftKey?this.eventEmitter.emit("keyboard.shift_left"):this.eventEmitter.emit("keyboard.left");break;case 39:e.shiftKey?this.eventEmitter.emit("keyboard.shift_right"):this.eventEmitter.emit("keyboard.right")}},Y.prototype.destroy=function(){document.removeEventListener("keydown",this._handleKeyEvent),document.removeEventListener("keypress",this._handleKeyEvent),document.removeEventListener("keyup",this._handleKeyEvent)},q.prototype._addMediaListener=function(e,t){this._listeners.push({type:e,callback:t}),this._mediaElement.addEventListener(e,t)},q.prototype.init=function(e){var t,i=this;return i._eventEmitter=e,i._listeners=[],i._duration=i.getDuration(),i._addMediaListener("timeupdate",function(){i._eventEmitter.emit("player.timeupdate",i.getCurrentTime())}),i._addMediaListener("playing",function(){i._eventEmitter.emit("player.playing",i.getCurrentTime())}),i._addMediaListener("pause",function(){i._eventEmitter.emit("player.pause",i.getCurrentTime())}),i._addMediaListener("ended",function(){i._eventEmitter.emit("player.ended")}),i._addMediaListener("seeked",function(){i._eventEmitter.emit("player.seeked",i.getCurrentTime())}),i._addMediaListener("canplay",function(){i._eventEmitter.emit("player.canplay")}),i._addMediaListener("error",function(e){i._eventEmitter.emit("player.error",e.target.error)}),i._interval=null,(t=i._mediaElement).src||t.querySelector("source")?i._mediaElement.error&&i._mediaElement.error.code===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED?Promise.reject(i._mediaElement.error):new Promise(function(e,t){function o(n){i._mediaElement.removeEventListener("loadedmetadata",o),i._mediaElement.removeEventListener("error",o),"loadedmetadata"===n.type?e():t(n.target.error)}i._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING?(i._mediaElement.addEventListener("loadedmetadata",o),i._mediaElement.addEventListener("error",o),i._mediaElement.load()):e()}):Promise.resolve()},q.prototype.destroy=function(){for(var e=0;e<this._listeners.length;e++){var t=this._listeners[e];this._mediaElement.removeEventListener(t.type,t.callback)}this._listeners.length=0,this._mediaElement=null},q.prototype.play=function(){return this._mediaElement.play()},q.prototype.pause=function(){this._mediaElement.pause()},q.prototype.isPlaying=function(){return!this._mediaElement.paused},q.prototype.isSeeking=function(){return this._mediaElement.seeking},q.prototype.getCurrentTime=function(){return this._mediaElement.currentTime},q.prototype.getDuration=function(){return this._mediaElement.duration},q.prototype.seek=function(e){this._mediaElement.currentTime=e},J.prototype.setSource=function(e,t){var i=this;return i._options=e,i._callback=t,i._eventEmitter.on("player.canplay",i._playerCanPlayHandler),i._eventEmitter.on("player.error",i._playerErrorHandler),new Promise(function(t,o){i._resolve=t,i._reject=o,i._eventEmitter.on("player.canplay",i._playerCanPlayHandler),i._eventEmitter.on("player.error",i._playerErrorHandler),i._mediaElement.setAttribute("src",e.mediaUrl),i._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING&&i._mediaElement.load()})},J.prototype._reset=function(){this._eventEmitter.removeListener("player.canplay",this._playerCanPlayHandler),this._eventEmitter.removeListener("player.error",this._playerErrorHandler)},J.prototype._playerCanPlayHandler=function(){this._reset(),this._resolve()},J.prototype._playerErrorHandler=function(e){this._reset(),this._reject(e)},q.prototype.setSource=function(e){return e.mediaUrl?new J(this._eventEmitter,this._mediaElement).setSource(e):Promise.reject(new Error("peaks.setSource(): options must contain a mediaUrl when using mediaElement"))},Q.prototype.init=function(){return this._adapter.init(this._peaks)},Q.prototype.destroy=function(){this._adapter.destroy()},Q.prototype.play=function(){return this._adapter.play()},Q.prototype.pause=function(){this._adapter.pause()},Q.prototype.isPlaying=function(){return this._adapter.isPlaying()},Q.prototype.isSeeking=function(){return this._adapter.isSeeking()},Q.prototype.getCurrentTime=function(){return this._adapter.getCurrentTime()},Q.prototype.getDuration=function(){return this._adapter.getDuration()},Q.prototype.seek=function(e){v(e)?this._adapter.seek(e):this._peaks._logger("peaks.player.seek(): parameter must be a valid time, in seconds")},Q.prototype.playSegment=function(e,t){var i=this;return e&&v(e.startTime)&&v(e.endTime)?(i._segment=e,i._loop=t,i.seek(e.startTime),i._peaks.once("player.playing",function(){i._playingSegment||(i._playingSegment=!0,window.requestAnimationFrame(i._playSegmentTimerCallback))}),i.play()):Promise.reject(new Error("peaks.player.playSegment(): parameter must be a segment object"))},Q.prototype._playSegmentTimerCallback=function(){if(this.isPlaying()){if(this.getCurrentTime()>=this._segment.endTime){if(!this._loop)return this.pause(),this._peaks.emit("player.ended"),void(this._playingSegment=!1);this.seek(this._segment.startTime)}window.requestAnimationFrame(this._playSegmentTimerCallback)}else this._playingSegment=!1},Q.prototype._setSource=function(e){return this._adapter.setSource(e)},ee.prototype.init=function(e){"zoomview"===this._options.view&&(this._label=new o.Text({x:2,y:0,text:this._options.point.labelText,textAlign:"left",fontFamily:this._options.fontFamily||"sans-serif",fontSize:this._options.fontSize||10,fontStyle:this._options.fontStyle||"normal",fill:"#000"})),this._handle=new i.Rect({x:-4.5,y:0,width:10,height:20,fill:this._options.color,visible:this._draggable}),this._line=new t.Line({x:0,y:0,stroke:this._options.color,strokeWidth:1}),this._time=new o.Text({x:-24,y:0,text:this._options.layer.formatTime(this._options.point.time),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center"}),this._time.hide(),e.add(this._handle),e.add(this._line),this._label&&e.add(this._label),e.add(this._time),this.fitToView(),this.bindEventHandlers(e)},ee.prototype.bindEventHandlers=function(e){var t=this;t._handle.on("mouseover touchstart",function(){t._draggable&&(t._time.setX(-24-t._time.getWidth()),t._time.show())}),t._handle.on("mouseout touchend",function(){t._draggable&&t._time.hide()}),e.on("dragstart",function(){t._time.setX(-24-t._time.getWidth()),t._time.show()}),e.on("dragend",function(){t._time.hide()})},ee.prototype.fitToView=function(){var e=this._options.layer.getHeight();this._line.points([.5,0,.5,e]),this._label&&this._label.y(12),this._handle&&this._handle.y(e/2-10.5),this._time&&this._time.y(e/2-5)},ee.prototype.update=function(e){void 0!==e.time&&this._time&&this._time.setText(this._options.layer.formatTime(e.time)),void 0!==e.labelText&&this._label&&this._label.text(e.labelText),void 0!==e.color&&(this._handle&&this._handle.fill(e.color),this._line.stroke(e.color)),void 0!==e.editable&&(this._draggable=e.editable,this._handle.visible(this._draggable))},te.prototype.init=function(e){var n=this._options.startMarker?-24:24,s=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new o.Text({x:n,y:0,text:this._options.layer.formatTime(s),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:this._editable}),this._label.hide(),this._handle=new i.Rect({x:-4.5,y:0,width:10,height:20,fill:this._options.color,stroke:this._options.color,strokeWidth:1,visible:this._editable}),this._line=new t.Line({x:0,y:0,stroke:this._options.color,strokeWidth:1,visible:this._editable}),e.add(this._label),e.add(this._line),e.add(this._handle),this.fitToView(),this.bindEventHandlers(e)},te.prototype.bindEventHandlers=function(e){var t=this,i=t._options.startMarker?-24:24;e.on("dragstart",function(){t._options.startMarker&&t._label.setX(i-t._label.getWidth()),t._label.show()}),e.on("dragend",function(){t._label.hide()}),t._handle.on("mouseover touchstart",function(){t._options.startMarker&&t._label.setX(i-t._label.getWidth()),t._label.show()}),t._handle.on("mouseout touchend",function(){t._label.hide()})},te.prototype.fitToView=function(){var e=this._options.layer.getHeight();this._label.y(e/2-5),this._handle.y(e/2-10.5),this._line.points([.5,0,.5,e])},te.prototype.update=function(e){void 0!==e.startTime&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(e.startTime)),void 0===e.endTime||this._options.startMarker||this._label.text(this._options.layer.formatTime(e.endTime)),void 0!==e.editable&&(this._editable=e.editable,this._label.visible(this._editable),this._handle.visible(this._editable),this._line.visible(this._editable))},se.prototype.addToStage=function(e){e.add(this._layer)},se.prototype.showHighlight=function(e,t){this._highlightRect||this._createHighlightRect(e,t),this._update(e,t)},se.prototype._update=function(e,t){this._startTime=e,this._endTime=t;var i=this._view.timeToPixels(e),o=this._view.timeToPixels(t);this._highlightRect.setAttrs({x:i,width:o-i})},se.prototype._createHighlightRect=function(e,t){this._startTime=e,this._endTime=t;var o=this._view.timeToPixels(e),n=this._view.timeToPixels(t);this._highlightRect=new i.Rect({x:o,y:0,width:n-o,height:0,stroke:this._strokeColor,strokeWidth:1,fill:this._color,opacity:this._opacity,cornerRadius:this._cornerRadius}),this.fitToView(),this._layer.add(this._highlightRect)},se.prototype.removeHighlight=function(){this._highlightRect&&(this._highlightRect.destroy(),this._highlightRect=null)},se.prototype.updateHighlight=function(){this._highlightRect&&this._update(this._startTime,this._endTime)},se.prototype.fitToView=function(){if(this._highlightRect){var e=this._view.getHeight(),t=g(this._offset,0,Math.floor(e/2));this._highlightRect.setAttrs({y:t,height:e-2*t})}},re.prototype._bindDefaultEventHandlers=function(){var e=this;e._group.on("dragstart",function(t){e._onDragStart(t,e._point)}),e._group.on("dragmove",function(t){e._onDragMove(t,e._point)}),e._group.on("dragend",function(t){e._onDragEnd(t,e._point)}),e._group.on("mouseenter",function(t){e._onMouseEnter(t,e._point)}),e._group.on("mouseleave",function(t){e._onMouseLeave(t,e._point)})},re.prototype.addToLayer=function(e){e.add(this._group)},re.prototype.fitToView=function(){this._marker.fitToView()},re.prototype.getPoint=function(){return this._point},re.prototype.getX=function(){return this._group.getX()},re.prototype.setX=function(e){this._group.setX(e)},re.prototype.getWidth=function(){return this._group.getWidth()},re.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()},re.prototype.update=function(e){void 0!==e.editable&&this._group.draggable(e.editable),this._marker.update&&this._marker.update(e)},re.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()},ae.prototype.addToStage=function(e){e.add(this._layer)},ae.prototype.setListening=function(e){this._layer.listening(e)},ae.prototype.enableEditing=function(e){this._enableEditing=e},ae.prototype.getPointMarker=function(e){return this._pointMarkers[e.pid]},ae.prototype.formatTime=function(e){return this._view.formatTime(e)},ae.prototype._onPointsUpdate=function(e,t){var i=this._view.getStartTime(),o=this._view.getEndTime(),n=this.getPointMarker(e),s=e.isVisible(i,o);if(n&&!s)this._removePoint(e);else if(!n&&s)this._updatePoint(e);else if(n&&s){if(f(t,"time")){var r=this._view.timeToPixels(e.time)-this._view.getFrameOffset();n.setX(r)}n.update(t)}},ae.prototype._onPointsAdd=function(e){var t=this,i=t._view.getStartTime(),o=t._view.getEndTime();e.points.forEach(function(e){e.isVisible(i,o)&&t._updatePoint(e)})},ae.prototype._onPointsRemove=function(e){var t=this;e.points.forEach(function(e){t._removePoint(e)})},ae.prototype._onPointsRemoveAll=function(){this._layer.removeChildren(),this._pointMarkers={}},ae.prototype._createPointMarker=function(e){var t=this._enableEditing&&e.editable,i=this._view.getViewOptions();return new re({point:e,draggable:t,marker:this._peaks.options.createPointMarker({point:e,editable:t,color:e.color,fontFamily:i.fontFamily,fontSize:i.fontSize,fontStyle:i.fontStyle,layer:this,view:this._view.getName()}),onDragStart:this._onPointMarkerDragStart,onDragMove:this._onPointMarkerDragMove,onDragEnd:this._onPointMarkerDragEnd,dragBoundFunc:this._pointMarkerDragBoundFunc,onMouseEnter:this._onPointMarkerMouseEnter,onMouseLeave:this._onPointMarkerMouseLeave})},ae.prototype.getHeight=function(){return this._view.getHeight()},ae.prototype._addPointMarker=function(e){var t=this._createPointMarker(e);return this._pointMarkers[e.pid]=t,t.addToLayer(this._layer),t},ae.prototype._onPointsDrag=function(e){this._updatePoint(e.point).update({time:e.point.time})},ae.prototype._onPointMarkerMouseEnter=function(e,t){this._peaks.emit("points.mouseenter",{point:t,evt:e.evt})},ae.prototype._onPointMarkerMouseLeave=function(e,t){this._peaks.emit("points.mouseleave",{point:t,evt:e.evt})},ae.prototype._onPointMarkerDragStart=function(e,t){this._dragPointMarker=this.getPointMarker(t),this._peaks.emit("points.dragstart",{point:t,evt:e.evt})},ae.prototype._onPointMarkerDragMove=function(e,t){var i=this._pointMarkers[t.pid],o=i.getX()+i.getWidth();t._setTime(this._view.pixelOffsetToTime(o)),this._peaks.emit("points.dragmove",{point:t,evt:e.evt})},ae.prototype._onPointMarkerDragEnd=function(e,t){this._dragPointMarker=null,this._peaks.emit("points.dragend",{point:t,evt:e.evt})},ae.prototype._pointMarkerDragBoundFunc=function(e){return{x:g(e.x,0,this._view.getWidth()),y:this._dragPointMarker.getAbsolutePosition().y}},ae.prototype.updatePoints=function(e,t){this._peaks.points.find(e,t).forEach(this._updatePoint.bind(this)),this._removeInvisiblePoints(e,t)},ae.prototype._updatePoint=function(e){var t=this.getPointMarker(e);t||(t=this._addPointMarker(e));var i=this._view.timeToPixels(e.time)-this._view.getFrameOffset();return t.setX(i),t},ae.prototype._removeInvisiblePoints=function(e,t){for(var i in this._pointMarkers)if(f(this._pointMarkers,i)){var o=this._pointMarkers[i].getPoint();o.isVisible(e,t)||this._removePoint(o)}},ae.prototype._removePoint=function(e){var t=this.getPointMarker(e);t&&(t.destroy(),delete this._pointMarkers[e.pid])},ae.prototype.setVisible=function(e){this._layer.setVisible(e)},ae.prototype.destroy=function(){this._peaks.off("points.update",this._onPointsUpdate),this._peaks.off("points.add",this._onPointsAdd),this._peaks.off("points.remove",this._onPointsRemove),this._peaks.off("points.remove_all",this._onPointsRemoveAll),this._peaks.off("points.dragstart",this._onPointsDrag),this._peaks.off("points.dragmove",this._onPointsDrag),this._peaks.off("points.dragend",this._onPointsDrag)},ae.prototype.fitToView=function(){for(var e in this._pointMarkers){if(f(this._pointMarkers,e))this._pointMarkers[e].fitToView()}},ae.prototype.draw=function(){this._layer.draw()},he.prototype.addToStage=function(e){e.add(this._playheadLayer)},he.prototype.zoomLevelChanged=function(){var e=this._view.timeToPixels(1);if(this._useAnimation=e>=5,this._useAnimation)this._player.isPlaying()&&!this._playheadLineAnimation&&this._start();else if(this._playheadLineAnimation){var t=this._player.getCurrentTime();this.stop(t)}},he.prototype.fitToView=function(){var e=this._view.getHeight();this._playheadLine.points([.5,0,.5,e]),this._playheadText&&this._playheadText.y(12)},he.prototype._createPlayhead=function(){this._playheadLine=new t.Line({stroke:this._playheadColor,strokeWidth:this._playheadWidth}),this._playheadGroup=new e.Group({x:0,y:0}),this._playheadGroup.add(this._playheadLine),this._playheadLayer.add(this._playheadGroup)},he.prototype._createPlayheadText=function(){var e=this,t=e._player.getCurrentTime(),i=e._view.formatTime(t);e._playheadText=new o.Text({x:0,y:0,padding:e._playheadPadding,text:i,fontSize:e._playheadFontSize,fontFamily:e._playheadFontFamily,fontStyle:e._playheadFontStyle,fill:e._playheadTextColor,align:"right",sceneFunc:function(t,i){var o=i.width(),n=i.height()+2*e._playheadPadding;t.fillStyle=e._playheadBackgroundColor,t.fillRect(0,-e._playheadPadding,o,n),i._sceneFunc(t)}}),e._playheadGroup.add(e._playheadText)},he.prototype.updatePlayheadTime=function(e){this._syncPlayhead(e),this._player.isPlaying()&&this._start()},he.prototype._syncPlayhead=function(e){var t=this._view.timeToPixels(e),i=this._view.getFrameOffset(),o=this._view.getWidth(),n=t>=i&&t<=i+o;if(this._playheadPixel=t,n){var s=this._playheadPixel-i;if(this._playheadVisible||(this._playheadVisible=!0,this._playheadGroup.show()),this._playheadGroup.setX(s),this._playheadText){var r=this._view.formatTime(e),a=this._playheadText.width();this._playheadText.setText(r),a+s>o-2?this._playheadText.setX(-a):a+s<o&&this._playheadText.setX(0)}}else this._playheadVisible&&(this._playheadVisible=!1,this._playheadGroup.hide());this._view.playheadPosChanged&&this._view.playheadPosChanged(e)},he.prototype._start=function(){var e=this;if(e._playheadLineAnimation&&(e._playheadLineAnimation.stop(),e._playheadLineAnimation=null),e._useAnimation){var t=null;e._playheadLineAnimation=new n.Animation(function(){var i=e._player.getCurrentTime(),o=e._view.timeToPixels(i);o!==t&&(e._syncPlayhead(i),t=o)},e._playheadLayer),e._playheadLineAnimation.start()}},he.prototype.stop=function(e){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null),this._syncPlayhead(e)},he.prototype.getPlayheadPixel=function(){return this._playheadPixel},he.prototype.showPlayheadTime=function(e){e?this._playheadText||(this._createPlayheadText(this._playheadTextColor,this._playheadBackgroundColor,this._playheadPadding),this.fitToView()):this._playheadText&&(this._playheadText.remove(),this._playheadText.destroy(),this._playheadText=null)},he.prototype.updatePlayheadText=function(){if(this._playheadText){var e=this._player.getCurrentTime(),t=this._view.formatTime(e);this._playheadText.setText(t)}},he.prototype.destroy=function(){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null)},le.prototype.init=function(e){var t=this._options.startMarker?-24:24,n=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new o.Text({x:t,y:0,text:this._options.layer.formatTime(n),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:!1}),this._handle=new i.Rect({x:-4.5,y:0,width:10,height:20}),e.add(this._label),e.add(this._handle),this.fitToView(),this.bindEventHandlers(e)},le.prototype.bindEventHandlers=function(e){var t=this,i=t._options.startMarker?-24:24;e.on("dragstart",function(){t._options.startMarker&&t._label.setX(i-t._label.getWidth()),t._label.show()}),e.on("dragend",function(){t._label.hide()}),t._handle.on("mouseover touchstart",function(){t._options.startMarker&&t._label.setX(i-t._label.getWidth()),t._label.show(),document.body.style.cursor="ew-resize"}),t._handle.on("mouseout touchend",function(){t._label.hide(),document.body.style.cursor="default"})},le.prototype.fitToView=function(){var e=this._options.layer.getHeight(),t=this._options.segmentOptions.overlayOffset,i=g(0,e-2*t);this._label.y(e/2-5),this._handle.y(t),this._handle.height(i)},le.prototype.update=function(e){void 0!==e.startTime&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(e.startTime)),void 0===e.endTime||this._options.startMarker||this._label.text(this._options.layer.formatTime(e.endTime))},_e.prototype._bindDefaultEventHandlers=function(){var e=this;e._group.on("click",function(t){e._onClick(e,t)}),e._group.on("dragstart",function(t){e._onDragStart(e,t)}),e._group.on("dragmove",function(t){e._onDragMove(e,t)}),e._group.on("dragend",function(t){e._onDragEnd(e,t)})},_e.prototype.addToLayer=function(e){e.add(this._group)},_e.prototype.moveToTop=function(){this._group.moveToTop()},_e.prototype.fitToView=function(){this._marker.fitToView()},_e.prototype.getSegment=function(){return this._segment},_e.prototype.getX=function(){return this._group.getX()},_e.prototype.setX=function(e){this._group.setX(e)},_e.prototype.getWidth=function(){return this._group.getWidth()},_e.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()},_e.prototype.isStartMarker=function(){return this._startMarker},_e.prototype.update=function(e){void 0!==e.editable&&(this._group.visible(e.editable),this._group.draggable(e.editable)),this._marker.update&&this._marker.update(e)},_e.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()},_e.prototype.startDrag=function(){this._group.startDrag()},_e.prototype.stopDrag=function(){this._group.stopDrag()},pe.prototype.getX=function(){return this._shape.getX()},pe.prototype.setX=function(e){return this._shape.setX(e)},pe.prototype.setSegment=function(e){this._segment=e},pe.prototype.setWaveformColor=function(e){if(b(e))this._shape.fill(e),this._shape.fillLinearGradientStartPointY(null),this._shape.fillLinearGradientEndPointY(null),this._shape.fillLinearGradientColorStops(null);else{if(!M(e))throw new TypeError("Unknown type for color property");this._shape.fill(null);var t=this._view._height*(e.linearGradientStart/100),i=this._view._height*(e.linearGradientEnd/100);this._shape.fillLinearGradientStartPointY(t),this._shape.fillLinearGradientEndPointY(i),this._shape.fillLinearGradientColorStops([0,e.linearGradientColorStops[0],1,e.linearGradientColorStops[1]])}},pe.prototype.fitToView=function(){this.setWaveformColor(this._color)},pe.prototype._sceneFunc=function(e){var t=this._view.getFrameOffset(),i=this._view.getWidth(),o=this._view.getHeight();this._drawWaveform(e,this._view.getWaveformData(),t,this._segment?this._view.timeToPixels(this._segment.startTime):t,this._segment?this._view.timeToPixels(this._segment.endTime):t+i,i,o)},pe.prototype._drawWaveform=function(e,t,i,o,n,s,r){o<i&&(o=i);var a=i+s;n>a&&(n=a),n>t.length-1&&(n=t.length-1);for(var h=t.channels,l=0,_=Math.floor(r/h),p=0;p<h;p++)p===h-1&&(_=r-(h-1)*_),this._drawChannel(e,t.channel(p),i,o,n,l,_),l+=_},pe.prototype._drawChannel=function(e,t,i,o,n,s,r){var a,h,l,_,p=this._view.getAmplitudeScale();for(e.beginPath(),a=o;a<=n;a++)h=t.min_sample(a),l=a-i+.5,_=s+pe.scaleY(h,r,p)+.5,e.lineTo(l,_);for(a=n;a>=o;a--)h=t.max_sample(a),l=a-i+.5,_=s+pe.scaleY(h,r,p)+1,e.lineTo(l,_);e.closePath(),e.fillShape(this._shape)},pe.prototype.addToLayer=function(e){e.add(this._shape)},pe.prototype.destroy=function(){this._shape.destroy(),this._shape=null},pe.prototype.on=function(e,t){this._shape.on(e,t)},pe.prototype.off=function(e,t){this._shape.off(e,t)},pe.scaleY=function(e,t,i){var o=-(t-1)*(e*i+128)/255+(t-1);return g(Math.floor(o),0,t-1)},de.prototype._createMarkers=function(){var e,t,i,o=this._layer.isEditingEnabled()&&this._segment.editable,n=this._view.getViewOptions(),s=n.segmentOptions;this._segment.markers?e=this._peaks.options.createSegmentMarker:this._segment.overlay&&(e=me),e&&(t=e({segment:this._segment,editable:o,startMarker:!0,color:s.startMarkerColor,fontFamily:n.fontFamily,fontSize:n.fontSize,fontStyle:n.fontStyle,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions})),t&&(this._startMarker=new _e({segment:this._segment,segmentShape:this,editable:o,startMarker:!0,marker:t,onClick:this._onSegmentMarkerClick,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc})),e&&(i=e({segment:this._segment,editable:o,startMarker:!1,color:s.endMarkerColor,fontFamily:n.fontFamily,fontSize:n.fontSize,fontStyle:n.fontStyle,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions})),i&&(this._endMarker=new _e({segment:this._segment,segmentShape:this,editable:o,startMarker:!1,marker:i,onClick:this._onSegmentMarkerClick,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc}))},de.prototype._dragBoundFunc=function(e){return{x:e.x,y:0}},de.prototype.update=function(e){var t,i=this._view.timeToPixelOffset(this._segment.startTime),o=this._view.timeToPixelOffset(this._segment.endTime),n=o-i;(t=this.getStartMarker())&&(t.setX(i-t.getWidth()),e&&t.update(e)),(t=this.getEndMarker())&&(t.setX(o),e&&t.update(e)),this._color=this._segment.color,this._borderColor=this._segment.bordercolor,this._label&&this._label.text(this._segment.labelText),this._overlayText&&this._overlayText.text(this._segment.labelText),this._segment.overlay?(this._color&&this._overlayRect.fill(this._color),this._borderColor&&this._overlayRect.stroke(this._borderColor)):this._waveformShape.setWaveformColor(this._segment.color),this._dragging||this._overlay&&(this._overlay.setAttrs({x:i,width:n,clipWidth:n<1?1:n}),this._overlayRect.setAttrs({x:0,width:n}),this._overlayText&&this._overlayText.setAttrs({width:n}))},de.prototype.getSegment=function(){return this._segment},de.prototype.getStartMarker=function(){return this._startMarker},de.prototype.getEndMarker=function(){return this._endMarker},de.prototype.addToLayer=function(e){this._waveformShape&&this._waveformShape.addToLayer(e),this._label&&e.add(this._label),this._overlay&&e.add(this._overlay),this._startMarker&&this._startMarker.addToLayer(e),this._endMarker&&this._endMarker.addToLayer(e)},de.prototype.isDragging=function(){return this._dragging},de.prototype._onMouseEnter=function(e){this._label&&(this._label.moveToTop(),this._label.show()),this._peaks.emit("segments.mouseenter",{segment:this._segment,evt:e.evt})},de.prototype._onMouseLeave=function(e){this._label&&this._label.hide(),this._peaks.emit("segments.mouseleave",{segment:this._segment,evt:e.evt})},de.prototype._onMouseDown=function(e){this._peaks.emit("segments.mousedown",{segment:this._segment,evt:e.evt})},de.prototype._onMouseUp=function(e){this._peaks.emit("segments.mouseup",{segment:this._segment,evt:e.evt})},de.prototype.segmentClicked=function(e,t){this._moveToTop(),this._peaks.emit("segments."+e,t)},de.prototype._moveToTop=function(){this._overlay.moveToTop(),this._layer.moveSegmentMarkersToTop()},de.prototype.enableSegmentDragging=function(e){this._segment.editable&&(!this._draggable&&e?(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)):this._draggable&&!e&&(this._overlay.off("dragstart",this._onSegmentDragStart),this._overlay.off("dragmove",this._onSegmentDragMove),this._overlay.off("dragend",this._onSegmentDragEnd)),this._overlay.draggable(e),this._draggable=e)},de.prototype._setPreviousAndNextSegments=function(){"overlap"!==this._view.getSegmentDragMode()?(this._nextSegment=this._peaks.segments.findNextSegment(this._segment),this._previousSegment=this._peaks.segments.findPreviousSegment(this._segment)):(this._nextSegment=null,this._previousSegment=null)},de.prototype._onSegmentDragStart=function(e){this._setPreviousAndNextSegments(),this._dragging=!0,this._dragStartX=this._overlay.getX(),this._dragStartTime=this._segment.startTime,this._dragEndTime=this._segment.endTime,this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!1,startMarker:!1,evt:e.evt})},de.prototype._onSegmentDragMove=function(e){var t,i=this._overlay.getX()-this._dragStartX,o=this._view.pixelsToTime(i),n=this._dragStartTime+o,s=this._dragEndTime+o,r=this._segment.endTime-this._segment.startTime,a=this._view.getMinSegmentDragWidth(),h=this._view.pixelsToTime(a),l=!1,_=!1;if(n<0&&(n=0,s=r,this._overlay.setX(this._view.timeToPixelOffset(n))),this._previousSegment){var p=this._view.timeToPixelOffset(this._previousSegment.endTime);if(n<this._previousSegment.endTime)if("no-overlap"===(t=this._view.getSegmentDragMode())||"compress"===t&&!this._previousSegment.editable)s=(n=this._previousSegment.endTime)+r,this._overlay.setX(p);else if("compress"===t){var d=n,m=this._previousSegment.startTime+h;d<m&&(d=m,p=this._view.timeToPixelOffset(d),this._overlay.setX(p),s=(n=d)+r),this._previousSegment.update({endTime:d}),l=!0}}if(this._nextSegment){var u=this._view.timeToPixelOffset(this._nextSegment.startTime);if(s>this._nextSegment.startTime)if("no-overlap"===(t=this._view.getSegmentDragMode())||"compress"===t&&!this._nextSegment.editable)n=(s=this._nextSegment.startTime)-r,this._overlay.setX(u-this._overlay.getWidth());else if("compress"===t){var g=s,f=this._nextSegment.endTime-h;g>f&&(g=f,u=this._view.timeToPixelOffset(g),this._overlay.setX(u-this._overlay.getWidth()),n=(s=g)-r),this._nextSegment.update({startTime:g}),_=!0}}this._segment._setStartTime(n),this._segment._setEndTime(s),this._peaks.emit("segments.dragged",{segment:this._segment,marker:!1,startMarker:!1,evt:e.evt}),l?this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!1,startMarker:!1,evt:e.evt}):_&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!1,startMarker:!1,evt:e.evt})},de.prototype._onSegmentDragEnd=function(e){this._dragging=!1,this._peaks.emit("segments.dragend",{segment:this._segment,marker:!1,startMarker:!1,evt:e.evt})},de.prototype.moveMarkersToTop=function(){this._startMarker&&this._startMarker.moveToTop(),this._endMarker&&this._endMarker.moveToTop()},de.prototype.startDrag=function(){this._endMarker&&this._endMarker.startDrag()},de.prototype.stopDrag=function(){this._endMarker&&this._endMarker.stopDrag()},de.prototype._onSegmentMarkerDragStart=function(e,t){this._setPreviousAndNextSegments(),this._moveToTop(),this._startMarkerX=this._startMarker.getX(),this._endMarkerX=this._endMarker.getX(),this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!0,startMarker:e.isStartMarker(),evt:t.evt})},de.prototype._onSegmentMarkerDragMove=function(e,t){e.isStartMarker()?(this._segmentStartMarkerDragMove(e,t),e.update({startTime:this._segment.startTime})):(this._segmentEndMarkerDragMove(e,t),e.update({endTime:this._segment.endTime}))},de.prototype._segmentStartMarkerDragMove=function(e,t){var i=this._view.getWidth(),o=this._startMarker.getX(),n=this._endMarker.getX(),s=this._view.pixelsToTime(50),r=this._view.getMinSegmentDragWidth(),a=this._endMarker.getX()-r;a>i&&(a=i);var h,l=!1,_=!1;if(this._previousSegment&&(l=(h=this._view.timeToPixelOffset(this._previousSegment.endTime))>=0),o>a)e.setX(a),this._overlay.clipWidth(a-n),0===r&&a<i?this._segment._setStartTime(this._segment.endTime):this._segment._setStartTime(this._view.pixelOffsetToTime(a));else if(this._previousSegment&&l){var p=this._view.getSegmentDragMode(),d="no-overlap"===p||"compress"===p&&!this._previousSegment.editable,m="compress"===p&&this._previousSegment.editable;if(o<=h){if(d)e.setX(h),this._overlay.clipWidth(h-n),this._segment._setStartTime(this._previousSegment.endTime);else if(m){var u=ue(this._previousSegment);u<s&&(s=u);var g=this._view.timeToPixelOffset(this._previousSegment.startTime+s);o<g&&(o=g),e.setX(o),this._overlay.clipWidth(n-o),this._segment._setStartTime(this._view.pixelOffsetToTime(o)),this._previousSegment.update({endTime:this._view.pixelOffsetToTime(o)}),_=!0}}else o<0&&(o=0),e.setX(o),this._overlay.clipWidth(n-o),this._segment._setStartTime(this._view.pixelOffsetToTime(o))}else o<0&&(o=0),e.setX(o),this._overlay.clipWidth(n-o),this._segment._setStartTime(this._view.pixelOffsetToTime(o));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!0,evt:t.evt}),_&&this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!0,startMarker:!1,evt:t.evt})},de.prototype._segmentEndMarkerDragMove=function(e,t){var i=this._view.getWidth(),o=this._startMarker.getX(),n=this._endMarker.getX(),s=this._view.pixelsToTime(50),r=this._view.getMinSegmentDragWidth(),a=this._startMarker.getX()+r;a<0&&(a=0);var h,l=!1,_=!1;if(this._nextSegment&&(l=(h=this._view.timeToPixelOffset(this._nextSegment.startTime))<i),n<a)e.setX(a),this._overlay.clipWidth(a-o),0===r&&a>0?this._segment._setEndTime(this._segment.startTime):this._segment._setEndTime(this._view.pixelOffsetToTime(a));else if(this._nextSegment&&l){var p=this._view.getSegmentDragMode(),d="no-overlap"===p||"compress"===p&&!this._nextSegment.editable,m="compress"===p&&this._nextSegment.editable;if(n>=h){if(d)e.setX(h),this._overlay.clipWidth(h-o),this._segment._setEndTime(this._nextSegment.startTime);else if(m){var u=ue(this._nextSegment);u<s&&(s=u);var g=this._view.timeToPixelOffset(this._nextSegment.endTime-s);n>g&&(n=g),e.setX(n),this._overlay.clipWidth(n-o),this._segment._setEndTime(this._view.pixelOffsetToTime(n)),this._nextSegment.update({startTime:this._view.pixelOffsetToTime(n)}),_=!0}}else n>i&&(n=i),e.setX(n),this._overlay.clipWidth(n-o),this._segment._setEndTime(this._view.pixelOffsetToTime(n))}else n>i&&(n=i),e.setX(n),this._overlay.clipWidth(n-o),this._segment._setEndTime(this._view.pixelOffsetToTime(n));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!1,evt:t.evt}),_&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!0,startMarker:!0,evt:t.evt})},de.prototype._onSegmentMarkerDragEnd=function(e,t){this._nextSegment=null,this._previousSegment=null;var i=e.isStartMarker();this._peaks.emit("segments.dragend",{segment:this._segment,marker:!0,startMarker:i,evt:t.evt})},de.prototype._segmentMarkerDragBoundFunc=function(e,t){return{x:t.x,y:e.getAbsolutePosition().y}},de.prototype._onSegmentMarkerClick=function(){this._moveToTop()},de.prototype.fitToView=function(){if(this._startMarker&&this._startMarker.fitToView(),this._endMarker&&this._endMarker.fitToView(),this._overlay){var e=this._view.getHeight(),t=g(0,e-2*this._overlayOffset);this._overlay.setAttrs({y:0,height:e,clipY:this._overlayOffset,clipHeight:t}),this._overlayRect.setAttrs({y:this._overlayOffset,height:t}),this._overlayText&&this._overlayText.setAttrs({y:this._overlayOffset,height:t})}},de.prototype.destroy=function(){this._waveformShape&&this._waveformShape.destroy(),this._label&&this._label.destroy(),this._startMarker&&this._startMarker.destroy(),this._endMarker&&this._endMarker.destroy(),this._overlay&&this._overlay.destroy()},ge.prototype.addToStage=function(e){e.add(this._layer)},ge.prototype.setListening=function(e){this._layer.listening(e)},ge.prototype.enableEditing=function(e){this._enableEditing=e},ge.prototype.isEditingEnabled=function(){return this._enableEditing},ge.prototype.enableSegmentDragging=function(e){for(var t in this._segmentShapes)f(this._segmentShapes,t)&&this._segmentShapes[t].enableSegmentDragging(e)},ge.prototype.getSegmentShape=function(e){return this._segmentShapes[e.pid]},ge.prototype.formatTime=function(e){return this._view.formatTime(e)},ge.prototype._onSegmentsUpdate=function(e,t){var i=this._view.getStartTime(),o=this._view.getEndTime(),n=this.getSegmentShape(e),s=e.isVisible(i,o);n&&!s?n.isDragging()||this._removeSegment(e):!n&&s?n=this._updateSegment(e):n&&s&&n.update(t)},ge.prototype._onSegmentsAdd=function(e){var t=this,i=t._view.getStartTime(),o=t._view.getEndTime();e.segments.forEach(function(e){e.isVisible(i,o)&&t._addSegmentShape(e).update()}),this.moveSegmentMarkersToTop()},ge.prototype._onSegmentsRemove=function(e){var t=this;e.segments.forEach(function(e){t._removeSegment(e)})},ge.prototype._onSegmentsRemoveAll=function(){this._layer.removeChildren(),this._segmentShapes={}},ge.prototype._onSegmentsDragged=function(e){this._updateSegment(e.segment)},ge.prototype._createSegmentShape=function(e){return new de(e,this._peaks,this,this._view)},ge.prototype._addSegmentShape=function(e){var t=this._createSegmentShape(e);return t.addToLayer(this._layer),this._segmentShapes[e.pid]=t,t},ge.prototype.updateSegments=function(e,t){this._peaks.segments.find(e,t).forEach(this._updateSegment.bind(this)),this._removeInvisibleSegments(e,t)},ge.prototype._updateSegment=function(e){var t=this.getSegmentShape(e);t||(t=this._addSegmentShape(e)),t.update()},ge.prototype._removeInvisibleSegments=function(e,t){for(var i in this._segmentShapes)if(f(this._segmentShapes,i)){var o=this._segmentShapes[i].getSegment();o.isVisible(e,t)||this._removeSegment(o)}},ge.prototype._removeSegment=function(e){var t=this._segmentShapes[e.pid];t&&(t.destroy(),delete this._segmentShapes[e.pid])},ge.prototype.moveSegmentMarkersToTop=function(){for(var e in this._segmentShapes)f(this._segmentShapes,e)&&this._segmentShapes[e].moveMarkersToTop()},ge.prototype.setVisible=function(e){this._layer.setVisible(e)},ge.prototype.segmentClicked=function(e,t){var i=this._segmentShapes[t.segment.pid];i&&i.segmentClicked(e,t)},ge.prototype.destroy=function(){this._peaks.off("segments.update",this._onSegmentsUpdate),this._peaks.off("segments.add",this._onSegmentsAdd),this._peaks.off("segments.remove",this._onSegmentsRemove),this._peaks.off("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.off("segments.dragged",this._onSegmentsDragged)},ge.prototype.fitToView=function(){for(var e in this._segmentShapes){if(f(this._segmentShapes,e))this._segmentShapes[e].fitToView()}},ge.prototype.draw=function(){this._layer.draw()},ge.prototype.getHeight=function(){return this._layer.getHeight()},fe._buildFontString=function(e,t,i){return t||(t=11),e||(e="sans-serif"),i||(i="normal"),i+" "+t+"px "+e},fe.prototype.addToLayer=function(e){e.add(this._axisShape)},fe.prototype.showAxisLabels=function(e,t){this._showAxisLabels=e,t&&(f(t,"topMarkerHeight")&&(this._axisTopMarkerHeight=t.topMarkerHeight),f(t,"bottomMarkerHeight")&&(this._axisBottomMarkerHeight=t.bottomMarkerHeight))},fe.prototype.setAxisLabelColor=function(e){this._axisLabelColor=e},fe.prototype.setAxisGridlineColor=function(e){this._axisGridlineColor=e},fe.prototype._getAxisLabelScale=function(e){for(var t,i=1,o=[1,2,5,10,20,30],n=0;;){if(t=i*o[n],!(e.timeToPixels(t)<60))break;++n===o.length&&(i*=60,n=0)}return t},fe.prototype._drawAxis=function(e,t){var i=t.getStartTime(),o=this._getAxisLabelScale(t),n=function(e,t){if(0===t)return 0;var i=1;return e<0&&(i=-1,e=-e),i*((Math.ceil(e)+t-1)/t|0)*t}(i,o),s=n-i,r=t.timeToPixels(s);e.setAttr("strokeStyle",this._axisGridlineColor),e.setAttr("lineWidth",1),e.setAttr("font",this._axisLabelFont),e.setAttr("fillStyle",this._axisLabelColor),e.setAttr("textAlign","left"),e.setAttr("textBaseline","bottom");for(var a=t.getWidth(),h=t.getHeight(),l=n;;){var _=r+t.timeToPixels(l-n);if(_>=a)break;if(this._axisTopMarkerHeight>0&&(e.beginPath(),e.moveTo(_+.5,0),e.lineTo(_+.5,0+this._axisTopMarkerHeight),e.stroke()),this._axisBottomMarkerHeight>0&&(e.beginPath(),e.moveTo(_+.5,h),e.lineTo(_+.5,h-this._axisBottomMarkerHeight),e.stroke()),this._showAxisLabels){var p=this._formatAxisTime(l),d=_-e.measureText(p).width/2,m=h-1-this._axisBottomMarkerHeight;d>=0&&e.fillText(p,d,m)}l+=o}},ce.prototype.getViewOptions=function(){return this._viewOptions},ce.prototype.getWaveformData=function(){return this._data},ce.prototype.setWaveformData=function(e){this._data=e},ce.prototype.timeToPixels=function(e){return Math.floor(e*this._data.sample_rate/this._data.scale)},ce.prototype.pixelsToTime=function(e){return e*this._data.scale/this._data.sample_rate},ce.prototype.pixelOffsetToTime=function(e){return(this._frameOffset+e)*this._data.scale/this._data.sample_rate},ce.prototype.timeToPixelOffset=function(e){return Math.floor(e*this._data.sample_rate/this._data.scale)-this._frameOffset},ce.prototype.getFrameOffset=function(){return this._frameOffset},ce.prototype.getWidth=function(){return this._width},ce.prototype.getHeight=function(){return this._height},ce.prototype.getStartTime=function(){return this.pixelOffsetToTime(0)},ce.prototype.getEndTime=function(){return this.pixelOffsetToTime(this._width)},ce.prototype._getDuration=function(){return this._peaks.player.getDuration()},ce.prototype._createWaveform=function(){this._waveformLayer=new e.Layer({listening:!1}),this._createWaveformShapes(),this._stage.add(this._waveformLayer)},ce.prototype._createWaveformShapes=function(){if(this._waveformShape||(this._waveformShape=new pe({color:this._waveformColor,view:this}),this._waveformShape.addToLayer(this._waveformLayer)),this._playedWaveformColor&&!this._playedWaveformShape){var e=this._peaks.player.getCurrentTime();this._playedSegment={startTime:0,endTime:e},this._unplayedSegment={startTime:e,endTime:this._getDuration()},this._waveformShape.setSegment(this._unplayedSegment),this._playedWaveformShape=new pe({color:this._playedWaveformColor,view:this,segment:this._playedSegment}),this._playedWaveformShape.addToLayer(this._waveformLayer)}},ce.prototype.setWaveformColor=function(e){this._waveformColor=e,this._waveformShape.setWaveformColor(e)},ce.prototype.setPlayedWaveformColor=function(e){this._playedWaveformColor=e,e?(this._playedWaveformShape||this._createWaveformShapes(),this._playedWaveformShape.setWaveformColor(e)):this._playedWaveformShape&&this._destroyPlayedWaveformShape()},ce.prototype._destroyPlayedWaveformShape=function(){this._waveformShape.setSegment(null),this._playedWaveformShape.destroy(),this._playedWaveformShape=null,this._playedSegment=null,this._unplayedSegment=null},ce.prototype._createAxisLabels=function(){this._axisLayer=new e.Layer({listening:!1}),this._axis=new fe(this,this._viewOptions),this._axis.addToLayer(this._axisLayer),this._stage.add(this._axisLayer)},ce.prototype.showAxisLabels=function(e,t){this._axis.showAxisLabels(e,t),this._axisLayer.draw()},ce.prototype.setAxisLabelColor=function(e){this._axis.setAxisLabelColor(e),this._axisLayer.draw()},ce.prototype.setAxisGridlineColor=function(e){this._axis.setAxisGridlineColor(e),this._axisLayer.draw()},ce.prototype.showPlayheadTime=function(e){this._playheadLayer.showPlayheadTime(e)},ce.prototype.setTimeLabelPrecision=function(e){this._timeLabelPrecision=e,this._playheadLayer.updatePlayheadText()},ce.prototype.formatTime=function(e){return this._formatPlayheadTime(e)},ce.prototype.setAmplitudeScale=function(e){if(!y(e)||("number"!=typeof(t=e)||t!=t||t===1/0||t===-1/0))throw new Error("view.setAmplitudeScale(): Scale must be a valid number");var t;this._amplitudeScale=e,this.drawWaveformLayer(),this._segmentsLayer&&this._segmentsLayer.draw()},ce.prototype.getAmplitudeScale=function(){return this._amplitudeScale},ce.prototype.enableSeek=function(e){this._enableSeek=e},ce.prototype.isSeekEnabled=function(){return this._enableSeek},ce.prototype._onClick=function(e){this._clickHandler(e,"click")},ce.prototype._onDblClick=function(e){this._clickHandler(e,"dblclick")},ce.prototype._onContextMenu=function(e){this._clickHandler(e,"contextmenu")},ce.prototype._clickHandler=function(e,t){var i=e.evt.offsetX;i<0&&(i=0);var o=!0;if(e.target!==this._stage){var n=x(e.target);if(n)if("point-marker"===n.attrs.name){var s=n.getAttr("point");s&&this._peaks.emit("points."+t,{point:s,evt:e.evt,preventViewEvent:function(){o=!1}})}else if("segment-overlay"===n.attrs.name){var r=n.getAttr("segment");if(r){var a={segment:r,evt:e.evt,preventViewEvent:function(){o=!1}};this._segmentsLayer&&this._segmentsLayer.segmentClicked(t,a)}}}if(o){var h=this.pixelOffsetToTime(i),l=this.getName();this._peaks.emit(l+"."+t,{time:h,evt:e.evt})}},ce.prototype.updatePlayheadTime=function(e){this._playheadLayer.updatePlayheadTime(e)},ce.prototype.playheadPosChanged=function(e){this._playedWaveformShape&&(this._playedSegment.endTime=e,this._unplayedSegment.startTime=e,this.drawWaveformLayer())},ce.prototype.drawWaveformLayer=function(){this._waveformLayer.draw()},ce.prototype.enableMarkerEditing=function(e){this._segmentsLayer&&this._segmentsLayer.enableEditing(e),this._pointsLayer&&this._pointsLayer.enableEditing(e)},ce.prototype.dragSeek=function(e){this._segmentsLayer&&this._segmentsLayer.setListening(!e),this._pointsLayer&&this._pointsLayer.setListening(!e)},ce.prototype.fitToContainer=function(){if(0!==this._container.clientWidth||0!==this._container.clientHeight){var e=!1;this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.setWidth(this._width),e=this.containerWidthChange());var t=!1;this._container.clientHeight!==this._height&&(this._height=this._container.clientHeight,this._stage.setHeight(this._height),this._waveformShape.fitToView(),this._playheadLayer.fitToView(),this.containerHeightChange(),t=!0),e?this.updateWaveform(this._frameOffset,!0):t&&(this._segmentsLayer&&this._segmentsLayer.fitToView(),this._pointsLayer&&this._pointsLayer.fitToView())}},ce.prototype.destroy=function(){this._playheadLayer.destroy(),this._segmentsLayer&&this._segmentsLayer.destroy(),this._pointsLayer&&this._pointsLayer.destroy(),this._stage&&(this._stage.destroy(),this._stage=null)},ye.prototype._mouseDown=function(e){var t=null;if("mousedown"!==e.type||0===e.evt.button){var i=x(e.target);if(i){if("point-marker"===i.attrs.name||"segment-marker"===i.attrs.name)return;"segment-overlay"===i.attrs.name&&(t=i)}if(this._lastMouseClientX=Math.floor("touchstart"===e.type?e.evt.touches[0].clientX:e.evt.clientX),this._handlers.onMouseDown){var o=this._getMousePosX(this._lastMouseClientX);this._handlers.onMouseDown(o,t)}window.addEventListener("mousemove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("touchmove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("mouseup",this._mouseUp,{capture:!1,passive:!0}),window.addEventListener("touchend",this._mouseUp,{capture:!1}),window.addEventListener("blur",this._mouseUp,{capture:!1,passive:!0})}},ye.prototype._mouseMove=function(e){var t=Math.floor("touchmove"===e.type?e.changedTouches[0].clientX:e.clientX);if(t!==this._lastMouseClientX&&(this._lastMouseClientX=t,this._dragging=!0,this._handlers.onMouseMove)){var i=this._getMousePosX(t);this._handlers.onMouseMove(i)}},ye.prototype._mouseUp=function(e){var t;if("touchend"===e.type?(t=Math.floor(e.changedTouches[0].clientX),e.cancelable&&e.preventDefault()):t=Math.floor(e.clientX),this._handlers.onMouseUp){var i=this._getMousePosX(t);this._handlers.onMouseUp(i)}window.removeEventListener("mousemove",this._mouseMove,{capture:!1}),window.removeEventListener("touchmove",this._mouseMove,{capture:!1}),window.removeEventListener("mouseup",this._mouseUp,{capture:!1}),window.removeEventListener("touchend",this._mouseUp,{capture:!1}),window.removeEventListener("blur",this._mouseUp,{capture:!1}),this._dragging=!1},ye.prototype._getMousePosX=function(e){var t=this._stage.getContainer().getBoundingClientRect();return Math.floor(e-t.left)},ye.prototype.isDragging=function(){return this._dragging},ye.prototype.destroy=function(){this._stage.off("mousedown",this._mouseDown),this._stage.off("touchstart",this._mouseDown)},ve.prototype._onMouseDown=function(e){this._firstMove=!0,this._seek(e)},ve.prototype._onMouseMove=function(e){this._firstMove&&(this._view.dragSeek(!0),this._firstMove=!1),this._seek(e)},ve.prototype._onMouseUp=function(){this._view.dragSeek(!1)},ve.prototype._seek=function(e){if(this._view.isSeekEnabled()){e=g(e,0,this._width);var t=this._view.pixelsToTime(e),i=this._peaks.player.getDuration();t>i&&(t=i),this._view.updatePlayheadTime(t),this._peaks.player.seek(t)}},ve.prototype.destroy=function(){this._mouseDragHandler.destroy()},we.prototype=Object.create(ce.prototype),we.prototype.initWaveformData=function(){0!==this._width&&this._resampleAndSetWaveformData(this._originalWaveformData,this._width)},we.prototype.initHighlightLayer=function(){this._highlightLayer=new se(this,this._viewOptions),this._highlightLayer.addToStage(this._stage)},we.prototype.isSegmentDraggingEnabled=function(){return!1},we.prototype.getName=function(){return"overview"},we.prototype._onTimeUpdate=function(e){this._playheadLayer.updatePlayheadTime(e)},we.prototype._onPlaying=function(e){this._playheadLayer.updatePlayheadTime(e)},we.prototype._onPause=function(e){this._playheadLayer.stop(e)},we.prototype._onZoomviewUpdate=function(e){this.showHighlight(e.startTime,e.endTime)},we.prototype.showHighlight=function(e,t){this._highlightLayer.showHighlight(e,t)},we.prototype.setWaveformData=function(e){this._originalWaveformData=e,0!==this._width?this._resampleAndSetWaveformData(e,this._width):this._data=e,this.updateWaveform()},we.prototype._resampleAndSetWaveformData=function(e,t){try{return this._data=e.resample({width:t}),!0}catch(t){return this._data=e,!1}},we.prototype.removeHighlightRect=function(){this._highlightLayer.removeHighlight()},we.prototype.updateWaveform=function(){this._waveformLayer.draw(),this._axisLayer.draw();var e=this._peaks.player.getCurrentTime();this._playheadLayer.updatePlayheadTime(e),this._highlightLayer.updateHighlight();var t=this.pixelsToTime(this._width);this._pointsLayer&&this._pointsLayer.updatePoints(0,t),this._segmentsLayer&&this._segmentsLayer.updateSegments(0,t)},we.prototype.containerWidthChange=function(){return this._resampleAndSetWaveformData(this._originalWaveformData,this._width)},we.prototype.containerHeightChange=function(){this._highlightLayer.fitToView()},we.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("zoomview.update",this._onZoomviewUpdate),this._mouseDragHandler.destroy(),ce.prototype.destroy.call(this)},be.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()},be.prototype._reset=function(){this._insertSegment=null,this._insertSegmentShape=null,this._segmentIsDraggable=!1,this._peaks.segments.setInserting(!1)},be.prototype._onMouseDown=function(e,t){if(this._reset(),this._segment=t,this._segment){if("overlap"!==this._view.getSegmentDragMode())return;this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1)}var i=this._view.pixelsToTime(e+this._view.getFrameOffset());this._peaks.segments.setInserting(!0),this._insertSegment=this._peaks.segments.add({startTime:i,endTime:i,editable:!0}),this._insertSegmentShape=this._view._segmentsLayer.getSegmentShape(this._insertSegment),this._insertSegmentShape&&(this._insertSegmentShape.moveMarkersToTop(),this._insertSegmentShape.startDrag())},be.prototype._onMouseMove=function(){},be.prototype._onMouseUp=function(){this._insertSegment&&(this._insertSegmentShape&&(this._insertSegmentShape.stopDrag(),this._insertSegmentShape=null),this._segment&&this._segmentIsDraggable&&this._segment.draggable(!0),this._peaks.emit("segments.insert",{segment:this._insertSegment}),this._peaks.segments.setInserting(!1))},be.prototype.destroy=function(){this._mouseDragHandler.destroy()},ke.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()},ke.prototype._onMouseDown=function(e,t){this._seeking=!1,this._firstMove=!0,t&&!t.attrs.draggable?this._segment=null:this._segment=t;var i=this._view.getPlayheadOffset();if(this._view.isSeekEnabled()&&Math.abs(e-i)<=this._view.getPlayheadClickTolerance()&&(this._seeking=!0,this._segment&&(this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1))),this._seeking){e=g(e,0,this._view.getWidth());var o=this._view.pixelsToTime(e+this._view.getFrameOffset());this._seek(o)}else this._initialFrameOffset=this._view.getFrameOffset(),this._mouseDownX=e},ke.prototype._onMouseMove=function(e){if(!this._segment||this._seeking)if(this._seeking){this._firstMove&&(this._view.dragSeek(!0),this._firstMove=!1),e=g(e,0,this._view.getWidth());var t=this._view.pixelsToTime(e+this._view.getFrameOffset());this._seek(t)}else if(!this._view.isAutoZoom()){var i=this._mouseDownX-e,o=this._initialFrameOffset+i;o!==this._initialFrameOffset&&this._view.updateWaveform(o)}},ke.prototype._onMouseUp=function(){if(this._seeking)this._view.dragSeek(!1);else if(this._view._enableSeek&&!this._mouseDragHandler.isDragging()){var e=this._view.pixelOffsetToTime(this._mouseDownX);this._seek(e)}this._segment&&this._seeking&&this._segmentIsDraggable&&this._segment.draggable(!0)},ke.prototype._seek=function(e){var t=this._peaks.player.getDuration();e>t&&(e=t),this._view.updatePlayheadTime(e),this._peaks.player.seek(e)},ke.prototype.destroy=function(){this._mouseDragHandler.destroy()},Se.prototype=Object.create(ce.prototype),Se.prototype.initWaveformData=function(){this._enableWaveformCache=this._options.waveformCache,this._initWaveformCache();var e=this._peaks.zoom.getZoomLevel();this._resampleData({scale:e})},Se.prototype._initWaveformCache=function(){this._enableWaveformCache&&(this._waveformData=new Map,this._waveformData.set(this._originalWaveformData.scale,this._originalWaveformData),this._waveformScales=[this._originalWaveformData.scale])},Se.prototype.initHighlightLayer=function(){},Se.prototype.setWheelMode=function(e,t){if(t||(t={}),(e!==this._wheelMode||t.captureVerticalScroll!==this._captureVerticalScroll)&&(this._stage.off("wheel"),this._wheelMode=e,this._captureVerticalScroll=t.captureVerticalScroll,"scroll"===e))t.captureVerticalScroll?this._stage.on("wheel",this._onWheelCaptureVerticalScroll):this._stage.on("wheel",this._onWheel)},Se.prototype._onWheel=function(e){var t,i=e.evt;if(i.shiftKey)if(0!==i.deltaY)t=i.deltaY;else{if(0===i.deltaX)return;t=i.deltaX}else{if(Math.abs(i.deltaX)<Math.abs(i.deltaY))return;t=i.deltaX}i.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._width),i.preventDefault();var o=g(this._frameOffset+Math.floor(t),0,this._pixelLength-this._width);this.updateWaveform(o,!1)},Se.prototype._onWheelCaptureVerticalScroll=function(e){var t=e.evt,i=Math.abs(t.deltaX)<Math.abs(t.deltaY)?t.deltaY:t.deltaX;t.preventDefault();var o=g(this._frameOffset+Math.floor(i),0,this._pixelLength-this._width);this.updateWaveform(o,!1)},Se.prototype.setWaveformDragMode=function(e){this._segmentsLayer&&(this._mouseDragHandler.destroy(),this.dragSeek(!1),this._mouseDragHandler="insert-segment"===e?new be(this._peaks,this):new ke(this._peaks,this))},Se.prototype.enableSegmentDragging=function(e){this._enableSegmentDragging=e,this._segmentsLayer&&this._segmentsLayer.enableSegmentDragging(e)},Se.prototype.isSegmentDraggingEnabled=function(){return this._enableSegmentDragging},Se.prototype.setSegmentDragMode=function(e){this._segmentDragMode=e},Se.prototype.getSegmentDragMode=function(){return this._segmentDragMode},Se.prototype.getName=function(){return"zoomview"},Se.prototype._onTimeUpdate=function(e){this._mouseDragHandler.isDragging()||this._syncPlayhead(e)},Se.prototype._onPlaying=function(e){this._playheadLayer.updatePlayheadTime(e)},Se.prototype._onPause=function(e){this._playheadLayer.stop(e)},Se.prototype._onKeyboardLeft=function(){this._keyboardScroll(-1,!1)},Se.prototype._onKeyboardRight=function(){this._keyboardScroll(1,!1)},Se.prototype._onKeyboardShiftLeft=function(){this._keyboardScroll(-1,!0)},Se.prototype._onKeyboardShiftRight=function(){this._keyboardScroll(1,!0)},Se.prototype._keyboardScroll=function(e,t){var i;i=t?e*this._width:e*this.timeToPixels(this._options.nudgeIncrement),this.scrollWaveform({pixels:i})},Se.prototype.setWaveformData=function(e){this._originalWaveformData=e,this._initWaveformCache()},Se.prototype.getPlayheadOffset=function(){return this._playheadLayer.getPlayheadPixel()-this._frameOffset},Se.prototype.getPlayheadClickTolerance=function(){return this._playheadClickTolerance},Se.prototype._syncPlayhead=function(e){if(this._playheadLayer.updatePlayheadTime(e),this._autoScroll&&!this._zoomLevelAuto){var t=this.timeToPixels(e),i=this._frameOffset+this._width-this._autoScrollOffset,o=this._frameOffset;(t>=i||t<o)&&((o=t-this._autoScrollOffset)<0&&(o=0),this.updateWaveform(o,!1))}},Se.prototype._getScale=function(e){return Math.floor(e*this._data.sample_rate/this._width)},Se.prototype.setZoom=function(e){var t;if(function(e){return f(e,"scale")&&"auto"===e.scale||f(e,"seconds")&&"auto"===e.seconds}(e)){var i=this._originalWaveformData.duration;this._zoomLevelAuto=!0,this._zoomLevelSeconds=null,t=this._getScale(i)}else{if(f(e,"scale"))this._zoomLevelSeconds=null,t=Math.floor(e.scale);else if(f(e,"seconds")){if(!v(e.seconds))return!1;this._zoomLevelSeconds=e.seconds,t=this._getScale(e.seconds)}this._zoomLevelAuto=!1}t<this._originalWaveformData.scale&&(this._peaks._logger("peaks.zoomview.setZoom(): zoom level must be at least "+this._originalWaveformData.scale),t=this._originalWaveformData.scale);var o,n=this._peaks.player.getCurrentTime(),s=this.getPlayheadOffset();s>=0&&s<this._width?o=n:(s=Math.floor(this._width/2),o=this.pixelOffsetToTime(s));var r=this._scale;this._resampleData({scale:t});var a=this.timeToPixels(o)-s;return this.updateWaveform(a,!0),this._playheadLayer.zoomLevelChanged(),this._playheadLayer.updatePlayheadTime(n),this._peaks.emit("zoom.update",{currentZoom:t,previousZoom:r}),!0},Se.prototype._resampleData=function(e){var t=e.scale;if(this._enableWaveformCache){if(!this._waveformData.has(t)){for(var i=this._originalWaveformData,o=0;o<this._waveformScales.length&&this._waveformScales[o]<t;o++)i=this._waveformData.get(this._waveformScales[o]);this._waveformData.set(t,i.resample(e)),this._waveformScales.push(t),this._waveformScales.sort(function(e,t){return e-t})}this._data=this._waveformData.get(t)}else this._data=this._originalWaveformData.resample(e);this._scale=this._data.scale,this._pixelLength=this._data.length},Se.prototype.isAutoZoom=function(){return this._zoomLevelAuto},Se.prototype.setStartTime=function(e){e<0&&(e=0),this._zoomLevelAuto&&(e=0),this.updateWaveform(this.timeToPixels(e),!1)},Se.prototype.getPixelLength=function(){return this._pixelLength},Se.prototype.scrollWaveform=function(e){var t;if(f(e,"pixels"))t=Math.floor(e.pixels);else{if(!f(e,"seconds"))throw new TypeError("view.scrollWaveform(): Missing umber of pixels or seconds");t=this.timeToPixels(e.seconds)}this.updateWaveform(this._frameOffset+t,!1)},Se.prototype.updateWaveform=function(e,t){var i;if(this._pixelLength<this._width?(e=0,i=this._width):i=this._pixelLength-this._width,e=g(e,0,i),t||e!==this._frameOffset){this._frameOffset=e;var o=this._playheadLayer.getPlayheadPixel();this._playheadLayer.updatePlayheadTime(this.pixelsToTime(o)),this.drawWaveformLayer(),this._axisLayer.draw();var n=this.getStartTime(),s=this.getEndTime();this._pointsLayer&&this._pointsLayer.updatePoints(n,s),this._segmentsLayer&&this._segmentsLayer.updateSegments(n,s),this._peaks.emit("zoomview.update",{startTime:n,endTime:s})}},Se.prototype.enableAutoScroll=function(e,t){t||(t={}),this._autoScroll=e,f(t,"offset")&&(this._autoScrollOffset=t.offset)},Se.prototype.getMinSegmentDragWidth=function(){return this._insertSegmentShape?0:this._minSegmentDragWidth},Se.prototype.setMinSegmentDragWidth=function(e){this._minSegmentDragWidth=e},Se.prototype.containerWidthChange=function(){var e,t=!1;if(this._zoomLevelAuto?(t=!0,e={width:this._width}):null!==this._zoomLevelSeconds&&(t=!0,e={scale:this._getScale(this._zoomLevelSeconds)}),t)try{this._resampleData(e)}catch(e){}return!0},Se.prototype.containerHeightChange=function(){},Se.prototype.getStage=function(){return this._stage},Se.prototype.getSegmentsLayer=function(){return this._segmentsLayer},Se.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("keyboard.left",this._onKeyboardLeft),this._peaks.off("keyboard.right",this._onKeyboardRight),this._peaks.off("keyboard.shift_left",this._onKeyboardShiftLeft),this._peaks.off("keyboard.shift_right",this._onKeyboardShiftRight),this._enableWaveformCache?(this._waveformData.clear(),delete this._waveformData,delete this._waveformScales):delete this._data,this._mouseDragHandler.destroy(),ce.prototype.destroy.call(this)},Te.prototype.setZoomview=function(e){this._zoomview=e,this._updateScrollbarWidthAndPosition()},Te.prototype._setScrollboxWidth=function(){this._zoomview?(this._scrollboxWidth=Math.floor(this._width*this._zoomview.pixelsToTime(this._zoomview.getWidth())/this._peaks.player.getDuration()),this._scrollboxWidth<this._minScrollboxWidth&&(this._scrollboxWidth=this._minScrollboxWidth)):this._scrollboxWidth=this._width,this._scrollboxRect.width(this._scrollboxWidth)},Te.prototype._getScrollbarRange=function(){return this._width-this._scrollboxWidth},Te.prototype._dragBoundFunc=function(e){return{x:e.x,y:0}},Te.prototype._onScrollboxDragStart=function(){this._dragging=!0},Te.prototype._onScrollboxDragEnd=function(){this._dragging=!1},Te.prototype._onScrollboxDragMove=function(){var e=this._getScrollbarRange(),t=g(this._scrollbox.x(),0,e);this._scrollbox.x(t),t!==this._scrollboxX&&(this._scrollboxX=t,this._zoomview&&this._updateWaveform(t))},Te.prototype._onZoomviewUpdate=function(){this._dragging||this._updateScrollbarWidthAndPosition()},Te.prototype._updateScrollbarWidthAndPosition=function(){if(this._setScrollboxWidth(),this._zoomview){var e=this._zoomview.getStartTime(),t=this._zoomview.getPixelLength()-this._zoomview.getWidth(),i=Math.floor(this._zoomview.timeToPixels(e)*this._getScrollbarRange()/t);this._scrollbox.x(i),this._layer.draw()}},Te.prototype._onScrollbarClick=function(e){if(e.target===this._stage&&this._zoomview){var t=Math.floor(e.evt.offsetX-this._scrollboxWidth/2);t<0&&(t=0),this._updateWaveform(t)}},Te.prototype._updateWaveform=function(e){var t=Math.floor((this._zoomview.getPixelLength()-this._zoomview.getWidth())*e/this._getScrollbarRange());this._zoomview.updateWaveform(t)},Te.prototype.fitToContainer=function(){0===this._container.clientWidth&&0===this._container.clientHeight||(this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.width(this._width),this._updateScrollbarWidthAndPosition()),this._height=this._container.clientHeight,this._stage.height(this._height))},Te.prototype.destroy=function(){this._peaks.off("zoomview.update",this._onZoomviewUpdate),this._layer.destroy(),this._stage.destroy(),this._stage=null},Me.prototype.createOverview=function(e){if(this._overview)return this._overview;var t=this._peaks.getWaveformData();return this._overview=new we(t,e,this._peaks),this._zoomview&&this._overview.showHighlight(this._zoomview.getStartTime(),this._zoomview.getEndTime()),this._overview},Me.prototype.createZoomview=function(e){if(this._zoomview)return this._zoomview;var t=this._peaks.getWaveformData();return this._zoomview=new Se(t,e,this._peaks),this._scrollbar&&this._scrollbar.setZoomview(this._zoomview),this._zoomview},Me.prototype.createScrollbar=function(e){return this._scrollbar=new Te(e,this._peaks),this._scrollbar},Me.prototype.destroyOverview=function(){this._overview&&this._zoomview&&(this._overview.destroy(),this._overview=null)},Me.prototype.destroyZoomview=function(){this._zoomview&&this._overview&&(this._zoomview.destroy(),this._zoomview=null,this._overview.removeHighlightRect())},Me.prototype.destroy=function(){this._overview&&(this._overview.destroy(),this._overview=null),this._zoomview&&(this._zoomview.destroy(),this._zoomview=null),this._scrollbar&&(this._scrollbar.destroy(),this._scrollbar=null)},Me.prototype.getView=function(e){if(k(e))return this._overview&&this._zoomview?null:this._overview?this._overview:this._zoomview?this._zoomview:null;switch(e){case"overview":return this._overview;case"zoomview":return this._zoomview;default:return null}},Me.prototype.getScrollbar=function(){return this._scrollbar},xe.prototype.setZoomLevels=function(e){this._zoomLevels=e,this.setZoom(0,!0)},xe.prototype.zoomIn=function(){this.setZoom(this._zoomLevelIndex-1,!1)},xe.prototype.zoomOut=function(){this.setZoom(this._zoomLevelIndex+1,!1)},xe.prototype.setZoom=function(e,t){if(e>=this._zoomLevels.length&&(e=this._zoomLevels.length-1),e<0&&(e=0),t||e!==this._zoomLevelIndex){this._zoomLevelIndex=e;var i=this._peaks.views.getView("zoomview");i&&i.setZoom({scale:this._zoomLevels[e]})}},xe.prototype.getZoom=function(){return this._zoomLevelIndex},xe.prototype.getZoomLevel=function(){return this._zoomLevels[this._zoomLevelIndex]};var Pe="withCredentials"in new XMLHttpRequest;function Ee(e){this._peaks=e}function Le(e){var t=e.getResponseHeader("content-range");if(!t)return!1;var i=t.match(/^bytes (\d+)-(\d+)\/(\d+)$/);if(i&&4===i.length){var o=parseInt(i[1],10),n=parseInt(i[2],10),s=parseInt(i[3],10);return 0===o&&n+1===s}return!1}function De(){return _.call(this),this.options={zoomLevels:[512,1024,2048,4096],waveformCache:!0,mediaElement:null,mediaUrl:null,dataUri:null,withCredentials:!1,waveformData:null,webAudio:null,nudgeIncrement:1,pointMarkerColor:"#39cccc",createSegmentMarker:ie,createSegmentLabel:oe,createPointMarker:ne,logger:console.error.bind(console)},this}Ee.prototype.init=function(e,t){if(!(e.dataUri&&(e.webAudio||e.audioContext)||e.waveformData&&(e.webAudio||e.audioContext)||e.dataUri&&e.waveformData))return e.audioContext&&(this._peaks._logger("Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead"),e.webAudio={audioContext:e.audioContext}),e.dataUri?this._getRemoteWaveformData(e,t):e.waveformData?this._buildWaveformFromLocalData(e,t):e.webAudio?e.webAudio.audioBuffer?this._buildWaveformDataFromAudioBuffer(e,t):this._buildWaveformDataUsingWebAudio(e,t):void t(new Error("Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data"));t(new TypeError("Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data."))},Ee.prototype._getRemoteWaveformData=function(e,t){var i,o=this,n=null,r=null;w(e.dataUri)?(n=e.dataUri,["ArrayBuffer","JSON"].some(function(e){if(window[e])return r=e.toLowerCase(),i=n[r],Boolean(i)}),i?(o._xhr=o._createXHR(i,r,e.withCredentials,function(e){if(4===this.readyState)if(200===this.status||206===this.status&&Le(this)){o._xhr=null;var i=s.create(e.target.response);1===i.channels||2===i.channels?8===i.bits?t(void 0,i):t(new Error("Peaks.init(): 16-bit waveform data is not supported")):t(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"))}else t(new Error("Unable to fetch remote data. HTTP status "+this.status))},function(){t(new Error("XHR failed"))},function(){t(new Error("XHR aborted"))}),o._xhr.send()):t(new Error("Peaks.init(): Unable to determine a compatible dataUri format for this browser"))):t(new TypeError("Peaks.init(): The dataUri option must be an object"))},Ee.prototype._buildWaveformFromLocalData=function(e,t){var i,o=null,n=null;if(w(e.waveformData))if(w((o=e.waveformData).json)?n=o.json:(i=o.arraybuffer,Object.prototype.toString.call(i).includes("ArrayBuffer")&&(n=o.arraybuffer)),n)try{var r=s.create(n);if(1!==r.channels&&2!==r.channels)return void t(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"));if(8!==r.bits)return void t(new Error("Peaks.init(): 16-bit waveform data is not supported"));t(void 0,r)}catch(e){t(e)}else t(new Error("Peaks.init(): Unable to determine a compatible waveformData format"));else t(new Error("Peaks.init(): The waveformData option must be an object"))},Ee.prototype._buildWaveformDataUsingWebAudio=function(e,t){var i=this,o=window.AudioContext||window.webkitAudioContext;if(e.webAudio.audioContext instanceof o){var n=e.webAudio;n.scale!==e.zoomLevels[0]&&(n.scale=e.zoomLevels[0]);var s=i._peaks.options.mediaElement.currentSrc;s?i._requestAudioAndBuildWaveformData(s,n,e.withCredentials,t):i._peaks.once("player.canplay",function(){i._requestAudioAndBuildWaveformData(i._peaks.options.mediaElement.currentSrc,n,e.withCredentials,t)})}else t(new TypeError("Peaks.init(): The webAudio.audioContext option must be a valid AudioContext"))},Ee.prototype._buildWaveformDataFromAudioBuffer=function(e,t){var i=e.webAudio;i.scale!==e.zoomLevels[0]&&(i.scale=e.zoomLevels[0]);var o={audio_buffer:i.audioBuffer,split_channels:i.multiChannel,scale:i.scale,disable_worker:!0};s.createFromAudio(o,t)},Ee.prototype._requestAudioAndBuildWaveformData=function(e,t,i,o){var n=this;e?(n._xhr=n._createXHR(e,"arraybuffer",i,function(e){if(4===this.readyState)if(200===this.status||206===this.status&&Le(this)){n._xhr=null;var i={audio_context:t.audioContext,array_buffer:e.target.response,split_channels:t.multiChannel,scale:t.scale};s.createFromAudio(i,o)}else o(new Error("Unable to fetch remote data. HTTP status "+this.status))},function(){o(new Error("XHR failed"))},function(){o(new Error("XHR aborted"))}),n._xhr.send()):n._peaks._logger("Peaks.init(): The mediaElement src is invalid")},Ee.prototype.abort=function(){this._xhr&&this._xhr.abort()},Ee.prototype._createXHR=function(e,t,i,o,n,s){var r=new XMLHttpRequest;if(r.open("GET",e,!0),Pe)try{r.responseType=t}catch(e){}return r.onload=o,r.onerror=n,Pe&&i&&(r.withCredentials=!0),r.addEventListener("abort",s),r},De.prototype=Object.create(_.prototype);var Ce={playheadColor:"#111111",playheadTextColor:"#aaaaaa",playheadBackgroundColor:"transparent",playheadPadding:2,playheadWidth:1,axisGridlineColor:"#cccccc",showAxisLabels:!0,axisTopMarkerHeight:10,axisBottomMarkerHeight:10,axisLabelColor:"#aaaaaa",fontFamily:"sans-serif",fontSize:11,fontStyle:"normal",timeLabelPrecision:2,enablePoints:!0,enableSegments:!0},Ae={playheadClickTolerance:3,waveformColor:"rgba(0, 225, 128, 1)",wheelMode:"none",autoScroll:!0,autoScrollOffset:100,enableEditing:!0},We={waveformColor:"rgba(0, 0, 0, 0.2)",highlightColor:"#aaaaaa",highlightStrokeColor:"transparent",highlightOpacity:.3,highlightOffset:11,highlightCornerRadius:2,enableEditing:!1},Oe={overlay:!1,markers:!0,startMarkerColor:"#aaaaaa",endMarkerColor:"#aaaaaa",waveformColor:"#0074d9",overlayColor:"#ff0000",overlayOpacity:.3,overlayBorderColor:"#ff0000",overlayBorderWidth:2,overlayCornerRadius:5,overlayOffset:25,overlayLabelAlign:"left",overlayLabelVerticalAlign:"top",overlayLabelPadding:8,overlayLabelColor:"#000000",overlayFontFamily:"sans-serif",overlayFontSize:12,overlayFontStyle:"normal"},ze={color:"#888888",minWidth:50};function He(e,t){for(var i in t)f(t,i)&&f(e,i)&&(e[i]=t[i]);return e}function Fe(e){var t=e.zoomview.container,i=e.overview.container;return T(t)||T(i)?t&&(t.clientWidth<=0||t.clientHeight<=0)?new Error("Peaks.init(): The zoomview container must be visible and have non-zero width and height"):i&&(i.clientWidth<=0||i.clientHeight<=0)?new Error("Peaks.init(): The overview container must be visible and have non-zero width and height"):void 0:new TypeError("Peaks.init(): The zoomview and/or overview container options must be valid HTML elements")}return De.init=function(e,t){if(!t)throw new Error("Peaks.init(): Missing callback function");var i=new De,o=i._setOptions(e);if(o||(o=Fe(i.options)),o)t(o);else{var n=null;if(i.options.scrollbar){if(!T(n=i.options.scrollbar.container))return void t(new TypeError("Peaks.init(): The scrollbar container option must be a valid HTML element"));if(n.clientWidth<=0)return void t(new TypeError("Peaks.init(): The scrollbar container must be visible and have non-zero width"))}e.keyboard&&(i._keyboardHandler=new Y(i));var s=e.player?e.player:new q(i.options.mediaElement);i.player=new Q(i,s),i.segments=new K(i),i.points=new X(i),i.zoom=new xe(i,i.options.zoomLevels),i.views=new Me(i),i._waveformBuilder=new Ee(i),i.player.init(i).then(function(){i._waveformBuilder.init(i.options,function(o,s){if(o)t(o);else if(o=Fe(i.options))t(o);else{i._waveformBuilder=null,i._waveformData=s;var r=i.options.zoomview.container,a=i.options.overview.container;r&&i.views.createZoomview(r),a&&i.views.createOverview(a),n&&i.views.createScrollbar(n),e.segments&&i.segments.add(e.segments),e.points&&i.points.add(e.points),e.emitCueEvents&&(i._cueEmitter=new O(i)),t(null,i)}})}).catch(function(e){t(e)})}},De.prototype._setOptions=function(e){if(!w(e))return new TypeError("Peaks.init(): The options parameter should be an object");if(!e.player){if(!e.mediaElement)return new Error("Peaks.init(): Missing mediaElement option");if(!(e.mediaElement instanceof HTMLMediaElement))return new TypeError("Peaks.init(): The mediaElement option should be an HTMLMediaElement")}return e.logger&&"function"!=typeof e.logger?new TypeError("Peaks.init(): The logger option should be a function"):e.segments&&!Array.isArray(e.segments)?new TypeError("Peaks.init(): options.segments must be an array of segment objects"):e.points&&!Array.isArray(e.points)?new TypeError("Peaks.init(): options.points must be an array of point objects"):(He(this.options,e),this.options.overview=function(e){var t={};return e.overview&&e.overview.showPlayheadTime&&(t.showPlayheadTime=e.overview.showPlayheadTime),["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","playheadWidth","formatPlayheadTime","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","highlightColor","highlightStrokeColor","highlightOpacity","highlightCornerRadius","highlightOffset","enablePoints","enableSegments","enableEditing"].forEach(function(i){e.overview&&f(e.overview,i)?t[i]=e.overview[i]:f(e,i)?t[i]=e[i]:f(t,i)||(f(We,i)?t[i]=We[i]:f(Ce,i)&&(t[i]=Ce[i]))}),t}(e),this.options.zoomview=function(e){var t={};return e.showPlayheadTime?t.showPlayheadTime=e.showPlayheadTime:e.zoomview&&e.zoomview.showPlayheadTime&&(t.showPlayheadTime=e.zoomview.showPlayheadTime),["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","playheadWidth","formatPlayheadTime","playheadClickTolerance","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","wheelMode","autoScroll","autoScrollOffset","enablePoints","enableSegments","enableEditing"].forEach(function(i){e.zoomview&&f(e.zoomview,i)?t[i]=e.zoomview[i]:f(e,i)?t[i]=e[i]:f(t,i)||(f(Ae,i)?t[i]=Ae[i]:f(Ce,i)&&(t[i]=Ce[i]))}),t}(e),this.options.scrollbar=function(e){if(!f(e,"scrollbar"))return null;var t={};return["container","color","minWidth"].forEach(function(i){f(e.scrollbar,i)?t[i]=e.scrollbar[i]:t[i]=ze[i]}),t}(e),function(e,t){e.segmentOptions={},c(e.segmentOptions,Oe),t.segmentOptions&&He(e.segmentOptions,t.segmentOptions),e.zoomview.segmentOptions={},c(e.zoomview.segmentOptions,e.segmentOptions),t.zoomview&&t.zoomview.segmentOptions&&He(e.zoomview.segmentOptions,t.zoomview.segmentOptions),e.overview.segmentOptions={},c(e.overview.segmentOptions,e.segmentOptions),t.overview&&t.overview.segmentOptions&&He(e.overview.segmentOptions,t.overview.segmentOptions)}(this.options,e),Array.isArray(this.options.zoomLevels)?0===this.options.zoomLevels.length?new Error("Peaks.init(): The zoomLevels array must not be empty"):function(e){if(0===e.length)return!0;for(var t=e[0],i=1;i<e.length;i++){if(t>=e[i])return!1;t=e[i]}return!0}(this.options.zoomLevels)?void(this._logger=this.options.logger):new Error("Peaks.init(): The zoomLevels array must be sorted in ascending order"):new TypeError("Peaks.init(): The zoomLevels option should be an array"))},De.prototype.setSource=function(e,t){var i=this;i.player._setSource(e).then(function(){e.zoomLevels||(e.zoomLevels=i.options.zoomLevels),i._waveformBuilder=new Ee(i),i._waveformBuilder.init(e,function(o,n){o?t(o):(i._waveformBuilder=null,i._waveformData=n,["overview","zoomview"].forEach(function(e){var t=i.views.getView(e);t&&t.setWaveformData(n)}),i.zoom.setZoomLevels(e.zoomLevels),t())})}).catch(function(e){t(e)})},De.prototype.getWaveformData=function(){return this._waveformData},De.prototype.destroy=function(){this._waveformBuilder&&this._waveformBuilder.abort(),this._keyboardHandler&&this._keyboardHandler.destroy(),this.views&&this.views.destroy(),this.player&&this.player.destroy(),this._cueEmitter&&this._cueEmitter.destroy()},De});
//# sourceMappingURL=peaks.ext.min.js.map
